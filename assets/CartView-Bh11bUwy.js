import{s as I,H as M,I as U,_ as O,o as r,e as a,b as e,t as h,h as N,m as b,a as S,c as L,w as i,d as l,n as v,f as p,r as m,j as R,J as B,g as y,F as g,i as k,K as T}from"./index-hIBv_cFW.js";import{c as w}from"./cartStore-DdOrrH1A.js";import{l as A}from"./loadingStore-DNIkVO7R.js";import{h as D}from"./helperStore-CTnSHLqw.js";import{C as j}from"./CartList-BHh7a_y-.js";import{F as P}from"./FormFloat-DHKZCvU2.js";import{s as q}from"./swalStore-BXANR3GM.js";import{v as H}from"./validateStore-OD5Dx8TY.js";import{L as X}from"./LoadingBtn-BuU4Qp6P.js";import{M as z,X as K}from"./XBtn-6EgZDbM3.js";import"./scrollStore-gnaDh0f9.js";var G={VITE_URL:"https://ec-course-api.hexschool.io/v2",VITE_PATH:"jiayu",BASE_URL:"/Chocolate-Shop/",MODE:"production",DEV:!1,PROD:!0,SSR:!1};const{$swal:J}=U.variables,{VITE_URL:Q,VITE_PATH:W}=G,{hideLoading:Y}=A(),E=I("orderStore",{state:()=>({orders:[],currentOrder:{}}),actions:{async getOrders(){try{const s=`${Q}/api/${W}/orders`,{data:t}=await M.get(s);this.orders=t==null?void 0:t.orders,[this.currentOrder]=this.orders}catch(s){Y();const{message:t}=s.response.data;J(Array.isArray(t)?t[0]:t)}}}}),Z={props:{title:String}},ee={class:"rounded-md border border-primary-200"},te={class:"bg-primary-200 py-3 text-center text-lg font-bold text-primary-800 md:text-xl"},se={class:"p-4"};function oe(s,t,f,V,o,x){return r(),a("div",ee,[e("h2",te,h(f.title),1),e("div",se,[N(s.$slots,"default")])])}const re=O(Z,[["render",oe]]);var le={VITE_URL:"https://ec-course-api.hexschool.io/v2",VITE_PATH:"jiayu",BASE_URL:"/Chocolate-Shop/",MODE:"production",DEV:!1,PROD:!0,SSR:!1};const{VITE_URL:ne,VITE_PATH:ae}=le,ie={components:{FormFloat:P},data(){return{user:{},message:""}},methods:{async postOrder(){if(this.cartNum)try{if((await this.confirmSwal("確定提交訂單？")).isConfirmed){this.showLoading();const t=`${ne}/api/${ae}/order`,f={user:this.user,message:this.message},V=await this.$http.post(t,{data:f});this.hideLoading(),this.$refs.form.resetForm(),this.swalToast(V.data.message),this.finishOrder()}}catch(s){this.hideLoading();const{message:t}=s.response.data;this.$swal(Array.isArray(t)?t[0]:t)}else this.$swal("請選購商品後再提交表單")},async finishOrder(){this.$emit("nextStep"),this.showLoading();const s=[this.getCart(),this.getOrders()];(await Promise.allSettled(s)).forEach(f=>{f.status==="rejected"&&(this.hideLoading(),this.$swal(f.response.data))}),this.hideLoading()},...b(q,["confirmSwal","swalToast"]),...b(H,["isPhone"]),...b(A,["showLoading","hideLoading"]),...b(E,["getOrders"]),...b(w,["getCart"])},computed:{...S(w,["cartNum"])}},de={class:""},ce={class:"mb-3"},ue={class:"mb-3"},pe={class:"mb-3"},me={class:"mb-3"},_e={class:"mb-3"},he={class:"mt-10 flex justify-between"},fe=e("i",{class:"bi bi-chevron-double-left me-1"},null,-1),be=e("button",{type:"submit",class:"btn btn-primary"},[p(" 送出訂單 "),e("i",{class:"bi bi-chevron-double-right ml-1"})],-1);function ye(s,t,f,V,o,x){const c=m("VField"),_=m("FormFloat"),$=m("VForm");return r(),L($,{ref:"form",onSubmit:x.postOrder},{default:i(({errors:C})=>[e("div",de,[e("div",ce,[l(_,{"label-for":"myName",label:"收件人姓名",errors:C},{default:i(({inputClass:d})=>[l(c,{id:"myName",name:"收件人姓名",type:"text",class:v(d),rules:"required",modelValue:o.user.name,"onUpdate:modelValue":t[0]||(t[0]=u=>o.user.name=u),required:""},null,8,["class","modelValue"])]),_:2},1032,["errors"])]),e("div",ue,[l(_,{"label-for":"email",label:"電子信箱",errors:C},{default:i(({inputClass:d})=>[l(c,{id:"email",name:"電子信箱",type:"email",class:v(d),rules:"email|required",modelValue:o.user.email,"onUpdate:modelValue":t[1]||(t[1]=u=>o.user.email=u),required:""},null,8,["class","modelValue"])]),_:2},1032,["errors"])]),e("div",pe,[l(_,{"label-for":"tel",label:"收件人電話",errors:C},{default:i(({inputClass:d})=>[l(c,{id:"tel",name:"收件人電話",type:"tel",class:v(d),rules:s.isPhone,modelValue:o.user.tel,"onUpdate:modelValue":t[2]||(t[2]=u=>o.user.tel=u),required:""},null,8,["class","rules","modelValue"])]),_:2},1032,["errors"])]),e("div",me,[l(_,{"label-for":"address",label:"收件人地址",errors:C},{default:i(({inputClass:d})=>[l(c,{id:"address",name:"收件人地址",type:"text",class:v(d),rules:"required",modelValue:o.user.address,"onUpdate:modelValue":t[3]||(t[3]=u=>o.user.address=u),required:""},null,8,["class","modelValue"])]),_:2},1032,["errors"])]),e("div",_e,[l(_,{"label-for":"message",label:"留言"},{default:i(({inputClass:d})=>[l(c,{id:"message",name:"留言",type:"text",class:v(d),as:"textarea",modelValue:o.message,"onUpdate:modelValue":t[4]||(t[4]=u=>o.message=u)},null,8,["class","modelValue"])]),_:1})])]),e("div",he,[e("button",{type:"button",class:"btn btn-link",onClick:t[5]||(t[5]=d=>s.$emit("prevStep"))},[fe,p("再確認購物清單 ")]),be])]),_:1},8,["onSubmit"])}const ge=O(ie,[["render",ye]]),xe={props:["swalContainer"],components:{LoadingBtn:X},data(){return{couponCode:""}},methods:{handleUseCoupon(){this.container?this.postCoupon(this.couponCode,this.container):this.postCoupon(this.couponCode),this.couponCode=""},...b(w,["postCoupon"])},computed:{...S(w,["usedCoupon"]),...S(A,["loadingStatus"])}},Ce={class:"inline-flex"},ve=e("option",{value:"",class:"hover-bg-primary-800",selected:""},"請選擇優惠碼",-1),we=e("option",{value:"ILOVECACAO",class:""},"ILOVECACAO",-1),Ve=[ve,we],$e={key:0,class:"text-primary-800"};function Se(s,t,f,V,o,x){const c=m("LoadingBtn");return r(),a(g,null,[e("div",Ce,[R(e("select",{name:"coupon",id:"coupon",class:"form-control rounded-r-none","onUpdate:modelValue":t[0]||(t[0]=_=>o.couponCode=_)},Ve,512),[[B,o.couponCode]]),l(c,{class:"btn btn-primary-light text-nowrap rounded-l-none shadow-none",isLoading:s.loadingStatus.newCoupon,onClick:x.handleUseCoupon,disabled:!o.couponCode},{default:i(()=>[p(" 使用 ")]),_:1},8,["isLoading","onClick","disabled"])]),s.usedCoupon?(r(),a("p",$e,"已使用優惠券："+h(s.usedCoupon),1)):y("",!0)],64)}const Le=O(xe,[["render",Se]]),Oe={components:{CartList:j,CouponInput:Le,CartSection:re,OrderForm:ge,ModalComponent:z,XBtn:K},data(){return{step:1,stepArr:["購物清單","收件資訊","訂單明細"],detail:[]}},mounted(){},watch:{currentOrder:{handler(){this.detail=[{title:"訂單編號",text:this.currentOrder.id},{title:"成立時間",text:new Date(this.currentOrder.create_at*1e3).toLocaleString()},{title:"收件人姓名",text:this.currentOrder.user.name},{title:"電子信箱",text:this.currentOrder.user.email},{title:"收件人電話",text:this.currentOrder.user.tel},{title:"收件人地址",text:this.currentOrder.user.address},{title:"訂單總額",text:`$ ${this.currentOrder.total}`}]},deep:!0}},methods:{closeDetailModal(){this.$refs.detailModal.closeModal()},...b(w,["postCoupon"]),...b(D,["timestampToDate"])},computed:{...S(w,["cartNum","carts","total","final_total","usedCoupon"]),...S(E,["currentOrder"])}},ke={class:"container py-10 h-full"},Ae={class:"w-full lg:w-4/5 mx-auto h-full"},Te={key:0,class:"relative mb-10 flex justify-between after:content-[''] after:h-1 after:bg-primary-800 after:absolute after:inset-x-6 after:top-6 z-10 after:-z-10"},Ee={key:0,class:"bi bi-check-lg"},Fe={class:"font-bold"},Ie={key:0,class:"flex flex-col items-center justify-center h-full"},Me=e("i",{class:"bi bi-cart-x text-8xl"},null,-1),Ue=e("p",{class:"py-6"},"你的購物車是空的",-1),Ne={class:"flex flex-col gap-4 md:flex-row md:items-start"},Re={class:"mt-4 md:text-lg"},Be={class:"float-end"},De={key:0,class:"text-bold mt-4 text-lg text-primary-800 md:text-xl"},je={class:"float-end"},Pe={class:"mt-10 flex justify-between"},qe=e("i",{class:"bi bi-chevron-double-left me-1"},null,-1),He=e("i",{class:"bi bi-chevron-double-right ml-1"},null,-1),Xe={key:3,class:"flex flex-col items-center justify-center"},ze=e("h2",{class:"mb-10 text-3xl"},"訂單已建立",-1),Ke={key:0,class:"w-full border-y-2 border-primary-800 mb-10"},Ge={class:"divide-y divide-primary-800"},Je={class:"text-start",scope:"row"},Qe={class:"text-end"},We={class:"*:py-2"},Ye=e("th",{class:"text-start",scope:"row"},"購物清單",-1),Ze={class:"text-end"},et=e("i",{class:"bi bi-search ml-1"},null,-1),tt={class:"p-6"},st={class:"mb-4 flex justify-between"},ot=e("p",{class:"text-lg font-bold text-primary-800"},"購物清單",-1);function rt(s,t,f,V,o,x){const c=m("RouterLink"),_=m("CartList"),$=m("CartSection"),C=m("CouponInput"),d=m("OrderForm"),u=m("XBtn"),F=m("ModalComponent");return r(),a("div",ke,[e("div",Ae,[s.cartNum||o.step===3?(r(),a("ul",Te,[(r(),a(g,null,k(3,n=>e("li",{key:`step${n}`,class:"text-center"},[e("div",{class:v(["w-12 h-12 inline-flex justify-center items-center rounded-sm mb-2 text-lg font-bold",n<=o.step?"bg-primary-800 text-primary-200":"bg-primary-50 text-primary-800 border border-primary-800"])},[o.step>n?(r(),a("i",Ee)):(r(),a(g,{key:1},[p(h(n),1)],64))],2),e("p",Fe,h(o.stepArr[n-1]),1)])),64))])):y("",!0),o.step===1?(r(),a(g,{key:1},[s.cartNum===0?(r(),a("div",Ie,[Me,Ue,l(c,{to:"/products",class:"btn btn-primary"},{default:i(()=>[p("開始購物")]),_:1})])):(r(),a(g,{key:1},[e("div",Ne,[l($,{class:"w-full md:w-2/3",title:"購物清單"},{default:i(()=>[l(_)]),_:1}),l($,{class:"w-full md:w-1/3",title:"訂單金額"},{default:i(()=>[(r(),L(T,null,[l(C)],1024)),e("p",Re,[p(" 總計"),e("span",Be,"NT$ "+h(s.total),1)]),s.total!==s.final_total?(r(),a("p",De,[p(" 折扣價"),e("span",je,"NT$ "+h(s.final_total),1)])):y("",!0)]),_:1})]),e("div",Pe,[l(c,{to:"/products",class:"btn btn-text"},{default:i(()=>[qe,p("回產品列表 ")]),_:1}),e("button",{type:"button",class:"btn btn-primary",onClick:t[0]||(t[0]=n=>o.step++)},[p(" 填寫收件資訊 "),He])])],64))],64)):y("",!0),o.step===2?(r(),L($,{key:2,title:"收件資訊"},{default:i(()=>[(r(),L(T,null,[l(d,{onPrevStep:t[1]||(t[1]=n=>o.step--),onNextStep:t[2]||(t[2]=n=>o.step++)})],1024))]),_:1})):y("",!0),o.step===3?(r(),a("div",Xe,[ze,o.detail.length?(r(),a("table",Ke,[e("tbody",Ge,[(r(!0),a(g,null,k(o.detail,n=>(r(),a("tr",{key:n.title,class:"*:py-2"},[e("th",Je,h(n.title),1),e("td",Qe,h(n.text),1)]))),128)),e("tr",We,[Ye,e("td",Ze,[(r(!0),a(g,null,k(s.currentOrder.products,n=>(r(),a("p",{key:n.id},h(n.product.title)+" × "+h(n.qty),1))),128)),e("button",{type:"button",class:"link font-bold",onClick:t[3]||(t[3]=(...n)=>s.$refs.detailModal.showModal&&s.$refs.detailModal.showModal(...n))},[p(" 詳細"),et]),l(F,{ref:"detailModal",direction:"up",class:"mb-0 rounded-sm"},{default:i(()=>[e("div",tt,[e("div",st,[ot,l(u,{class:"-mt-2",onClick:x.closeDetailModal},null,8,["onClick"])]),l(_,{"prop-carts":s.currentOrder.products,"can-edit":!1},null,8,["prop-carts"])])]),_:1},512)])])])])):y("",!0),l(c,{to:"/products",class:"btn btn-primary btn-lg text-lg"},{default:i(()=>[p("繼續購物")]),_:1})])):y("",!0)])])}const ft=O(Oe,[["render",rt]]);export{ft as default};
