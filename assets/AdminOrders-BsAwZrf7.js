import{_ as T,m as y,i as I,c as l,a as p,w as u,F as m,b as t,r as _,o as r,u as w,t as n,k as D,x as O,h as v}from"./index-jy0z-i-L.js";import{a as B,L as V,P as E,C as P,s as A}from"./TableComponent-B7OiIO04.js";import{l as S}from"./loadingStore-DUq4jI8Z.js";var R={VITE_URL:"https://ec-course-api.hexschool.io/v2",VITE_PATH:"jiayu",BASE_URL:"/",MODE:"production",DEV:!1,PROD:!0,SSR:!1};const{VITE_URL:g,VITE_PATH:b}=R,U={data(){return{orders:[],pagination:{}}},components:{TableComponent:B,LoadingBtn:V,PaginationComponent:E,CopyBtn:P},mounted(){this.showLoading(),this.getOrders()},methods:{handleTelLink(a){let s=a.replace(/[^\d]/g,"").substring(1);return s[0]!=="9"&&(s=s.replace(/(\d{1})(\d{8})/,"$1-$2")),s=`tel:+886-${s}`,s},handleDate(a){return new Date(a*1e3).toLocaleDateString()},async getOrders(a=1){try{const s=`${g}/api/${b}/admin/orders?page=${a}`,i=await this.$http.get(s);this.orders=i.data.orders,this.pagination=i.data.pagination}catch(s){this.$swal(s.data.message||"發生錯誤")}finally{this.hideLoading()}},async delOrder(a){try{if((await this.delSwal("訂單編號",a)).isConfirmed){this.loadingStatus.orderId=a;const i=`${g}/api/${b}/admin/order/${a}`,c=await this.$http.delete(i);this.getOrders(),this.swalToast(c.data.message),this.loadingStatus.orderId=""}}catch(s){this.loadingStatus.orderId="",this.$swal(s.data.message||"發生錯誤")}},async putOrder(a){try{this.loadingStatus.orderId=a.id;const s={...a},i=`${g}/api/${b}/admin/order/${a.id}`,c=await this.$http.put(i,{data:s});this.getOrders(),this.swalToast(c.data.message),this.loadingStatus.orderId=""}catch(s){this.loadingStatus.orderId="",this.$swal(s.data.message||"發生錯誤")}},...y(A,["delSwal","swalToast"]),...y(S,["showLoading","hideLoading"])},computed:{...I(S,["isLoading","loadingStatus"])}},N=t("h2",{class:"text-2xl font-bold mb-8"},"訂單管理",-1),j=t("th",null,"編號",-1),F=t("th",null,"聯絡人",-1),G=t("th",null,"地址",-1),H=t("th",null,"電子郵件",-1),M=t("th",null,"品項",-1),q=t("th",{class:"text-end pr-1 md:pr-2"},"總額",-1),z=t("th",null,"日期",-1),J=t("th",null,"付款",-1),K=t("th",null,"操作",-1),Q={class:"py-2 pr-1"},W={class:"py-2 pr-1"},X=["href"],Y={class:"hidden md:inline"},Z=t("i",{class:"bi bi-telephone-outbound-fill text-primary-700 md:hidden"},null,-1),tt={class:"py-2 pr-1"},st={class:"hidden md:inline"},et={class:"py-2 pr-1"},at=["href"],nt={class:"hidden md:inline"},it=t("i",{class:"bi bi-envelope-arrow-up-fill text-primary-700 md:hidden"},null,-1),ot={class:"py-2 pr-1"},dt={class:"text-end py-2 pr-1 md:pr-2"},lt={class:"py-2 pr-1"},rt={class:"hidden md:inline"},ct={class:"md:hidden"},ht={class:"py-2 pr-1"},pt=["for"],_t=["id","onUpdate:modelValue","disabled","onChange"],ut=t("div",{class:"w-4 h-4 flex items-center justify-center bg-primary-50 text-primary-800 border border-primary-800 rounded-full ml-[50%] transition-all duration-150 bg-icon-x bg-center bg-no-repeat peer-checked:bg-icon-check peer-checked:ml-[0%] peer-checked:border-primary-300 peer-disabled:border-stone-300"},null,-1),mt={class:"py-2 pr-1"},gt={key:0,class:"bi bi-trash3-fill"};function bt(a,s,i,c,f,o){const $=_("CopyBtn"),C=_("LoadingBtn"),x=_("TableComponent"),k=_("PaginationComponent");return r(),l(m,null,[N,p(x,{class:"mb-8"},{th:u(()=>[j,F,G,H,M,q,z,J,K]),tr:u(()=>[(r(!0),l(m,null,w(f.orders,(e,h)=>(r(),l("tr",{key:e.id},[t("td",Q,n(h+1),1),t("td",W,[t("p",null,n(e.user.name),1),t("a",{class:"link",href:o.handleTelLink(e.user.tel)},[t("span",Y,n(e.user.tel),1),Z],8,X)]),t("td",tt,[t("span",st,n(e.user.address),1),p($,{text:e.user.address,msg:"地址",class:"text-primary-700 md:hidden"},null,8,["text"])]),t("td",et,[t("a",{class:"link",href:`mailto:${e.user.email}`},[t("span",nt,n(e.user.email),1),it],8,at)]),t("td",ot,[(r(!0),l(m,null,w(e.products,(d,L)=>(r(),l("p",{key:L},n(`${d.product.title} * ${d.qty}`),1))),128))]),t("td",dt,n(e.total),1),t("td",lt,[t("span",rt,n(o.handleDate(e.create_at)),1),t("span",ct,n(o.handleDate(e.create_at).substring(5)),1)]),t("td",ht,[t("label",{for:`paidStatus${h}`,class:"inline-flex w-8 h-4 items-center cursor-pointer bg-primary-800 rounded-full transition-all duration-150 has-[:checked]:bg-primary-300 has-[:disabled]:bg-stone-300 has-[:disabled]:cursor-default"},[D(t("input",{type:"checkbox",id:`paidStatus${h}`,class:"hidden peer","onUpdate:modelValue":d=>e.is_paid=d,disabled:a.loadingStatus.orderId===e.id,onChange:d=>o.putOrder(e)},null,40,_t),[[O,e.is_paid]]),ut],8,pt)]),t("td",mt,[p(C,{class:"btn btn-link p-1 md:p-2","is-loading":a.loadingStatus.orderId===e.id,onClick:d=>o.delOrder(h+1)},{default:u(()=>[a.loadingStatus.orderId!==e.id?(r(),l("i",gt)):v("",!0)]),_:2},1032,["is-loading","onClick"])])]))),128))]),_:1}),p(k,{pagination:f.pagination,onGetData:o.getOrders},null,8,["pagination","onGetData"])],64)}const St=T(U,[["render",bt]]);export{St as default};
