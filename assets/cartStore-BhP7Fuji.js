import{s as f,H as i,I as m}from"./index-RqgZaRPO.js";import{s as g}from"./swalStore-Dw2Nn-Wm.js";import{l as C}from"./loadingStore-CVQYdMir.js";var _={VITE_URL:"https://ec-course-api.hexschool.io/v2",VITE_PATH:"jiayu",BASE_URL:"/Chocolate-Shop/",MODE:"production",DEV:!1,PROD:!0,SSR:!1};const{$swal:c}=m.variables,{VITE_URL:n,VITE_PATH:l}=_,{swalToast:d,delSwal:y}=g(),{loadingStatus:e,hideLoading:$}=C(),S=f("cartStore",{state:()=>({carts:[],orders:[],cartNum:0,total:0,final_total:0,usedCoupon:"",timer:0}),actions:{async getCart(){var r,s,t,a,u,h;try{const p=`${n}/api/${l}/cart`,{data:o}=await i.get(p);this.carts=(r=o==null?void 0:o.data)==null?void 0:r.carts,this.cartNum=(s=this.carts)==null?void 0:s.length,this.usedCoupon=(a=(t=this.carts[0])==null?void 0:t.coupon)==null?void 0:a.code,this.total=(u=o==null?void 0:o.data)==null?void 0:u.total,this.final_total=Math.floor((h=o==null?void 0:o.data)==null?void 0:h.final_total)}catch(p){$();const{message:o}=p.response.data;c(Array.isArray(o)?o[0]:o)}},async postCart(r,s=1){try{e.productId=r;const t=`${n}/api/${l}/cart`,a={product_id:r,qty:s};await i.post(t,{data:a}),d("加入購物車"),this.getCart(),e.productId=""}catch(t){const{message:a}=t.response.data;c(Array.isArray(a)?a[0]:a)}},async putCart(r,s){try{e.cartId=r.id;const t=`${n}/api/${l}/cart/${r.id}`,a={product_id:r.product_id,qty:s};await i.put(t,{data:a}),this.getCart(),e.cartId=""}catch(t){const{message:a}=t.response.data;c(Array.isArray(a)?a[0]:a)}},debouncePutCart(r,s){clearTimeout(this.timer),this.timer=setTimeout(()=>{this.putCart(r,s)},300)},async delCart(r,s="body"){try{e.cartId=r.id;const t=`${n}/api/${l}/cart/${r.id}`;s===!1?(await i.delete(t),d(`已刪除 ${r.product.title}`,s),this.getCart(),e.cartId=""):(await y("購物車中",r.product.title,s)).isConfirmed&&(await i.delete(t),d(`已刪除 ${r.product.title}`,s),this.getCart()),e.cartId=""}catch(t){const{message:a}=t.response.data;c(Array.isArray(a)?a[0]:a)}},async delAllCart(r="body"){try{if((await y("購物車中","全部項目",r)).isConfirmed){const t=`${n}/api/${l}/carts`;await i.delete(t),d("已清空購物車",r),this.getCart()}}catch(s){const{message:t}=s.response.data;c(Array.isArray(t)?t[0]:t)}},async postCoupon(r,s){try{e.newCoupon=!0;const t=`${n}/api/${l}/coupon`,a=await i.post(t,{data:{code:r}});this.final_total=Math.floor(a.data.data.final_total),this.usedCoupon=r,e.newCoupon=!1}catch(t){e.newCoupon=!1;const{message:a}=t.response.data;c({title:Array.isArray(a)?a[0]:a,target:s})}}}});export{S as c};
