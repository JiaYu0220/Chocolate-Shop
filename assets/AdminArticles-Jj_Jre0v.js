import{m as y,a as P,_ as B,o as r,c as O,w as d,b as t,t as g,n as h,d as l,e as m,j as F,D as k,F as A,I as q,r as T,g as D,f as v,h as c}from"./index-D5bxwdZD.js";import{l as S}from"./loadingStore-X0dCeu3y.js";import{s as R}from"./swalStore-BY5kGDbB.js";import{h as j}from"./helperStore-Cv9sDlZJ.js";import{P as H}from"./PaginationComponent-B7oUaTtf.js";import{F as G,C as z,T as J,A as K}from"./AdminActionBtns-PaC7nhCy.js";import{A as Q}from"./ActiveBadge-BXEiEaOc.js";import{F as W}from"./FormFloat-Db_S_ZFv.js";import{a as X,F as Y,C as Z}from"./CopyBtn-BvtYCAD1.js";import"./XBtn-B0M9M9ci.js";import"./scrollStore-B5RPOzgy.js";import"./LoadingBtn-BV10FGmM.js";var tt={VITE_URL:"https://ec-course-api.hexschool.io/v2",VITE_PATH:"jiayu",BASE_URL:"/Chocolate-Shop/",MODE:"production",DEV:!1,PROD:!0,SSR:!1};const{VITE_URL:E,VITE_PATH:U}=tt,et={components:{FormModal:G,FormFloat:W,ChecksRadio:z,CropperComponent:X,FileInput:Y,CopyBtn:Z},props:{id:String,tags:Array,isNew:Boolean,pagination:Object},data(){return{tempArticle:{},tempId:"",tempImageUrl:"",tempTag:"",isTagDuplicate:!1,loading:!0}},methods:{async showModal(){this.$refs.articleFormModal.showModal()},closeModal(){this.$refs.articleFormModal.closeModal()},async getSingleArticle(s){try{this.loadingStatus.editArticle=!0;const e=`${E}/api/${U}/admin/article/${s}`,p=await this.$http.get(e);this.tempArticle=p.data.article,Array.isArray(this.tempArticle.tag)||(this.tempArticle.tag=[]),this.loadingStatus.editArticle=!1}catch(e){this.loadingStatus.editArticle=!1,this.apiErrorSwal(e,this.$refs.articleFormModal)}},resetModalForm(){this.$refs.articleForm.resetForm(),this.tempArticle.image="",this.tempTag="",this.isTagDuplicate=!1},addImageUrl(s){this.tempArticle.image=s},addTag(){if(this.tempArticle.tag.includes(this.tempTag)){this.isTagDuplicate=!0;return}this.tempArticle.tag.push(this.tempTag),this.tempTag=""},async updateArticle(){try{let s=`${E}/api/${U}/admin/article`,e="post",p=1;this.tempArticle.create_at=Math.floor(new Date().getTime()/1e3);const C=`已${this.isNew?"新增":"更新"}文章「${this.tempArticle.title}」`;this.isNew||(s+=`/${this.tempArticle.id}`,e="put",p=this.pagination.current_page,this.loadingStatus.articleId=this.tempArticle.id),this.closeModal(),await this.$http[e](s,{data:this.tempArticle}),this.resetModalForm(),this.$emit("getData",p),this.loadingStatus.articleId="",this.swalToast(C)}catch(s){this.loadingStatus.articleId="",this.apiErrorSwal(s)}},...y(R,["swalToast","apiErrorSwal"]),...y(S,["showLoading","hideLoading"])},computed:{...P(S,["loadingStatus"])}},ot={class:"flex justify-between items-end mb-3"},st=t("h4",{class:"text-xl font-bold text-primary-800"},"圖片",-1),it={class:"pb-4 md:pb-8 mb-4 border-b border-primary-700"},lt=t("p",{class:"mb-2"},"請選擇圖片檔案或貼上圖片網址：",-1),at={class:"flex mb-5"},rt=["disabled"],nt={key:1,class:"mb-3 md:w-1/2"},dt={class:"relative border-2 border-primary-300 rounded-md p-1"},ct=["src"],mt=t("i",{class:"bi bi-trash-fill"},null,-1),pt=[mt],ut=t("h4",{class:"text-xl font-bold text-primary-800 mb-4"},"文字",-1),ht={class:"flex flex-col gap-3"},gt={class:"flex gap-3"},_t={class:"w-1/2"},bt={class:"w-1/2"},ft={class:"flex w-fill md:w-1/2"},At={id:"tagList"},yt=["value"],xt={key:0,class:"text-red-600"},wt={key:1,class:"flex flex-wrap gap-1"},vt=["onClick"],Tt=t("i",{class:"bi bi-x text-lg transition duration-150 group-hover:text-orange-700"},null,-1),St={class:"mt-5 text-end"},Ct=t("button",{type:"submit",class:"btn btn-primary"}," 儲存編輯",-1);function It(s,e,p,C,o,u){const I=c("CropperComponent"),M=c("FileInput"),_=c("FormFloat"),V=c("CopyBtn"),f=c("VField"),x=c("ChecksRadio"),n=c("VForm"),w=c("LoadingOverlay"),N=c("FormModal");return r(),O(N,{target:"article",ref:"articleFormModal",onResetForm:u.resetModalForm},{title:d(({titleClass:b})=>[t("h3",{class:h(b)},g(p.isNew?"新增":"編輯")+"文章",3)]),default:d(()=>[l(n,{ref:"articleForm",onSubmit:u.updateArticle},{default:d(({errors:b})=>[t("div",ot,[st,l(I,{"down-name":"文章"})]),t("div",it,[o.tempArticle.image?(r(),m("div",nt,[t("div",dt,[t("img",{src:o.tempArticle.image,class:"object-cover rounded-sm",alt:"產品圖"},null,8,ct),l(V,{text:o.tempArticle.image,msg:"圖片網址",class:"absolute right-0 bottom-0 p-1 rounded-md bg-primary-50 text-primary-800 duration-150 hover:text-primary-300"},null,8,["text"]),t("button",{type:"button",class:"absolute right-0 top-0 p-1 rounded-md bg-primary-50 text-primary-800 duration-150 hover:text-red-500 focus:text-red-500",onClick:e[2]||(e[2]=i=>o.tempArticle.image="")},pt)])])):(r(),m(A,{key:0},[lt,l(M,{"return-url":!0,onEmitChange:u.addImageUrl,class:"mb-3",isLoading:s.loadingStatus.imageUrl},null,8,["onEmitChange","isLoading"]),t("div",at,[l(_,{"label-for":"imageUrl",label:"圖片網址",class:"flex-grow"},{default:d(({inputClass:i})=>[F(t("input",{type:"text",name:"文章圖片",id:"imageUrl",class:h([i,"rounded-r-none"]),"onUpdate:modelValue":e[0]||(e[0]=a=>o.tempImageUrl=a),placeholder:""},null,2),[[k,o.tempImageUrl]])]),_:1}),t("button",{type:"button",class:"btn btn-primary rounded-l-none text-nowrap",disabled:!o.tempImageUrl,onClick:e[1]||(e[1]=i=>o.tempArticle.image=o.tempImageUrl)},"加入圖片",8,rt)])],64))]),ut,t("div",ht,[l(_,{"label-for":"title",label:"標題",errors:b},{default:d(({inputClass:i})=>[l(f,{type:"text",name:"標題",id:"title",modelValue:o.tempArticle.title,"onUpdate:modelValue":e[3]||(e[3]=a=>o.tempArticle.title=a),class:h(i),rules:"required",placeholder:"",required:""},null,8,["modelValue","class"])]),_:2},1032,["errors"]),l(_,{"label-for":"description",label:"簡介",errors:b},{default:d(({inputClass:i})=>[l(f,{type:"text",name:"簡介",id:"description",modelValue:o.tempArticle.description,"onUpdate:modelValue":e[4]||(e[4]=a=>o.tempArticle.description=a),class:h(i),rules:"required",as:"textarea",placeholder:"",required:""},null,8,["modelValue","class"])]),_:2},1032,["errors"]),l(_,{"label-for":"content",label:"內容",errors:b},{default:d(({inputClass:i})=>[l(f,{type:"text",name:"內容",id:"content",modelValue:o.tempArticle.content,"onUpdate:modelValue":e[5]||(e[5]=a=>o.tempArticle.content=a),class:h(i),rules:"required",as:"textarea",placeholder:"",required:""},null,8,["modelValue","class"])]),_:2},1032,["errors"]),t("div",gt,[t("div",_t,[l(_,{"label-for":"author",label:"作者",errors:b},{default:d(({inputClass:i})=>[l(f,{type:"text",name:"作者",id:"author",modelValue:o.tempArticle.author,"onUpdate:modelValue":e[6]||(e[6]=a=>o.tempArticle.author=a),class:h(i),rules:"required",placeholder:"",required:""},null,8,["modelValue","class"])]),_:2},1032,["errors"])]),t("div",bt,[l(x,{"label-for":"isPublic",label:"是否發佈"},{default:d(({inputClass:i})=>[F(t("input",{id:"isPublic",class:h(i),type:"checkbox","onUpdate:modelValue":e[7]||(e[7]=a=>o.tempArticle.isPublic=a)},null,2),[[q,o.tempArticle.isPublic]])]),_:1})])]),t("div",ft,[l(_,{"label-for":"tag",label:"標籤",errors:b,class:"flex-grow"},{default:d(({inputClass:i})=>[F(t("input",{type:"text",list:"tagList",name:"標籤",id:"tag",class:h(["rounded-r-none",i]),"onUpdate:modelValue":e[8]||(e[8]=a=>o.tempTag=a),placeholder:"",onInput:e[9]||(e[9]=a=>o.isTagDuplicate=!1)},null,34),[[k,o.tempTag]]),t("datalist",At,[(r(!0),m(A,null,T(p.tags,a=>(r(),m("option",{key:a,value:a},g(a),9,yt))),128))])]),_:2},1032,["errors"]),t("button",{type:"button",class:"btn btn-primary rounded-l-none text-nowrap",onClick:e[10]||(e[10]=(...i)=>u.addTag&&u.addTag(...i))}," 加入標籤 ")]),o.isTagDuplicate?(r(),m("span",xt,"已有「"+g(o.tempTag)+"」標籤",1)):D("",!0),Array.isArray(o.tempArticle.tag)?(r(),m("ul",wt,[(r(!0),m(A,null,T(o.tempArticle.tag,(i,a)=>(r(),m("li",{key:`${o.tempArticle.id}-${i}`},[t("button",{type:"button",class:"group flex items-center py-1 px-2 rounded-xl bg-primary-200 text-primary-800 text-center text-sm text-nowrap",onClick:Qt=>o.tempArticle.tag.splice(a,1)},[Tt,v(" "+g(i),1)],8,vt)]))),128))])):D("",!0),t("div",St,[t("button",{type:"button",class:"btn btn-outline-primary me-3",onClick:e[11]||(e[11]=i=>{u.closeModal(),u.resetModalForm()})}," 取消編輯"),Ct])])]),_:1},8,["onSubmit"]),l(w,{active:s.loadingStatus.editArticle,"is-full-page":!1,color:"#5C270D"},null,8,["active"])]),_:1},8,["onResetForm"])}const Mt=B(et,[["render",It]]);var Vt={VITE_URL:"https://ec-course-api.hexschool.io/v2",VITE_PATH:"jiayu",BASE_URL:"/Chocolate-Shop/",MODE:"production",DEV:!1,PROD:!0,SSR:!1};const{VITE_URL:L,VITE_PATH:$}=Vt,Ft={components:{TableComponent:J,PaginationComponent:H,AdminActionBtns:K,ArticleModal:Mt,ActiveBadge:Q},data(){return{articles:[],tempId:"",isNew:!1,pagination:{},tags:[]}},mounted(){this.showLoading(),this.getAdminArticles()},methods:{async getAdminArticles(s=1){try{const e=`${L}/api/${$}/admin/articles?page=${s}`,p=await this.$http.get(e);this.articles=p.data.articles,this.pagination=p.data.pagination,this.tags=this.handleArrayInData(this.articles,"tag"),this.hideLoading()}catch(e){this.hideLoading(),this.apiErrorSwal(e)}},async delArticle(s){try{if((await this.delSwal("優惠券",s.title)).isConfirmed){this.loadingStatus.articleId=s.id;const p=`${L}/api/${$}/admin/article/${s.id}`;await this.$http.delete(p),this.getAdminArticles(),this.swalToast(`已刪除優惠券「${s.title}」`),this.loadingStatus.articleId=""}}catch(e){this.loadingStatus.articleId="",this.apiErrorSwal(e)}},async openModal(s,e){switch(this.$refs.articleModal.showModal(),s){case"new":this.tempArticle={isPublic:!1,tag:[]},this.isNew=!0;break;case"edit":await this.$refs.articleModal.getSingleArticle(e.id),this.isNew=!1;break}},...y(R,["delSwal","swalToast","apiErrorSwal"]),...y(S,["showLoading","hideLoading"]),...y(j,["timestampToDate","handleArrayInData"])},computed:{...P(S,["isLoading","loadingStatus"])}},Dt={class:"flex justify-between items-center mb-8"},kt=t("h2",{class:"text-2xl font-bold"},"文章管理",-1),Et=t("i",{class:"bi bi-plus-lg me-1"},null,-1),Ut=t("th",{scope:"col"},"標題",-1),Lt=t("th",{class:"hidden md:table-cell",scope:"col"},"簡介",-1),$t=t("th",{scope:"col"},"圖片",-1),Pt=t("th",{scope:"col"},"標籤",-1),Bt=t("th",{scope:"col"},"最後更新",-1),Rt=t("th",{class:"hidden md:table-cell text-nowrap",scope:"col"},"作者",-1),Nt=t("th",{scope:"col"},"發布",-1),Ot=t("th",{scope:"col"},null,-1),qt={class:"hidden md:table-cell"},jt={class:"w-12 h-9 md:w-16 md:h-12"},Ht=["src"],Gt={key:0,class:"flex flex-wrap gap-1"},zt={class:"hidden md:table-cell text-nowrap"},Jt={class:"text-center"};function Kt(s,e,p,C,o,u){const I=c("ActiveBadge"),M=c("AdminActionBtns"),_=c("TableComponent"),V=c("PaginationComponent"),f=c("ArticleModal");return r(),m(A,null,[t("div",Dt,[kt,t("button",{type:"button",class:"btn btn-primary",onClick:e[0]||(e[0]=x=>u.openModal("new"))},[Et,v("新增文章 ")])]),l(_,{class:"mb-8"},{th:d(()=>[Ut,Lt,$t,Pt,Bt,Rt,Nt,Ot]),tr:d(({trClass:x})=>[(r(!0),m(A,null,T(o.articles,n=>(r(),m("tr",{class:h(x),key:n.id},[t("td",null,g(n.title),1),t("td",qt,g(n.description),1),t("td",null,[t("div",jt,[t("img",{lazy:"loading",class:"rounded-md bg-cover",src:n.image,alt:"文章圖"},null,8,Ht)])]),t("td",null,[Array.isArray(n.tag)?(r(),m("ul",Gt,[(r(!0),m(A,null,T(n.tag,w=>(r(),m("li",{class:"py-1 px-2 rounded-xl bg-primary-200 text-primary-800 text-center text-xs md:text-sm text-nowrap",key:`${n.id}-${w}`},g(w),1))),128))])):D("",!0)]),t("td",null,[t("span",null,g(s.timestampToDate(n.create_at)),1)]),t("td",zt,g(n.author),1),t("td",Jt,[l(I,{active:n.isPublic},{trueMsg:d(()=>[v("發布")]),falseMsg:d(()=>[v("下架")]),_:2},1032,["active"])]),t("td",null,[l(M,{data:n,id:n.id,loadingId:"articleId",onOpenModal:u.openModal,onDelItem:u.delArticle},null,8,["data","id","onOpenModal","onDelItem"])])],2))),128))]),_:1}),l(V,{pagination:o.pagination,onGetData:u.getAdminArticles},null,8,["pagination","onGetData"]),l(f,{ref:"articleModal",id:o.tempId,"is-new":o.isNew,pagination:o.pagination,tags:o.tags,onGetData:u.getAdminArticles},null,8,["id","is-new","pagination","tags","onGetData"])],64)}const ne=B(Ft,[["render",Kt]]);export{ne as default};
