import{F as U}from"./FormFloat-D_CBaRNd.js";import{m as I,a as M,_ as b,o as a,e as u,g,b as n,d,n as _,r as f,f as B,w as c,L as D,j as x,D as C,c as F,F as k,h as N,T as E,t as L}from"./index-DSvEBgKx.js";import{I as T}from"./LoadingBtn-BE7AR8Ew.js";import{l as V}from"./loadingStore-CRsAEdG-.js";import{s as z}from"./swalStore-rAKyBXMr.js";import{F as R}from"./AdminActionBtns-Ck8GrL7y.js";var j={VITE_URL:"https://ec-course-api.hexschool.io/v2",VITE_PATH:"jiayu",BASE_URL:"/Chocolate-Shop/",MODE:"production",DEV:!1,PROD:!0,SSR:!1};const{VITE_URL:w,VITE_PATH:v}=j,A={data(){return{isDragfile:!1}},components:{IconLoading:T},props:{returnUrl:{type:Boolean,default:!1},isMultiple:{type:Boolean,default:!1},isLoading:{type:Boolean}},methods:{handleChange(o){this.returnUrl?this.isMultiple?this.uploadMultiImg(o):this.uploadImg(o):this.$emit("emitChange",o)},async uploadImg(o){try{this.loadingStatus.imageUrl=!0;const e=o.target.files[0],i=new FormData;i.append("file-to-upload",e);const p=`${w}/api/${v}/admin/upload`,{data:t}=await this.$http.post(p,i);this.$emit("emitChange",t.imageUrl),this.loadingStatus.imageUrl=!1}catch(e){this.loadingStatus.imageUrl=!1;const i=o.target.closest("dialog");this.apiErrorSwal(e,i)}},async uploadMultiImg(o){try{this.loadingStatus.imagesUrl=!0;const{files:e}=o.target,i=`${w}/api/${v}/admin/upload`,p=Object.values(e).map(async m=>{const s=new FormData;return s.append("file-to-upload",m),(await this.$http.post(i,s)).data.imageUrl}),t=await Promise.all(p);this.$emit("emitChange",t);const r=o.target;r.value="",this.loadingStatus.imagesUrl=!1}catch(e){this.loadingStatus.imagesUrl=!1;const i=o.target.closest("dialog");this.apiErrorSwal(e,i)}},...I(z,["apiErrorSwal"])},computed:{...M(V,["loadingStatus"])}},$=n("i",{class:"bi bi-file-earmark-image-fill text-2xl"},null,-1),P=n("p",null,"請拖曳圖片檔案到此區，或點擊後選取圖片檔案",-1),H={key:0},O=n("p",null,"PNG、JPG、JPEG，檔案大小須為 3MB 以下",-1),W=["multiple","disabled"],G={key:1,class:"absolute flex h-full w-full items-center justify-center bg-primary-50 opacity-80"};function J(o,e,i,p,t,r){const m=f("IconLoading");return a(),u("label",{ref:"input",for:"imageInput",class:_(["relative flex w-full cursor-pointer flex-col items-center justify-center rounded-md border-4 p-4 text-center text-sm text-stone-400 duration-150 hover:bg-stone-100 md:text-base",t.isDragfile?"border-primary-300":"border-dashed border-stone-300"])},[$,P,i.isMultiple?(a(),u("p",H,"可上傳多個檔案")):g("",!0),O,n("input",{class:"absolute h-full w-full cursor-pointer opacity-0",type:"file",accept:".png, .jpg, .jpeg",id:"imageInput",ref:"imageFile",title:"",multiple:i.isMultiple,disabled:i.isLoading,onChange:e[0]||(e[0]=(...s)=>r.handleChange&&r.handleChange(...s)),onDragover:e[1]||(e[1]=s=>t.isDragfile=!0),onDrop:e[2]||(e[2]=s=>t.isDragfile=!1),onDragleave:e[3]||(e[3]=s=>t.isDragfile=!1)},null,40,W),i.isLoading?(a(),u("div",G,[d(m,{size:"lg"})])):g("",!0)],2)}const q=b(A,[["render",J]]),K={data(){return{previews:{},cropperUrl:"",fileName:this.downName,option:{img:"",info:!0,outputSize:1,full:!0,outputType:"png",original:!1,canScale:!1,canMove:!1,canMoveBox:!0,autoCrop:!0,autoCropWidth:750,autoCropHeight:500,centerBox:!0,high:!0,maxImgSize:99999,mode:"contain"},fixed:!0,fixedNumber:[4,3]}},components:{FormFloat:U,FileInput:q,FormModal:R},props:{downName:String},watch:{downName(){this.fileName=this.downName}},methods:{upload(o){if(o.target.files.length){const e=o.target.files[0],i=new FileReader;i.onload=p=>{const t=window.URL.createObjectURL(new Blob([p.target.result]));this.option.img=t},i.readAsArrayBuffer(e)}},download(){const o=document.createElement("a");o.download=this.fileName,this.$refs.cropper.getCropBlob(e=>{this.cropperUrl=window.URL.createObjectURL(e),o.href=this.cropperUrl,o.click()})},clear(){this.option.img=""}}},Q=n("i",{class:"bi bi-scissors mr-1"},null,-1),X=n("p",{class:"mb-2"},"請選擇圖片檔案或貼上圖片網址：",-1),Y=n("i",{class:"bi bi-x text-xl"},null,-1),Z=[Y],ee={key:0,class:"h-[200px] w-full md:h-[400px]"},te={class:"mt-5 flex"};function oe(o,e,i,p,t,r){const m=f("FileInput"),s=f("FormFloat"),y=f("VueCropper"),S=f("FormModal");return a(),u(k,null,[n("button",{type:"button",class:"btn btn-primary-light",onClick:e[0]||(e[0]=l=>o.$refs.cropperModal.showModal())},[Q,B("裁剪圖片小工具 ")]),d(S,{ref:"cropperModal",target:"cropperModal",onResetForm:r.clear},{title:c(({titleClass:l})=>[n("h3",{class:_(l)},"裁剪圖片小工具",2)]),default:c(()=>[X,d(m,{onEmitChange:r.upload,class:"mb-3"},null,8,["onEmitChange"]),d(s,{"label-for":"imgUrl",label:"圖片網址",class:"mb-3"},D({default:c(({inputClass:l})=>[x(n("input",{type:"text",name:"圖片",id:"imgUrl",class:_(l),"onUpdate:modelValue":e[1]||(e[1]=h=>t.option.img=h),placeholder:""},null,2),[[C,t.option.img]])]),_:2},[t.option.img?{name:"icon",fn:c(({iconClass:l})=>[n("button",{type:"button",class:_(l),onClick:e[2]||(e[2]=(...h)=>r.clear&&r.clear(...h))},Z,2)]),key:"0"}:void 0]),1024),t.option.img?(a(),u("div",ee,[d(y,{ref:"cropper",img:t.option.img,"center-wrapper":"","output-size":t.option.outputSize,"output-type":t.option.outputType,info:t.option.info,full:t.option.full,fixed:t.fixed,"fixed-number":t.fixedNumber,"can-move":t.option.canMove,"can-move-box":t.option.canMoveBox,"can-scale":t.option.canScale,original:t.option.original,"auto-crop":t.option.autoCrop,autoCropWidth:t.option.autoCropWidth,autoCropHeight:t.option.autoCropHeight,"center-box":t.option.centerBox,high:t.option.high,"max-img-size":t.option.maxImgSize,mode:t.option.mode},null,8,["img","output-size","output-type","info","full","fixed","fixed-number","can-move","can-move-box","can-scale","original","auto-crop","autoCropWidth","autoCropHeight","center-box","high","max-img-size","mode"])])):g("",!0),n("div",te,[t.option.img?(a(),F(s,{key:0,"label-for":"fileName",label:"下載的檔案名稱",class:"flex-grow"},{default:c(({inputClass:l})=>[x(n("input",{type:"text",name:"檔案名稱",id:"fileName",class:_(["rounded-r-none",l]),"onUpdate:modelValue":e[3]||(e[3]=h=>t.fileName=h),placeholder:""},null,2),[[C,t.fileName]])]),_:1})):g("",!0),t.option.img?(a(),u("button",{key:1,type:"button",class:"btn btn-primary text-nowrap rounded-l-none",onClick:e[4]||(e[4]=(...l)=>r.download&&r.download(...l))}," 下載 ")):g("",!0)])]),_:1},8,["onResetForm"])],64)}const Fe=b(K,[["render",oe]]),ie={};function ne(o,e){return a(),F(E,{name:"fade","enter-active-class":"animate__animated animate__fadeIn animate__faster","leave-active-class":"animate__animated animate__fadeOut animate__faster",onAfterLeave:e[0]||(e[0]=i=>o.$emit("onAfterLeave"))},{default:c(()=>[N(o.$slots,"default")]),_:3})}const re=b(ie,[["render",ne]]),se={data(){return{isCopy:!1,isFail:!1}},components:{TransitionFade:re},props:{text:{type:String},msg:{type:String}},methods:{async copy(o){try{await navigator.clipboard.writeText(o),this.isFail=!1,this.isCopy=!0,setTimeout(()=>{this.isCopy=!1},700)}catch{this.isFail=!0}}}},ae={class:"relative"},le=n("i",{class:"bi bi-copy"},null,-1),pe={key:0,class:"absolute bottom-full right-0 isolate z-10 m-1 text-nowrap rounded bg-primary-100 p-1 text-sm text-primary-800 shadow-sm"};function me(o,e,i,p,t,r){const m=f("TransitionFade");return a(),u("button",{type:"button",onClick:e[0]||(e[0]=s=>r.copy(i.text))},[n("div",ae,[le,d(m,null,{default:c(()=>[t.isCopy?(a(),u("div",pe,L(t.isFail?"複製失敗":`已複製${i.msg}`),1)):g("",!0)]),_:1})])])}const ue=b(se,[["render",me]]),ce={props:{image:String},components:{CopyBtn:ue}},de={class:"relative rounded-md border-2 border-primary-300 p-1"},fe=["src"],ge=n("i",{class:"bi bi-trash-fill"},null,-1),he=[ge];function _e(o,e,i,p,t,r){const m=f("CopyBtn");return a(),u("div",de,[n("img",{loading:"lazy",src:i.image,class:"rounded-sm object-cover",alt:"產品圖"},null,8,fe),d(m,{text:i.image,msg:"圖片網址",class:"absolute bottom-0 right-0 rounded-md bg-primary-50 p-1 text-primary-800 duration-150 hover:text-primary-300"},null,8,["text"]),n("button",{type:"button",class:"absolute right-0 top-0 rounded-md bg-primary-50 p-1 text-primary-800 duration-150 hover:text-red-500 focus:text-red-500",onClick:e[0]||(e[0]=s=>o.$emit("handleDelete"))},he)])}const Se=b(ce,[["render",_e]]);export{Fe as C,Se as E,q as F};
