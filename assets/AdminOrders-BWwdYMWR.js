import{q as E,m as f,h as F,_ as D,o as _,e as T,w as i,b as e,n as p,a as d,j as O,v as C,l as U,c as g,k as $,F as w,t as c,g as N,r as h,d as R,s as B}from"./index-DVC19zHe.js";import{M as j,C as G,T as I,s as L,h as P,P as H,A as J}from"./AdminActionBtns-BHZMKv17.js";import{l as V}from"./loadingStore-D7WRynS8.js";import{F as z}from"./FormFloat-CUjVlUZ5.js";const K=E("validateStore",{actions:{isPhone(o){return/^(09)[0-9]{8}$/.test(o)?!0:"須為有效的手機號碼"}}}),Q={components:{ModalComponent:j,FormFloat:z,ChecksRadio:G,TableComponent:I},props:{order:Object,pagination:Object},data(){return{tempOrder:{},orderDate:""}},mounted(){this.tempOrder=this.order},watch:{order(){this.tempOrder=this.order,this.orderDate=this.handleDate(this.order.create_at)}},methods:{showModal(){this.$refs.orderModalComponent.showModal()},closeModal(){this.$refs.orderModalComponent.closeModal()},resetModalForm(){this.$refs.orderForm.resetForm()},async modalPutOrder(){this.tempOrder.total=this.total,this.closeModal(),this.$emit("putOrder",this.tempOrder),this.resetModalForm()},...f(L,["swalToast"]),...f(V,["showLoading","hideLoading"]),...f(K,["isPhone"]),...f(P,["handleDate"])},computed:{total(){return Object.values(this.tempOrder.products).reduce((t,l)=>t+l.product.price*l.qty,0)},...F(V,["loadingStatus"])}},W=e("h4",{class:"text-xl font-bold text-primary-800 mb-3"},"訂單資訊",-1),X={class:"flex gap-3 mb-3"},Y={class:"w-1/2"},Z={class:"w-1/2"},ee={class:"mb-6"},te=e("h4",{class:"text-xl font-bold text-primary-800 mb-3"},"客戶資訊",-1),se={class:"flex flex-col gap-3 mb-6"},oe=e("h4",{class:"text-xl font-bold text-primary-800 mb-3"},"訂單產品",-1),le=e("th",{scope:"col"}," 產品 ",-1),ae=e("th",{scope:"col",class:"min-w-10"}," 數量 ",-1),re=e("th",{scope:"col",class:"min-w-8 text-end"}," 小計 ",-1),ne={class:"flex items-center gap-2"},de={class:"w-12 h-9 overflow-hidden rounded-sm"},ie=["src"],ce=["id","onUpdate:modelValue"],me=["value"],pe={class:"text-end"},ue={class:"border-none"},he={colspan:"3",class:"py-2 text-end md:pr-4"},_e={class:"mt-5 text-end"},be=e("button",{type:"submit",class:"btn btn-primary"}," 儲存編輯",-1);function ge(o,t,l,q,r,m){const b=h("FormFloat"),M=h("ChecksRadio"),y=h("VField"),S=h("TableComponent"),v=h("VForm"),n=h("ModalComponent");return _(),T(n,{target:"order",ref:"orderModalComponent",onResetForm:m.resetModalForm},{title:i(({titleClass:u})=>[e("h3",{class:p(u)},"編輯訂單",2)]),default:i(()=>[Object.keys(r.tempOrder).length!==0?(_(),T(v,{key:0,ref:"orderForm",onSubmit:m.modalPutOrder},{default:i(({errors:u})=>[W,e("div",X,[e("div",Y,[d(b,{"label-for":"date",label:"訂單日期"},{default:i(({inputClass:a})=>[O(e("input",{type:"text",name:"訂單日期",id:"date","onUpdate:modelValue":t[0]||(t[0]=s=>r.orderDate=s),class:p(a),readonly:""},null,2),[[C,r.orderDate]])]),_:1})]),e("div",Z,[d(b,{"label-for":"total",label:"總額"},{default:i(({inputClass:a})=>[O(e("input",{type:"number",name:"總額",id:"total","onUpdate:modelValue":t[1]||(t[1]=s=>r.tempOrder.total=s),class:p(a),readonly:""},null,2),[[C,r.tempOrder.total,void 0,{number:!0}]])]),_:1})])]),e("div",ee,[d(M,{"label-for":"is_paid",label:"是否付款"},{default:i(({inputClass:a})=>[O(e("input",{type:"checkbox",name:"是否付款",id:"is_paid","onUpdate:modelValue":t[2]||(t[2]=s=>r.tempOrder.is_paid=s),class:p(a)},null,2),[[U,r.tempOrder.is_paid]])]),_:1})]),te,e("div",se,[d(b,{"label-for":"userName",label:"姓名",errors:u},{default:i(({inputClass:a})=>[d(y,{type:"text",name:"姓名",id:"userName",modelValue:r.tempOrder.user.name,"onUpdate:modelValue":t[3]||(t[3]=s=>r.tempOrder.user.name=s),class:p(a),rules:"required",placeholder:""},null,8,["modelValue","class"])]),_:2},1032,["errors"]),d(b,{"label-for":"userTel",label:"手機號碼",errors:u},{default:i(({inputClass:a})=>[d(y,{type:"tel",name:"手機號碼",id:"userTel",modelValue:r.tempOrder.user.tel,"onUpdate:modelValue":t[4]||(t[4]=s=>r.tempOrder.user.tel=s),class:p(a),rules:o.isPhone,placeholder:""},null,8,["modelValue","class","rules"])]),_:2},1032,["errors"]),d(b,{"label-for":"userEmail",label:"電子信箱",errors:u},{default:i(({inputClass:a})=>[d(y,{type:"email",name:"電子信箱",id:"userEmail",modelValue:r.tempOrder.user.email,"onUpdate:modelValue":t[5]||(t[5]=s=>r.tempOrder.user.email=s),class:p(a),rules:"email|required",placeholder:""},null,8,["modelValue","class"])]),_:2},1032,["errors"]),d(b,{"label-for":"userAddress",label:"地址",errors:u},{default:i(({inputClass:a})=>[d(y,{type:"text",name:"地址",id:"userAddress",modelValue:r.tempOrder.user.address,"onUpdate:modelValue":t[6]||(t[6]=s=>r.tempOrder.user.address=s),class:p(a),rules:"required",placeholder:""},null,8,["modelValue","class"])]),_:2},1032,["errors"]),d(b,{"label-for":"message",label:"備註",errors:u},{default:i(({inputClass:a})=>[O(e("textarea",{type:"text",name:"備註",id:"message","onUpdate:modelValue":t[7]||(t[7]=s=>r.tempOrder.message=s),class:p(a),placeholder:""},null,2),[[C,r.tempOrder.message]])]),_:2},1032,["errors"]),oe,d(S,{class:"mb-8"},{th:i(()=>[le,ae,re]),tr:i(({trClass:a})=>[(_(!0),g(w,null,$(l.order.products,s=>(_(),g("tr",{class:p(a),key:s.id},[e("td",null,[e("div",ne,[e("div",de,[e("img",{src:s.product.imageUrl,alt:"產品圖"},null,8,ie)]),R(" "+c(s.product.title),1)])]),e("td",null,[O(e("select",{class:"form-control",name:"qty",id:`${s.id}qty`,"onUpdate:modelValue":x=>s.qty=x},[(_(),g(w,null,$(20,x=>e("option",{key:`${s.id}${x}`,value:x},c(x),9,me)),64))],8,ce),[[B,s.qty,void 0,{number:!0}]])]),e("td",pe,c(s.product.price*s.qty),1)],2))),128)),e("tr",ue,[e("td",he,"總計："+c(m.total),1)])]),_:1}),e("div",_e,[e("button",{type:"button",class:"btn btn-outline-primary me-3",onClick:t[8]||(t[8]=a=>{m.closeModal(),m.resetModalForm()})}," 取消編輯"),be])])]),_:1},8,["onSubmit"])):N("",!0)]),_:1},8,["onResetForm"])}const fe=D(Q,[["render",ge]]);var ye={VITE_URL:"https://ec-course-api.hexschool.io/v2",VITE_PATH:"jiayu",BASE_URL:"/Chocolate-Shop/",MODE:"production",DEV:!1,PROD:!0,SSR:!1};const{VITE_URL:k,VITE_PATH:A}=ye,Oe={components:{TableComponent:I,PaginationComponent:H,OrderModal:fe,AdminActionBtns:J},data(){return{orders:[],tempOrder:{},tempUser:{},pagination:{}}},mounted(){this.showLoading(),this.getAdminOrders()},methods:{handleTelLink(o){let t=o.replace(/[^\d]/g,"").substring(1);return t[0]!=="9"&&(t=t.replace(/(\d{1})(\d{8})/,"$1-$2")),t=`tel:+886-${t}`,t},async getAdminOrders(o=1){try{const t=`${k}/api/${A}/admin/orders?page=${o}`,l=await this.$http.get(t);this.orders=l.data.orders,this.pagination=l.data.pagination,this.hideLoading()}catch(t){this.hideLoading();const{message:l}=t.response.data;this.$swal(Array.isArray(l)?l[0]:l)}},async delOrder(o){try{if((await this.delSwal("訂單編號",o.num)).isConfirmed){this.loadingStatus.orderId=o.id;const l=`${k}/api/${A}/admin/order/${o.id}`;await this.$http.delete(l),this.getAdminOrders(),this.swalToast(`已刪除編號「${o.num}」訂單`),this.loadingStatus.orderId=""}}catch(t){this.loadingStatus.orderId="";const{message:l}=t.response.data;this.$swal(Array.isArray(l)?l[0]:l)}},async putOrder(o){try{this.loadingStatus.orderId=o.id;const t=`${k}/api/${A}/admin/order/${o.id}`,l=`已修改編號「${o.num}」訂單`;await this.$http.put(t,{data:o}),this.getAdminOrders(),this.swalToast(l),this.loadingStatus.orderId=""}catch(t){this.loadingStatus.orderId="";const{message:l}=t.response.data;this.$swal(Array.isArray(l)?l[0]:l)}},openModal(o){this.tempOrder=JSON.parse(JSON.stringify(o)),this.$refs.orderModal.showModal()},...f(L,["delSwal","swalToast"]),...f(V,["showLoading","hideLoading"]),...f(P,["handleDate"])},computed:{...F(V,["isLoading","loadingStatus"])}},xe=e("h2",{class:"text-2xl font-bold mb-8"},"訂單管理",-1),we=e("th",{scope:"col"},"#",-1),$e=e("th",{scope:"col"},"客戶",-1),Ve=e("th",{scope:"col"},"連絡",-1),Me=e("th",{scope:"col",class:"min-w-15"},"品項",-1),Se=e("th",{scope:"col",class:"text-end"},"總額",-1),ve=e("th",{scope:"col",class:"min-w-15"},"備註",-1),Ce=e("th",{scope:"col"},"日期",-1),ke=e("th",{scope:"col"},"付款",-1),Ae=e("th",{scope:"col"},null,-1),Te={class:"py-2 pr-1"},Fe={class:"text-center md:text-start"},De=["href"],Ue={class:"hidden md:inline"},Ie=e("i",{class:"bi bi-envelope-arrow-up-fill text-primary-700 md:hidden"},null,-1),Le=["href"],Pe={class:"hidden md:inline"},qe=e("i",{class:"bi bi-telephone-outbound-fill text-primary-700 md:hidden"},null,-1),Ee={class:"text-end"},Ne={class:"line-clamp-5"},Re={class:"hidden md:inline"},Be={class:"md:hidden"},je=["for"],Ge=["id","onUpdate:modelValue","disabled","onChange"],He=e("div",{class:"w-4 h-4 flex items-center justify-center bg-primary-50 text-primary-800 border border-primary-800 rounded-full ml-[50%] transition-all duration-150 bg-icon-x bg-center bg-no-repeat peer-checked:bg-icon-check peer-checked:ml-[0%] peer-checked:border-primary-300 peer-disabled:border-stone-300"},null,-1);function Je(o,t,l,q,r,m){const b=h("AdminActionBtns"),M=h("TableComponent"),y=h("PaginationComponent"),S=h("OrderModal");return _(),g(w,null,[xe,d(M,{class:"mb-8 text-xs sm:text-sm md:text-base"},{th:i(()=>[we,$e,Ve,Me,Se,ve,Ce,ke,Ae]),tr:i(({trClass:v})=>[(_(!0),g(w,null,$(r.orders,(n,u)=>(_(),g("tr",{class:p(v),key:n.id},[e("td",null,c(n.num),1),e("td",Te,[e("p",null,c(n.user.name),1)]),e("td",Fe,[e("a",{class:"link block",href:`mailto:${n.user.email}`},[e("span",Ue,c(n.user.email),1),Ie],8,De),e("a",{class:"link block",href:m.handleTelLink(n.user.tel)},[e("span",Pe,c(n.user.tel),1),qe],8,Le)]),e("td",null,[(_(!0),g(w,null,$(n.products,(a,s)=>(_(),g("p",{key:s},c(`${a.product.title} * ${a.qty}`),1))),128))]),e("td",Ee,c(n.total),1),e("td",null,[e("span",Ne,c(n.message),1)]),e("td",null,[e("span",Re,c(o.handleDate(n.create_at)),1),e("span",Be,c(o.handleDate(n.create_at).substring(5)),1)]),e("td",null,[e("label",{for:`paidStatus${u}`,class:"inline-flex w-8 h-4 items-center cursor-pointer bg-primary-800 rounded-full transition-all duration-150 has-[:checked]:bg-primary-300 has-[:disabled]:bg-stone-300 has-[:disabled]:cursor-default"},[O(e("input",{type:"checkbox",id:`paidStatus${u}`,class:"hidden peer","onUpdate:modelValue":a=>n.is_paid=a,disabled:o.loadingStatus.orderId===n.id,onChange:a=>m.putOrder(n)},null,40,Ge),[[U,n.is_paid]]),He],8,je)]),e("td",null,[d(b,{data:n,loadingId:"orderId",onOpenModal:m.openModal,onDelItem:m.delOrder},null,8,["data","onOpenModal","onDelItem"])])],2))),128))]),_:1}),d(y,{pagination:r.pagination,onGetData:m.getAdminOrders},null,8,["pagination","onGetData"]),d(S,{ref:"orderModal",order:r.tempOrder,pagination:r.pagination,onPutOrder:m.putOrder},null,8,["order","pagination","onPutOrder"])],64)}const Xe=D(Oe,[["render",Je]]);export{Xe as default};
