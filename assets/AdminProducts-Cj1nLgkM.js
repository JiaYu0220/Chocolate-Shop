import{m as P,h as F,_ as T,o as m,e as q,w as i,b as t,t as f,n as g,a as s,c as h,j as y,v,F as w,d as C,k as S,g as B,l as j,r as d}from"./index-CQupeNWV.js";import{l as I}from"./loadingStore-BThw59I3.js";import{M as O,L as E,C as H,s as R,P as G,A as $,T as z,h as J}from"./AdminActionBtns-BfxTWaYK.js";import{F as K,C as Q,a as W}from"./CopyBtn-CXzRxPQi.js";import{F as X}from"./FormFloat-BA6fetB_.js";import{A as Y}from"./ActiveBadge-BRg0K-J6.js";var Z={VITE_URL:"https://ec-course-api.hexschool.io/v2",VITE_PATH:"jiayu",BASE_URL:"/Chocolate-Shop/",MODE:"production",DEV:!1,PROD:!0,SSR:!1};const{VITE_URL:tt,VITE_PATH:et}=Z,ot={components:{ModalComponent:O,FormFloat:X,FileInput:K,CopyBtn:Q,LoadingBtn:E,CropperComponent:W,ChecksRadio:H},props:{product:Object,categories:Array,isNew:Boolean,pagination:Object},data(){return{tempProduct:{},tempImageUrl:"",tempImagesUrl:""}},mounted(){this.tempProduct=this.product},watch:{product(){this.tempProduct=this.product}},methods:{showModal(){this.$refs.productModalComponent.showModal()},closeModal(){this.$refs.productModalComponent.closeModal()},resetModalForm(){this.$refs.productForm.resetForm()},addImageUrl(n){this.tempProduct.imageUrl=n},addImagesUrl(n){this.tempProduct.imagesUrl.push(n),this.tempImagesUrl=""},addImagesUrlArray(n){this.tempProduct.imagesUrl.push(...n)},async updateProduct(){try{let n=`${tt}/api/${et}/admin/product`,e="post",a=1;const V=`已${this.isNew?"新增":"更新"}產品「${this.tempProduct.title}」`;this.isNew?this.loadingStatus.newProduct=!0:(n+=`/${this.tempProduct.id}`,e="put",a=this.pagination.current_page,this.loadingStatus.productId=this.tempProduct.id),this.closeModal(),await this.$http[e](n,{data:this.tempProduct}),this.resetModalForm(),this.$emit("getData",a),this.loadingStatus.productId="",this.loadingStatus.newProduct=!1,this.swalToast(V)}catch(n){this.loadingStatus.productId="",this.loadingStatus.newProduct=!1;const{message:e}=n.response.data;this.$swal(Array.isArray(e)?e[0]:e)}},...P(R,["swalToast"]),...P(I,["showLoading","hideLoading"])},computed:{...F(I,["loadingStatus"])}},st={class:"flex justify-between items-end mb-3"},lt=t("h4",{class:"text-xl font-bold text-primary-800"},"圖片",-1),nt=t("p",{class:"text-stone-500 mb-3"},"※ 請先使用裁剪小工具將圖片裁剪成適當長寬比 (4:3) 再上傳！",-1),rt={class:"pb-4 md:pb-8 mb-4 border-b border-primary-700"},it=t("h5",{class:"text-lg mb-1"},"- 主圖 -",-1),at=t("p",{class:"mb-2"},"請選擇圖片檔案或貼上圖片網址：",-1),dt={class:"flex mb-5"},ct=["disabled"],mt={key:1,class:"mb-3 md:w-1/2"},ut={class:"relative border-2 border-primary-300 rounded-md p-1"},pt=["src"],gt=t("i",{class:"bi bi-trash-fill"},null,-1),ht=[gt],_t=t("hr",null,null,-1),bt=t("h5",{class:"text-lg mt-3 mb-1"},"- 其他圖片 -",-1),ft=t("p",{class:"mb-2"},"請選擇圖片檔案或貼上圖片網址：",-1),yt={class:"flex mb-3"},Pt={key:2,class:"grid grid-cols-2 gap-2 md:grid-cols-3 md:gap-3"},wt=["src"],xt=["onClick"],Ut=t("i",{class:"bi bi-trash-fill"},null,-1),vt=[Ut],Ct=t("h4",{class:"text-xl font-bold text-primary-800 mb-4"},"文字",-1),It={class:"flex flex-col gap-3"},Vt={class:"flex gap-3"},At={class:"w-2/3"},Mt={id:"categoryList"},St=["value"],Lt={class:"w-1/3"},kt={class:"flex gap-3"},Ft={class:"w-2/3"},Tt={class:"w-1/3"},Bt=t("hr",null,null,-1),Et={class:"mt-5 text-end"},Rt=t("button",{type:"submit",class:"btn btn-primary"}," 儲存編輯",-1);function Dt(n,e,a,V,o,c){const A=d("CropperComponent"),x=d("FileInput"),u=d("FormFloat"),U=d("CopyBtn"),M=d("LoadingBtn"),_=d("VField"),p=d("ChecksRadio"),D=d("VForm"),N=d("ModalComponent");return m(),q(N,{target:"product",ref:"productModalComponent",onResetForm:c.resetModalForm},{title:i(({titleClass:b})=>[t("h3",{class:g(b)},f(a.isNew?"新增":"編輯")+"產品",3)]),default:i(()=>[s(D,{ref:"productForm",onSubmit:c.updateProduct},{default:i(({errors:b})=>[t("div",st,[lt,s(A,{"down-name":o.tempProduct.title},null,8,["down-name"])]),nt,t("div",rt,[it,o.tempProduct.imageUrl?(m(),h("div",mt,[t("div",ut,[t("img",{src:o.tempProduct.imageUrl,class:"object-cover rounded-sm",alt:"產品圖"},null,8,pt),s(U,{text:o.tempProduct.imageUrl,msg:"圖片網址",class:"absolute right-0 bottom-0 p-1 rounded-md bg-primary-50 text-primary-800 duration-150 hover:text-primary-300"},null,8,["text"]),t("button",{type:"button",class:"absolute right-0 top-0 p-1 rounded-md bg-primary-50 text-primary-800 duration-150 hover:text-red-500 focus:text-red-500",onClick:e[2]||(e[2]=r=>o.tempProduct.imageUrl="")},ht)])])):(m(),h(w,{key:0},[at,s(x,{"return-url":!0,onEmitChange:c.addImageUrl,class:"mb-3",isLoading:n.loadingStatus.imageUrl},null,8,["onEmitChange","isLoading"]),t("div",dt,[s(u,{"label-for":"imageUrl",label:"圖片網址",class:"flex-grow"},{default:i(({inputClass:r})=>[y(t("input",{type:"text",name:"圖片",id:"imageUrl",class:g([r,"rounded-r-none"]),"onUpdate:modelValue":e[0]||(e[0]=l=>o.tempImageUrl=l),placeholder:""},null,2),[[v,o.tempImageUrl]])]),_:1}),t("button",{type:"button",class:"btn btn-primary rounded-l-none text-nowrap",disabled:!o.tempImageUrl,onClick:e[1]||(e[1]=r=>o.tempProduct.imageUrl=o.tempImageUrl)},"加入圖片",8,ct)])],64)),_t,bt,ft,s(x,{"return-url":!0,isMultiple:!0,onEmitChange:c.addImagesUrlArray,isLoading:n.loadingStatus.imagesUrl,class:"mb-3"},null,8,["onEmitChange","isLoading"]),t("div",yt,[s(u,{"label-for":"imageUrl",label:"圖片網址",class:"flex-grow"},{default:i(({inputClass:r})=>[y(t("input",{type:"text",name:"圖片",id:"imageUrl",class:g([r,"rounded-r-none"]),placeholder:"","onUpdate:modelValue":e[3]||(e[3]=l=>o.tempImagesUrl=l)},null,2),[[v,o.tempImagesUrl]])]),_:1}),s(M,{class:"btn btn-primary rounded-l-none text-nowrap",isLoading:n.loadingStatus.imagesUrl,disabled:!o.tempImagesUrl,onClick:e[4]||(e[4]=r=>c.addImagesUrl(o.tempImagesUrl))},{default:i(()=>[C("加入圖片")]),_:1},8,["isLoading","disabled"])]),Array.isArray(o.tempProduct.imagesUrl)?(m(),h("div",Pt,[(m(!0),h(w,null,S(o.tempProduct.imagesUrl,(r,l)=>(m(),h("div",{key:`img${l}`,class:"relative border-2 border-primary-300 rounded-md p-1"},[t("img",{src:r,class:"object-cover",alt:"產品圖"},null,8,wt),t("button",{type:"button",class:"absolute right-0 top-0 p-1 rounded-md bg-primary-50 text-primary-800 duration-150 hover:text-red-500 focus:text-red-500",onClick:se=>o.tempProduct.imagesUrl.splice(l,1)},vt,8,xt),s(U,{text:o.tempProduct.imagesUrl[l],msg:"圖片網址",class:"absolute right-0 bottom-0 p-1 rounded-md bg-primary-50 text-primary-800 duration-150 hover:text-primary-300"},null,8,["text"])]))),128))])):B("",!0)]),Ct,t("div",It,[s(u,{"label-for":"title",label:"名稱",errors:b},{default:i(({inputClass:r})=>[s(_,{type:"text",name:"名稱",id:"title",modelValue:o.tempProduct.title,"onUpdate:modelValue":e[5]||(e[5]=l=>o.tempProduct.title=l),class:g(r),rules:"required",placeholder:"",required:""},null,8,["modelValue","class"])]),_:2},1032,["errors"]),t("div",Vt,[t("div",At,[s(u,{"label-for":"category",label:"類別",errors:b},{default:i(({inputClass:r})=>[s(_,{type:"text",name:"類別",id:"category",list:"categoryList",modelValue:o.tempProduct.category,"onUpdate:modelValue":e[6]||(e[6]=l=>o.tempProduct.category=l),class:g(r),rules:"required",placeholder:"",required:""},null,8,["modelValue","class"]),t("datalist",Mt,[(m(!0),h(w,null,S(a.categories,l=>(m(),h("option",{key:l,value:l},f(l),9,St))),128))])]),_:2},1032,["errors"])]),t("div",Lt,[s(u,{"label-for":"origin_price",label:"原價",errors:b},{default:i(({inputClass:r})=>[s(_,{type:"number",name:"原價",min:"0",id:"origin_price",modelValue:o.tempProduct.origin_price,"onUpdate:modelValue":e[7]||(e[7]=l=>o.tempProduct.origin_price=l),modelModifiers:{number:!0},class:g(r),rules:"required",placeholder:"",required:""},null,8,["modelValue","class"])]),_:2},1032,["errors"])])]),t("div",kt,[t("div",Ft,[s(u,{"label-for":"unit",label:"單位",errors:b},{default:i(({inputClass:r})=>[s(_,{type:"text",name:"單位",id:"unit",modelValue:o.tempProduct.unit,"onUpdate:modelValue":e[8]||(e[8]=l=>o.tempProduct.unit=l),class:g(r),rules:"required",placeholder:"",required:""},null,8,["modelValue","class"])]),_:2},1032,["errors"])]),t("div",Tt,[s(u,{"label-for":"price",label:"售價",errors:b},{default:i(({inputClass:r})=>[s(_,{type:"number",name:"售價",min:"0",id:"price",modelValue:o.tempProduct.price,"onUpdate:modelValue":e[9]||(e[9]=l=>o.tempProduct.price=l),modelModifiers:{number:!0},class:g(r),rules:"required",placeholder:"",required:""},null,8,["modelValue","class"])]),_:2},1032,["errors"])])]),Bt,s(u,{"label-for":"description",label:"產品描述"},{default:i(({inputClass:r})=>[y(t("textarea",{type:"text",name:"產品描述",id:"description","onUpdate:modelValue":e[10]||(e[10]=l=>o.tempProduct.description=l),class:g(r),placeholder:""},`
              `,2),[[v,o.tempProduct.description]])]),_:1}),s(u,{"label-for":"content",label:"說明內容"},{default:i(({inputClass:r})=>[y(t("textarea",{type:"text",name:"說明內容",id:"content","onUpdate:modelValue":e[11]||(e[11]=l=>o.tempProduct.content=l),class:g(r),placeholder:""},`
              `,2),[[v,o.tempProduct.content]])]),_:1}),s(p,{"label-for":"is_enabled",label:"是否上架"},{default:i(({inputClass:r})=>[y(t("input",{id:"is_enabled",class:g(r),type:"checkbox","true-value":1,"false-value":0,"onUpdate:modelValue":e[12]||(e[12]=l=>o.tempProduct.is_enabled=l)},null,2),[[j,o.tempProduct.is_enabled]])]),_:1})]),t("div",Et,[t("button",{type:"button",class:"btn btn-outline-primary me-3",onClick:e[13]||(e[13]=r=>{c.closeModal(),c.resetModalForm()})}," 取消編輯"),Rt])]),_:1},8,["onSubmit"])]),_:1},8,["onResetForm"])}const Nt=T(ot,[["render",Dt]]);var qt={VITE_URL:"https://ec-course-api.hexschool.io/v2",VITE_PATH:"jiayu",BASE_URL:"/Chocolate-Shop/",MODE:"production",DEV:!1,PROD:!0,SSR:!1};const{VITE_URL:L,VITE_PATH:k}=qt,jt={components:{ProductModal:Nt,PaginationComponent:G,AdminActionBtns:$,TableComponent:z,ActiveBadge:Y,LoadingBtn:E},data(){return{products:[],tempProduct:{},categories:[],isNew:!1,pagination:{}}},mounted(){this.showLoading(),this.getAdminProducts()},methods:{async getAdminProducts(n=1){try{const e=`${L}/api/${k}/admin/products?page=${n}`,{data:a}=await this.$http.get(e);this.products=a.products,this.pagination=a.pagination,this.categories=this.handleArrayInData(this.products,"category"),this.loadingStatus.productId="",this.hideLoading()}catch(e){this.hideLoading();const{message:a}=e.response.data;this.$swal(Array.isArray(a)?a[0]:a)}},async delProduct(n){if((await this.delSwal("產品",n.title)).isConfirmed)try{this.loadingStatus.productId=n.id;const a=`${L}/api/${k}/admin/product/${n.id}`;await this.$http.delete(a),this.getAdminProducts(this.pagination.current_page),this.swalToast(`已刪除產品「${n.title}」`),this.loadingStatus.productId=""}catch(a){this.loadingStatus.productId="",this.$swals(a.data.message||"發生錯誤，請稍後再試")}},openModal(n,e){switch(n){case"new":this.tempProduct={imagesUrl:[],is_enabled:0},this.isNew=!0;break;case"edit":this.tempProduct={...e},Array.isArray(this.tempProduct.imagesUrl)||(this.tempProduct.imagesUrl=[]),this.isNew=!1;break}this.$refs.productModal.showModal()},...P(I,["showLoading","hideLoading"]),...P(R,["swalToast","delSwal"]),...P(J,["handleArrayInData"])},computed:{...F(I,["loadingStatus"])}},Ot={class:"flex justify-between items-center mb-8"},Ht=t("h2",{class:"text-2xl font-bold"},"產品管理",-1),Gt={key:0,class:"bi bi-plus-lg me-1"},$t=t("th",{scope:"col",class:"min-w-8"}," 分類 ",-1),zt=t("th",{scope:"col",class:"min-w-24"},"產品名稱",-1),Jt=t("th",{scope:"col",class:"text-end min-w-9"}," 原價 ",-1),Kt=t("th",{scope:"col",class:"text-end min-w-9"}," 售價 ",-1),Qt=t("th",{scope:"col",class:"text-end min-w-9"}," 庫存 ",-1),Wt=t("th",{scope:"col",class:"text-center"}," 狀態 ",-1),Xt=t("th",{scope:"col",class:"min-w-10 text-end"},"編輯",-1),Yt={class:"text-end"},Zt={class:"text-end"},te={class:"text-end"},ee={class:"text-center"};function oe(n,e,a,V,o,c){const A=d("LoadingBtn"),x=d("ActiveBadge"),u=d("AdminActionBtns"),U=d("TableComponent"),M=d("PaginationComponent"),_=d("ProductModal");return m(),h(w,null,[t("div",Ot,[Ht,s(A,{class:"btn btn-primary",isLoading:n.loadingStatus.newProduct,onClick:e[0]||(e[0]=p=>c.openModal("new"))},{default:i(()=>[n.loadingStatus.newProduct?B("",!0):(m(),h("i",Gt)),C("新增產品 ")]),_:1},8,["isLoading"])]),s(U,{class:"mb-8"},{th:i(()=>[$t,zt,Jt,Kt,Qt,Wt,Xt]),tr:i(()=>[(m(!0),h(w,null,S(o.products,p=>(m(),h("tr",{key:p.id},[t("td",null,f(p.category),1),t("td",null,f(p.title),1),t("td",Yt,f(p.origin_price),1),t("td",Zt,f(p.price),1),t("td",te,f(p.stock),1),t("td",ee,[s(x,{active:p.is_enabled},{trueMsg:i(()=>[C("上架")]),falseMsg:i(()=>[C("下架")]),_:2},1032,["active"])]),t("td",null,[s(u,{data:p,loadingId:"productId",onOpenModal:c.openModal,onDelItem:c.delProduct},null,8,["data","onOpenModal","onDelItem"])])]))),128))]),_:1}),s(M,{pagination:o.pagination,onGetData:c.getAdminProducts},null,8,["pagination","onGetData"]),s(_,{ref:"productModal",product:o.tempProduct,"is-new":o.isNew,pagination:o.pagination,categories:o.categories,onGetData:c.getAdminProducts},null,8,["product","is-new","pagination","categories","onGetData"])],64)}const ce=T(jt,[["render",oe]]);export{ce as default};
