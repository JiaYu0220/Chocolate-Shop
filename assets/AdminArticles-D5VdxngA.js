import{m as w,a as P,_ as R,o as n,c as O,w as c,b as t,t as g,n as h,d as o,e as p,j as F,G as D,F as A,L as q,i as v,g as E,f as T,r as m}from"./index-DqG1kGwx.js";import{l as I}from"./loadingStore-rzChrqkE.js";import{s as B}from"./swalStore-BkLU8Nds.js";import{P as j}from"./PaginationComponent-wUY9avZP.js";import{F as H,C as G,T as z,A as J}from"./AdminActionBtns-ZNA7TRHr.js";import{A as K}from"./ActiveBadge-DS2i_iOS.js";import{h as Q}from"./helperStore-CGAAjIIN.js";import{F as W}from"./FormFloat-feD4wAZd.js";import{C as X,F as Y,E as Z}from"./EditImage-D-S4fuP1.js";import"./XBtn-BigFq_S7.js";import"./scrollStore-CCW0pJK5.js";import"./LoadingBtn-Cm2XIhRT.js";import"./TransitionFade-IILDyR74.js";var tt={VITE_URL:"https://ec-course-api.hexschool.io/v2",VITE_PATH:"jiayu",BASE_URL:"/Chocolate-Shop/",MODE:"production",DEV:!1,PROD:!0,SSR:!1};const{VITE_URL:U,VITE_PATH:k}=tt,et={components:{FormModal:H,FormFloat:W,ChecksRadio:G,CropperComponent:X,FileInput:Y,EditImage:Z},props:{tempId:String,tags:Array,isNew:Boolean,pagination:Object},data(){return{tempArticle:{},tempImageUrl:"",tempTag:"",isTagDuplicate:!1,loading:!0}},methods:{async showModal(){this.$refs.articleFormModal.showModal()},closeModal(){this.$refs.articleFormModal.closeModal()},async getSingleArticle(i){try{this.loadingStatus.editArticle=!0;const e=`${U}/api/${k}/admin/article/${i}`,u=await this.$http.get(e);this.tempArticle=u.data.article,Array.isArray(this.tempArticle.tag)||(this.tempArticle.tag=[]),this.loadingStatus.editArticle=!1}catch(e){this.loadingStatus.editArticle=!1,this.apiErrorSwal(e,this.$refs.articleFormModal)}},resetModalForm(){this.$refs.articleForm.resetForm(),this.tempArticle.image="",this.tempArticle.tag=[],this.tempTag="",this.tempImageUrl="",this.isTagDuplicate=!1},addImageUrl(i){this.tempArticle.image=i},addTag(){if(this.tempArticle.tag.includes(this.tempTag)){this.isTagDuplicate=!0;return}this.tempArticle.tag.push(this.tempTag),this.tempTag=""},async updateArticle(){try{let i=`${U}/api/${k}/admin/article`,e="post",u=1;this.tempArticle.create_at=Math.floor(new Date().getTime()/1e3);const S=`已${this.isNew?"新增":"更新"}文章「${this.tempArticle.title}」`;this.isNew||(i+=`/${this.tempArticle.id}`,e="put",u=this.pagination.current_page,this.loadingStatus.articleId=this.tempArticle.id),this.closeModal(),await this.$http[e](i,{data:this.tempArticle}),this.$emit("getData",u),this.loadingStatus.articleId="",this.resetModalForm(),this.swalToast(S)}catch(i){this.loadingStatus.articleId="",this.apiErrorSwal(i)}},...w(B,["swalToast","apiErrorSwal"]),...w(I,["showLoading","hideLoading"])},computed:{...P(I,["loadingStatus"])}},lt={class:"mb-3 flex items-end justify-between"},it=t("h4",{class:"text-xl font-bold text-primary-800"},"圖片",-1),st={class:"mb-4 border-b border-primary-700 pb-4 md:pb-8"},ot=t("p",{class:"mb-2"},"請選擇圖片檔案或貼上圖片網址：",-1),at={class:"mb-5 flex"},nt=["disabled"],rt={key:1,class:"mb-3 md:w-1/2"},dt=t("h4",{class:"mb-4 text-xl font-bold text-primary-800"},"文字",-1),ct={class:"flex flex-col gap-3"},mt={class:"flex gap-3"},pt={class:"w-1/2"},ut={class:"w-1/2"},ht={class:"w-fill flex md:w-1/2"},gt={id:"tagList"},_t=["value"],ft={key:0,class:"text-red-600"},bt={key:1,class:"flex flex-wrap gap-1"},At=["onClick"],wt=t("i",{class:"bi bi-x text-lg transition duration-150 group-hover:text-orange-700"},null,-1),xt={class:"mt-5 text-end"},yt=t("button",{type:"submit",class:"btn btn-primary"},"儲存編輯",-1);function Tt(i,e,u,S,l,r){const M=m("CropperComponent"),V=m("FileInput"),_=m("FormFloat"),C=m("EditImage"),b=m("VField"),x=m("ChecksRadio"),d=m("VForm"),y=m("LoadingOverlay"),N=m("FormModal");return n(),O(N,{target:"article",ref:"articleFormModal",onResetForm:r.resetModalForm},{title:c(({titleClass:f})=>[t("h3",{class:h(f)},g(u.isNew?"新增":"編輯")+"文章",3)]),default:c(()=>[o(d,{ref:"articleForm",onSubmit:r.updateArticle},{default:c(({errors:f})=>[t("div",lt,[it,o(M,{"down-name":"文章"})]),t("div",st,[l.tempArticle.image?(n(),p("div",rt,[o(C,{image:l.tempArticle.image,onHandleDelete:e[2]||(e[2]=s=>l.tempArticle.image="")},null,8,["image"])])):(n(),p(A,{key:0},[ot,o(V,{"return-url":!0,onEmitChange:r.addImageUrl,class:"mb-3",isLoading:i.loadingStatus.imageUrl},null,8,["onEmitChange","isLoading"]),t("div",at,[o(_,{"label-for":"imageUrl",label:"圖片網址",class:"flex-grow"},{default:c(({inputClass:s})=>[F(t("input",{type:"text",name:"文章圖片",id:"imageUrl",class:h([s,"rounded-r-none"]),"onUpdate:modelValue":e[0]||(e[0]=a=>l.tempImageUrl=a),placeholder:""},null,2),[[D,l.tempImageUrl]])]),_:1}),t("button",{type:"button",class:"btn btn-primary text-nowrap rounded-l-none",disabled:!l.tempImageUrl,onClick:e[1]||(e[1]=s=>r.addImageUrl(l.tempImageUrl))}," 加入圖片 ",8,nt)])],64))]),dt,t("div",ct,[o(_,{"label-for":"title",label:"標題",errors:f},{default:c(({inputClass:s})=>[o(b,{type:"text",name:"標題",id:"title",modelValue:l.tempArticle.title,"onUpdate:modelValue":e[3]||(e[3]=a=>l.tempArticle.title=a),class:h(s),rules:"required",placeholder:"",required:""},null,8,["modelValue","class"])]),_:2},1032,["errors"]),o(_,{"label-for":"description",label:"簡介",errors:f},{default:c(({inputClass:s})=>[o(b,{type:"text",name:"簡介",id:"description",modelValue:l.tempArticle.description,"onUpdate:modelValue":e[4]||(e[4]=a=>l.tempArticle.description=a),class:h(s),rules:"required",as:"textarea",placeholder:"",required:""},null,8,["modelValue","class"])]),_:2},1032,["errors"]),o(_,{"label-for":"content",label:"內容",errors:f},{default:c(({inputClass:s})=>[o(b,{type:"text",name:"內容",id:"content",modelValue:l.tempArticle.content,"onUpdate:modelValue":e[5]||(e[5]=a=>l.tempArticle.content=a),class:h(s),rules:"required",as:"textarea",placeholder:"",required:""},null,8,["modelValue","class"])]),_:2},1032,["errors"]),t("div",mt,[t("div",pt,[o(_,{"label-for":"author",label:"作者",errors:f},{default:c(({inputClass:s})=>[o(b,{type:"text",name:"作者",id:"author",modelValue:l.tempArticle.author,"onUpdate:modelValue":e[6]||(e[6]=a=>l.tempArticle.author=a),class:h(s),rules:"required",placeholder:"",required:""},null,8,["modelValue","class"])]),_:2},1032,["errors"])]),t("div",ut,[o(x,{"label-for":"isPublic",label:"是否發佈"},{default:c(({inputClass:s})=>[F(t("input",{id:"isPublic",class:h(s),type:"checkbox","onUpdate:modelValue":e[7]||(e[7]=a=>l.tempArticle.isPublic=a)},null,2),[[q,l.tempArticle.isPublic]])]),_:1})])]),t("div",ht,[o(_,{"label-for":"tag",label:"標籤",errors:f,class:"flex-grow"},{default:c(({inputClass:s})=>[F(t("input",{type:"text",list:"tagList",name:"標籤",id:"tag",class:h(["rounded-r-none",s]),"onUpdate:modelValue":e[8]||(e[8]=a=>l.tempTag=a),placeholder:"",autocomplete:"off",onInput:e[9]||(e[9]=a=>l.isTagDuplicate=!1)},null,34),[[D,l.tempTag]]),t("datalist",gt,[(n(!0),p(A,null,v(u.tags,a=>(n(),p("option",{key:a,value:a},g(a),9,_t))),128))])]),_:2},1032,["errors"]),t("button",{type:"button",class:"btn btn-primary text-nowrap rounded-l-none",onClick:e[10]||(e[10]=(...s)=>r.addTag&&r.addTag(...s))}," 加入標籤 ")]),l.isTagDuplicate?(n(),p("span",ft,"已有「"+g(l.tempTag)+"」標籤",1)):E("",!0),Array.isArray(l.tempArticle.tag)?(n(),p("ul",bt,[(n(!0),p(A,null,v(l.tempArticle.tag,(s,a)=>(n(),p("li",{key:`${l.tempArticle.id}-${s}`},[t("button",{type:"button",class:"group flex items-center text-nowrap rounded-xl bg-primary-200 px-2 py-1 text-center text-sm text-primary-800",onClick:Gt=>l.tempArticle.tag.splice(a,1)},[wt,T(" "+g(s),1)],8,At)]))),128))])):E("",!0),t("div",xt,[t("button",{type:"button",class:"btn btn-outline-primary me-3",onClick:e[11]||(e[11]=s=>{r.closeModal(),r.resetModalForm()})}," 取消編輯 "),yt])])]),_:1},8,["onSubmit"]),o(y,{active:i.loadingStatus.editArticle,"is-full-page":!1,color:"#5C270D"},null,8,["active"])]),_:1},8,["onResetForm"])}const vt=R(et,[["render",Tt]]);var It={VITE_URL:"https://ec-course-api.hexschool.io/v2",VITE_PATH:"jiayu",BASE_URL:"/Chocolate-Shop/",MODE:"production",DEV:!1,PROD:!0,SSR:!1};const{VITE_URL:L,VITE_PATH:$}=It,St={components:{TableComponent:z,PaginationComponent:j,AdminActionBtns:J,ArticleModal:vt,ActiveBadge:K},data(){return{articles:[],tempId:"",isNew:!1,pagination:{},tags:[]}},mounted(){this.showLoading(),this.getAdminArticles()},methods:{async getAdminArticles(i=1){try{const e=`${L}/api/${$}/admin/articles?page=${i}`,u=await this.$http.get(e);this.articles=u.data.articles,this.pagination=u.data.pagination,this.tags=this.removeDuplicateArray(this.articles,"tag"),this.hideLoading()}catch(e){this.hideLoading(),this.apiErrorSwal(e)}},async delArticle(i){try{if((await this.delSwal("文章",i.title)).isConfirmed){this.loadingStatus.articleId=i.id;const u=`${L}/api/${$}/admin/article/${i.id}`;await this.$http.delete(u),this.getAdminArticles(),this.swalToast(`已刪除文章「${i.title}」`),this.loadingStatus.articleId=""}}catch(e){this.loadingStatus.articleId="",this.apiErrorSwal(e)}},async openModal(i,e){switch(this.$refs.articleModal.showModal(),i){case"new":this.tempArticle={isPublic:!1,tag:[],image:""},this.isNew=!0;break;case"edit":await this.$refs.articleModal.getSingleArticle(e.id),this.isNew=!1;break}},...w(B,["delSwal","swalToast","apiErrorSwal"]),...w(I,["showLoading","hideLoading"]),...w(Q,["timestampToDate","removeDuplicateArray"])},computed:{...P(I,["isLoading","loadingStatus"])}},Mt={class:"mb-8 flex items-center justify-between"},Vt=t("h2",{class:"text-2xl font-bold"},"文章管理",-1),Ct=t("i",{class:"bi bi-plus-lg me-1"},null,-1),Ft=t("th",{scope:"col"},"標題",-1),Et=t("th",{class:"hidden md:table-cell",scope:"col"},"簡介",-1),Dt=t("th",{scope:"col"},"圖片",-1),Ut=t("th",{scope:"col"},"標籤",-1),kt=t("th",{scope:"col"},"最後更新",-1),Lt=t("th",{class:"hidden text-nowrap md:table-cell",scope:"col"},"作者",-1),$t=t("th",{scope:"col"},"發布",-1),Pt=t("th",{scope:"col"},null,-1),Rt={class:"hidden md:table-cell"},Bt={class:"h-9 w-12 md:h-12 md:w-16"},Nt=["src"],Ot={key:0,class:"flex flex-wrap gap-1"},qt={class:"hidden text-nowrap md:table-cell"},jt={class:"text-center"};function Ht(i,e,u,S,l,r){const M=m("ActiveBadge"),V=m("AdminActionBtns"),_=m("TableComponent"),C=m("PaginationComponent"),b=m("ArticleModal");return n(),p(A,null,[t("div",Mt,[Vt,t("button",{type:"button",class:"btn btn-primary",onClick:e[0]||(e[0]=x=>r.openModal("new"))},[Ct,T("新增文章 ")])]),o(_,{class:"mb-8"},{th:c(()=>[Ft,Et,Dt,Ut,kt,Lt,$t,Pt]),tr:c(({trClass:x})=>[(n(!0),p(A,null,v(l.articles,d=>(n(),p("tr",{class:h(x),key:d.id},[t("td",null,g(d.title),1),t("td",Rt,g(d.description),1),t("td",null,[t("div",Bt,[t("img",{lazy:"loading",class:"rounded-md bg-cover",src:d.image,alt:"文章圖"},null,8,Nt)])]),t("td",null,[Array.isArray(d.tag)?(n(),p("ul",Ot,[(n(!0),p(A,null,v(d.tag,y=>(n(),p("li",{class:"text-nowrap rounded-xl bg-primary-200 px-2 py-1 text-center text-xs text-primary-800 md:text-sm",key:`${d.id}-${y}`},g(y),1))),128))])):E("",!0)]),t("td",null,[t("span",null,g(i.timestampToDate(d.create_at)),1)]),t("td",qt,g(d.author),1),t("td",jt,[o(M,{active:d.isPublic},{trueMsg:c(()=>[T("發布")]),falseMsg:c(()=>[T("下架")]),_:2},1032,["active"])]),t("td",null,[o(V,{data:d,id:d.id,loadingId:"articleId",onOpenModal:r.openModal,onDelItem:r.delArticle},null,8,["data","id","onOpenModal","onDelItem"])])],2))),128))]),_:1}),o(C,{pagination:l.pagination,onGetData:r.getAdminArticles},null,8,["pagination","onGetData"]),o(b,{ref:"articleModal",id:l.tempId,"is-new":l.isNew,pagination:l.pagination,tags:l.tags,onGetData:r.getAdminArticles},null,8,["id","is-new","pagination","tags","onGetData"])],64)}const oe=R(St,[["render",Ht]]);export{oe as default};
