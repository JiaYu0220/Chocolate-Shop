import{s as f,H as c,I as m}from"./index-5P3JN48w.js";import{s as C}from"./swalStore-C5NdoJT8.js";import{l as g}from"./loadingStore-BWi5Gkrl.js";var w={VITE_URL:"https://ec-course-api.hexschool.io/v2",VITE_PATH:"jiayu",BASE_URL:"/Chocolate-Shop/",MODE:"production",DEV:!1,PROD:!0,SSR:!1};const{$swal:n}=m.variables,{VITE_URL:l,VITE_PATH:d}=w,{swalToast:p,delSwal:y}=C(),{loadingStatus:e,hideLoading:_}=g(),S=f("cartStore",{state:()=>({carts:[],orders:[],cartNum:0,total:0,final_total:0,usedCoupon:"",timer:0}),actions:{async getCart(){var a,s,r,t,i,h;try{const u=`${l}/api/${d}/cart`,{data:o}=await c.get(u);this.carts=(a=o==null?void 0:o.data)==null?void 0:a.carts,this.cartNum=(s=this.carts)==null?void 0:s.length,this.usedCoupon=(t=(r=this.carts[0])==null?void 0:r.coupon)==null?void 0:t.code,this.total=(i=o==null?void 0:o.data)==null?void 0:i.total,this.final_total=Math.floor((h=o==null?void 0:o.data)==null?void 0:h.final_total)}catch(u){_();const{message:o}=u.response.data;n(Array.isArray(o)?o[0]:o)}},async postCart(a,s=1){try{e.productId=a;const r=`${l}/api/${d}/cart`,t={product_id:a,qty:s};await c.post(r,{data:t}),p("加入購物車"),this.getCart(),e.productId=""}catch(r){const{message:t}=r.response.data;n(Array.isArray(t)?t[0]:t)}},async putCart(a,s){try{e.cartId=a.id;const r=`${l}/api/${d}/cart/${a.id}`,t={product_id:a.product_id,qty:s};await c.put(r,{data:t}),this.getCart(),e.cartId=""}catch(r){const{message:t}=r.response.data;n(Array.isArray(t)?t[0]:t)}},debouncePutCart(a,s){clearTimeout(this.timer),this.timer=setTimeout(()=>{this.putCart(a,s)},300)},async delCart(a,s="body",r=!0){try{e.cartId=a.id;const t=`${l}/api/${d}/cart/${a.id}`;r===!1?(await c.delete(t),p(`已刪除 ${a.product.title}`,s),this.getCart(),e.cartId=""):(await y("購物車中",a.product.title,s)).isConfirmed&&(await c.delete(t),p(`已刪除 ${a.product.title}`,s),this.getCart()),e.cartId=""}catch(t){const{message:i}=t.response.data;n(Array.isArray(i)?i[0]:i)}},async delAllCart(a="body"){try{if((await y("購物車中","全部項目",a)).isConfirmed){const r=`${l}/api/${d}/carts`;await c.delete(r),p("已清空購物車",a),this.getCart()}}catch(s){const{message:r}=s.response.data;n(Array.isArray(r)?r[0]:r)}},async postCoupon(a,s){try{e.newCoupon=!0;const r=`${l}/api/${d}/coupon`,t=await c.post(r,{data:{code:a}});this.final_total=Math.floor(t.data.data.final_total),this.usedCoupon=a,e.newCoupon=!1}catch(r){e.newCoupon=!1;const{message:t}=r.response.data;n({title:Array.isArray(t)?t[0]:t,target:s})}}}});export{S as c};
