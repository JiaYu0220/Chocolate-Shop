import{m as P,a as T,_ as B,o as u,c as q,w as i,b as t,t as f,n as m,d as s,e as g,k as y,v as C,F as x,f as I,r as L,g as E,x as j,h as d}from"./index-D3_6LEXB.js";import{l as V}from"./loadingStore-DT-oSTtX.js";import{L as R,s as D}from"./LoadingBtn-_Q2in9eb.js";import{h as O}from"./helperStore-BA8s8qZr.js";import{F as H,C as G,a as z}from"./CopyBtn-SzPuBIvJ.js";import{C as $,a as J,A as K,T as Q}from"./AdminActionBtns-CZdSPik8.js";import{F as W}from"./FormFloat-CmhVRoFL.js";import{P as X}from"./PaginationComponent-Brw17M81.js";import{A as Y}from"./ActiveBadge-D3gnOSSG.js";import"./XBtn-oFeKFcx4.js";import"./scrollStore-D639X63d.js";var Z={VITE_URL:"https://ec-course-api.hexschool.io/v2",VITE_PATH:"jiayu",BASE_URL:"/Chocolate-Shop/",MODE:"production",DEV:!1,PROD:!0,SSR:!1};const{VITE_URL:tt,VITE_PATH:et}=Z,ot={components:{CenterModal:$,FormFloat:W,FileInput:H,CopyBtn:G,LoadingBtn:R,CropperComponent:z,ChecksRadio:J},props:{product:Object,categories:Array,isNew:Boolean,pagination:Object},data(){return{tempProduct:{},tempImageUrl:"",tempImagesUrl:""}},mounted(){this.tempProduct=this.product},watch:{product(){this.tempProduct=this.product}},methods:{showModal(){this.$refs.productCenterModal.showModal()},closeModal(){this.$refs.productCenterModal.closeModal()},resetModalForm(){this.$refs.productForm.resetForm()},addImageUrl(r){this.tempProduct.imageUrl=r},addImagesUrl(r){this.tempProduct.imagesUrl.push(r),this.tempImagesUrl=""},addImagesUrlArray(r){this.tempProduct.imagesUrl.push(...r)},async updateProduct(){try{let r=`${tt}/api/${et}/admin/product`,e="post",a=1;const A=`已${this.isNew?"新增":"更新"}產品「${this.tempProduct.title}」`;this.isNew?this.loadingStatus.newProduct=!0:(r+=`/${this.tempProduct.id}`,e="put",a=this.pagination.current_page,this.loadingStatus.productId=this.tempProduct.id),this.closeModal(),await this.$http[e](r,{data:this.tempProduct}),this.resetModalForm(),this.$emit("getData",a),this.loadingStatus.productId="",this.loadingStatus.newProduct=!1,this.swalToast(A)}catch(r){this.loadingStatus.productId="",this.loadingStatus.newProduct=!1;const{message:e}=r.response.data;this.$swal(Array.isArray(e)?e[0]:e)}},...P(D,["swalToast"]),...P(V,["showLoading","hideLoading"])},computed:{...T(V,["loadingStatus"])}},st={class:"flex justify-between items-end mb-3"},lt=t("h4",{class:"text-xl font-bold text-primary-800"},"圖片",-1),rt=t("p",{class:"text-stone-500 mb-3"},"※ 請先使用裁剪小工具將圖片裁剪成適當長寬比 (4:3) 再上傳！",-1),nt={class:"pb-4 md:pb-8 mb-4 border-b border-primary-700"},it=t("h5",{class:"text-lg mb-1"},"- 主圖 -",-1),at=t("p",{class:"mb-2"},"請選擇圖片檔案或貼上圖片網址：",-1),dt={class:"flex mb-5"},ct=["disabled"],mt={key:1,class:"mb-3 md:w-1/2"},ut={class:"relative border-2 border-primary-300 rounded-md p-1"},pt=["src"],gt=t("i",{class:"bi bi-trash-fill"},null,-1),ht=[gt],_t=t("hr",null,null,-1),bt=t("h5",{class:"text-lg mt-3 mb-1"},"- 其他圖片 -",-1),ft=t("p",{class:"mb-2"},"請選擇圖片檔案或貼上圖片網址：",-1),yt={class:"flex mb-3"},Pt={key:2,class:"grid grid-cols-2 gap-2 md:grid-cols-3 md:gap-3"},xt=["src"],wt=["onClick"],Ut=t("i",{class:"bi bi-trash-fill"},null,-1),vt=[Ut],Ct=t("h4",{class:"text-xl font-bold text-primary-800 mb-4"},"文字",-1),It={class:"flex flex-col gap-3"},Vt={class:"flex gap-3"},At={class:"w-2/3"},Mt={id:"categoryList"},St=["value"],Lt={class:"w-1/3"},kt={class:"flex gap-3"},Ft={class:"w-2/3"},Tt={class:"w-1/3"},Bt=t("hr",null,null,-1),Et={class:"mt-5 text-end"},Rt=t("button",{type:"submit",class:"btn btn-primary"}," 儲存編輯",-1);function Dt(r,e,a,A,o,c){const M=d("CropperComponent"),w=d("FileInput"),p=d("FormFloat"),U=d("CopyBtn"),S=d("LoadingBtn"),_=d("VField"),v=d("ChecksRadio"),h=d("VForm"),N=d("CenterModal");return u(),q(N,{target:"product",ref:"productCenterModal",onResetForm:c.resetModalForm},{title:i(({titleClass:b})=>[t("h3",{class:m(b)},f(a.isNew?"新增":"編輯")+"產品",3)]),default:i(()=>[s(h,{ref:"productForm",onSubmit:c.updateProduct},{default:i(({errors:b})=>[t("div",st,[lt,s(M,{"down-name":o.tempProduct.title},null,8,["down-name"])]),rt,t("div",nt,[it,o.tempProduct.imageUrl?(u(),g("div",mt,[t("div",ut,[t("img",{loading:"lazy",src:o.tempProduct.imageUrl,class:"object-cover rounded-sm",alt:"產品圖"},null,8,pt),s(U,{text:o.tempProduct.imageUrl,msg:"圖片網址",class:"absolute right-0 bottom-0 p-1 rounded-md bg-primary-50 text-primary-800 duration-150 hover:text-primary-300"},null,8,["text"]),t("button",{type:"button",class:"absolute right-0 top-0 p-1 rounded-md bg-primary-50 text-primary-800 duration-150 hover:text-red-500 focus:text-red-500",onClick:e[2]||(e[2]=n=>o.tempProduct.imageUrl="")},ht)])])):(u(),g(x,{key:0},[at,s(w,{"return-url":!0,onEmitChange:c.addImageUrl,class:"mb-3",isLoading:r.loadingStatus.imageUrl},null,8,["onEmitChange","isLoading"]),t("div",dt,[s(p,{"label-for":"imageUrl",label:"圖片網址",class:"flex-grow"},{default:i(({inputClass:n})=>[y(t("input",{type:"text",name:"圖片",id:"imageUrl",class:m([n,"rounded-r-none"]),"onUpdate:modelValue":e[0]||(e[0]=l=>o.tempImageUrl=l),placeholder:""},null,2),[[C,o.tempImageUrl]])]),_:1}),t("button",{type:"button",class:"btn btn-primary rounded-l-none text-nowrap",disabled:!o.tempImageUrl,onClick:e[1]||(e[1]=n=>o.tempProduct.imageUrl=o.tempImageUrl)},"加入圖片",8,ct)])],64)),_t,bt,ft,s(w,{"return-url":!0,isMultiple:!0,onEmitChange:c.addImagesUrlArray,isLoading:r.loadingStatus.imagesUrl,class:"mb-3"},null,8,["onEmitChange","isLoading"]),t("div",yt,[s(p,{"label-for":"imageUrl",label:"圖片網址",class:"flex-grow"},{default:i(({inputClass:n})=>[y(t("input",{type:"text",name:"圖片",id:"imageUrl",class:m([n,"rounded-r-none"]),placeholder:"","onUpdate:modelValue":e[3]||(e[3]=l=>o.tempImagesUrl=l)},null,2),[[C,o.tempImagesUrl]])]),_:1}),s(S,{class:"btn btn-primary rounded-l-none text-nowrap",isLoading:r.loadingStatus.imagesUrl,disabled:!o.tempImagesUrl,onClick:e[4]||(e[4]=n=>c.addImagesUrl(o.tempImagesUrl))},{default:i(()=>[I("加入圖片")]),_:1},8,["isLoading","disabled"])]),Array.isArray(o.tempProduct.imagesUrl)?(u(),g("div",Pt,[(u(!0),g(x,null,L(o.tempProduct.imagesUrl,(n,l)=>(u(),g("div",{key:`img${l}`,class:"relative border-2 border-primary-300 rounded-md p-1"},[t("img",{loading:"lazy",src:n,class:"object-cover",alt:"產品圖"},null,8,xt),t("button",{type:"button",class:"absolute right-0 top-0 p-1 rounded-md bg-primary-50 text-primary-800 duration-150 hover:text-red-500 focus:text-red-500",onClick:se=>o.tempProduct.imagesUrl.splice(l,1)},vt,8,wt),s(U,{text:o.tempProduct.imagesUrl[l],msg:"圖片網址",class:"absolute right-0 bottom-0 p-1 rounded-md bg-primary-50 text-primary-800 duration-150 hover:text-primary-300"},null,8,["text"])]))),128))])):E("",!0)]),Ct,t("div",It,[s(p,{"label-for":"title",label:"名稱",errors:b},{default:i(({inputClass:n})=>[s(_,{type:"text",name:"名稱",id:"title",modelValue:o.tempProduct.title,"onUpdate:modelValue":e[5]||(e[5]=l=>o.tempProduct.title=l),class:m(n),rules:"required",placeholder:"",required:""},null,8,["modelValue","class"])]),_:2},1032,["errors"]),t("div",Vt,[t("div",At,[s(p,{"label-for":"category",label:"類別",errors:b},{default:i(({inputClass:n})=>[s(_,{type:"text",name:"類別",id:"category",list:"categoryList",modelValue:o.tempProduct.category,"onUpdate:modelValue":e[6]||(e[6]=l=>o.tempProduct.category=l),class:m(n),rules:"required",placeholder:"",required:""},null,8,["modelValue","class"]),t("datalist",Mt,[(u(!0),g(x,null,L(a.categories,l=>(u(),g("option",{key:l,value:l},f(l),9,St))),128))])]),_:2},1032,["errors"])]),t("div",Lt,[s(p,{"label-for":"origin_price",label:"原價",errors:b},{default:i(({inputClass:n})=>[s(_,{type:"number",name:"原價",min:"0",id:"origin_price",modelValue:o.tempProduct.origin_price,"onUpdate:modelValue":e[7]||(e[7]=l=>o.tempProduct.origin_price=l),modelModifiers:{number:!0},class:m(n),rules:"required",placeholder:"",required:""},null,8,["modelValue","class"])]),_:2},1032,["errors"])])]),t("div",kt,[t("div",Ft,[s(p,{"label-for":"unit",label:"單位",errors:b},{default:i(({inputClass:n})=>[s(_,{type:"text",name:"單位",id:"unit",modelValue:o.tempProduct.unit,"onUpdate:modelValue":e[8]||(e[8]=l=>o.tempProduct.unit=l),class:m(n),rules:"required",placeholder:"",required:""},null,8,["modelValue","class"])]),_:2},1032,["errors"])]),t("div",Tt,[s(p,{"label-for":"price",label:"售價",errors:b},{default:i(({inputClass:n})=>[s(_,{type:"number",name:"售價",min:"0",id:"price",modelValue:o.tempProduct.price,"onUpdate:modelValue":e[9]||(e[9]=l=>o.tempProduct.price=l),modelModifiers:{number:!0},class:m(n),rules:"required",placeholder:"",required:""},null,8,["modelValue","class"])]),_:2},1032,["errors"])])]),Bt,s(p,{"label-for":"description",label:"產品描述"},{default:i(({inputClass:n})=>[y(t("textarea",{type:"text",name:"產品描述",id:"description","onUpdate:modelValue":e[10]||(e[10]=l=>o.tempProduct.description=l),class:m(n),placeholder:""},`
              `,2),[[C,o.tempProduct.description]])]),_:1}),s(p,{"label-for":"content",label:"說明內容"},{default:i(({inputClass:n})=>[y(t("textarea",{type:"text",name:"說明內容",id:"content","onUpdate:modelValue":e[11]||(e[11]=l=>o.tempProduct.content=l),class:m(n),placeholder:""},`
              `,2),[[C,o.tempProduct.content]])]),_:1}),s(v,{"label-for":"is_enabled",label:"是否上架"},{default:i(({inputClass:n})=>[y(t("input",{id:"is_enabled",class:m(n),type:"checkbox","true-value":1,"false-value":0,"onUpdate:modelValue":e[12]||(e[12]=l=>o.tempProduct.is_enabled=l)},null,2),[[j,o.tempProduct.is_enabled]])]),_:1})]),t("div",Et,[t("button",{type:"button",class:"btn btn-outline-primary me-3",onClick:e[13]||(e[13]=n=>{c.closeModal(),c.resetModalForm()})}," 取消編輯"),Rt])]),_:1},8,["onSubmit"])]),_:1},8,["onResetForm"])}const Nt=B(ot,[["render",Dt]]);var qt={VITE_URL:"https://ec-course-api.hexschool.io/v2",VITE_PATH:"jiayu",BASE_URL:"/Chocolate-Shop/",MODE:"production",DEV:!1,PROD:!0,SSR:!1};const{VITE_URL:k,VITE_PATH:F}=qt,jt={components:{ProductModal:Nt,PaginationComponent:X,AdminActionBtns:K,TableComponent:Q,ActiveBadge:Y,LoadingBtn:R},data(){return{products:[],tempProduct:{},categories:[],isNew:!1,pagination:{}}},mounted(){this.showLoading(),this.getAdminProducts()},methods:{async getAdminProducts(r=1){try{const e=`${k}/api/${F}/admin/products?page=${r}`,{data:a}=await this.$http.get(e);this.products=a.products,this.pagination=a.pagination,this.categories=this.handleArrayInData(this.products,"category"),this.loadingStatus.productId="",this.hideLoading()}catch(e){this.hideLoading();const{message:a}=e.response.data;this.$swal(Array.isArray(a)?a[0]:a)}},async delProduct(r){if((await this.delSwal("產品",r.title)).isConfirmed)try{this.loadingStatus.productId=r.id;const a=`${k}/api/${F}/admin/product/${r.id}`;await this.$http.delete(a),this.getAdminProducts(this.pagination.current_page),this.swalToast(`已刪除產品「${r.title}」`),this.loadingStatus.productId=""}catch(a){this.loadingStatus.productId="",this.$swals(a.data.message||"發生錯誤，請稍後再試")}},openModal(r,e){switch(r){case"new":this.tempProduct={imagesUrl:[],is_enabled:0},this.isNew=!0;break;case"edit":this.tempProduct={...e},Array.isArray(this.tempProduct.imagesUrl)||(this.tempProduct.imagesUrl=[]),this.isNew=!1;break}this.$refs.productModal.showModal()},...P(V,["showLoading","hideLoading"]),...P(D,["swalToast","delSwal"]),...P(O,["handleArrayInData"])},computed:{...T(V,["loadingStatus"])}},Ot={class:"flex justify-between items-center mb-8"},Ht=t("h2",{class:"text-2xl font-bold"},"產品管理",-1),Gt={key:0,class:"bi bi-plus-lg me-1"},zt=t("th",{scope:"col",class:"min-w-8"}," 分類 ",-1),$t=t("th",{scope:"col",class:"min-w-24"},"產品名稱",-1),Jt=t("th",{scope:"col",class:"text-end min-w-9"}," 原價 ",-1),Kt=t("th",{scope:"col",class:"text-end min-w-9"}," 售價 ",-1),Qt=t("th",{scope:"col",class:"text-end min-w-9"}," 庫存 ",-1),Wt=t("th",{scope:"col",class:"text-center"}," 狀態 ",-1),Xt=t("th",{scope:"col"},null,-1),Yt={class:"text-end"},Zt={class:"text-end"},te={class:"text-end"},ee={class:"text-center"};function oe(r,e,a,A,o,c){const M=d("LoadingBtn"),w=d("ActiveBadge"),p=d("AdminActionBtns"),U=d("TableComponent"),S=d("PaginationComponent"),_=d("ProductModal");return u(),g(x,null,[t("div",Ot,[Ht,s(M,{class:"btn btn-primary",isLoading:r.loadingStatus.newProduct,onClick:e[0]||(e[0]=v=>c.openModal("new"))},{default:i(()=>[r.loadingStatus.newProduct?E("",!0):(u(),g("i",Gt)),I("新增產品 ")]),_:1},8,["isLoading"])]),s(U,{class:"mb-8"},{th:i(()=>[zt,$t,Jt,Kt,Qt,Wt,Xt]),tr:i(({trClass:v})=>[(u(!0),g(x,null,L(o.products,h=>(u(),g("tr",{class:m(v),key:h.id},[t("td",null,f(h.category),1),t("td",null,f(h.title),1),t("td",Yt,f(h.origin_price),1),t("td",Zt,f(h.price),1),t("td",te,f(h.stock),1),t("td",ee,[s(w,{active:h.is_enabled},{trueMsg:i(()=>[I("上架")]),falseMsg:i(()=>[I("下架")]),_:2},1032,["active"])]),t("td",null,[s(p,{data:h,loadingId:"productId",onOpenModal:c.openModal,onDelItem:c.delProduct},null,8,["data","onOpenModal","onDelItem"])])],2))),128))]),_:1}),s(S,{pagination:o.pagination,onGetData:c.getAdminProducts},null,8,["pagination","onGetData"]),s(_,{ref:"productModal",product:o.tempProduct,"is-new":o.isNew,pagination:o.pagination,categories:o.categories,onGetData:c.getAdminProducts},null,8,["product","is-new","pagination","categories","onGetData"])],64)}const he=B(jt,[["render",oe]]);export{he as default};
