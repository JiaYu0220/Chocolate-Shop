import{m as g,a as L,_ as D,o as _,c as $,w as l,b as t,t as C,n as m,d as i,k as x,x as k,h as d,e as b,F as T,g as E,f as A,r as B}from"./index-D3_6LEXB.js";import{P as R}from"./PaginationComponent-Brw17M81.js";import{l as w}from"./loadingStore-DT-oSTtX.js";import{C as P,a as U,T as N,A as O}from"./AdminActionBtns-CZdSPik8.js";import{s as I,L as q}from"./LoadingBtn-_Q2in9eb.js";import{h as j}from"./helperStore-BA8s8qZr.js";import{A as H}from"./ActiveBadge-D3gnOSSG.js";import{F as G}from"./FormFloat-CmhVRoFL.js";import"./XBtn-oFeKFcx4.js";import"./scrollStore-D639X63d.js";var z={VITE_URL:"https://ec-course-api.hexschool.io/v2",VITE_PATH:"jiayu",BASE_URL:"/Chocolate-Shop/",MODE:"production",DEV:!1,PROD:!0,SSR:!1};const{VITE_URL:W,VITE_PATH:J}=z,K={components:{CenterModal:P,FormFloat:G,ChecksRadio:U},props:{coupon:Object,isNew:Boolean,pagination:Object},data(){return{tempCoupon:{}}},mounted(){this.tempCoupon=this.coupon},watch:{coupon(){this.tempCoupon=this.coupon,String(this.tempCoupon.due_date).length===10&&(this.tempCoupon.due_date*=1e3)}},methods:{showModal(){this.$refs.couponCenterModal.showModal()},closeModal(){this.$refs.couponCenterModal.closeModal()},resetModalForm(){this.$refs.couponForm.resetForm()},async updateCoupon(){var a;try{let e=`${W}/api/${J}/admin/coupon`,o="post",f=1;this.tempCoupon.code=this.tempCoupon.code.toUpperCase();const n=`已${this.isNew?"新增":"更新"}優惠券「${this.tempCoupon.title}」`;String(this.tempCoupon.due_date).length===13&&(this.tempCoupon.due_date=Math.floor(this.tempCoupon.due_date/1e3)),this.isNew?this.loadingStatus.newCoupon=!0:(e+=`/${this.tempCoupon.id}`,o="put",f=this.pagination.current_page,this.loadingStatus.couponId=this.tempCoupon.id),this.closeModal(),await this.$http[o](e,{data:this.tempCoupon}),this.resetModalForm(),this.$emit("getData",f),this.loadingStatus.couponId="",this.loadingStatus.newCoupon=!1,this.swalToast(n)}catch(e){this.loadingStatus.couponId="",this.loadingStatus.newCoupon=!1,this.$swal(((a=e.data)==null?void 0:a.message)||"發生錯誤，請稍後再試")}},...g(I,["swalToast"]),...g(w,["showLoading","hideLoading"])},computed:{...L(w,["loadingStatus"])}},Q={class:"flex flex-col gap-6 h-full"},X=t("p",{class:"text-stone-500 mt-1"},"※ 優惠碼英文小寫將會被轉成大寫",-1),Y={class:"flex gap-3"},Z={class:"w-1/3"},ee={class:"w-2/3"},te={class:"mt-5 text-end"},oe=t("button",{type:"submit",class:"btn btn-primary"}," 儲存編輯",-1);function ne(a,e,o,f,n,p){const h=d("VField"),c=d("FormFloat"),M=d("VueDatePicker"),V=d("ChecksRadio"),y=d("VForm"),S=d("CenterModal");return _(),$(S,{target:"coupon",ref:"couponCenterModal",onResetForm:p.resetModalForm},{title:l(({titleClass:r})=>[t("h3",{class:m(r)},C(o.isNew?"新增":"編輯")+"優惠券",3)]),default:l(()=>[i(y,{ref:"couponForm",onSubmit:p.updateCoupon},{default:l(({errors:r})=>[t("div",Q,[i(c,{"label-for":"title",label:"名稱",errors:r},{default:l(({inputClass:s})=>[i(h,{type:"text",name:"名稱",id:"title",modelValue:n.tempCoupon.title,"onUpdate:modelValue":e[0]||(e[0]=u=>n.tempCoupon.title=u),class:m(s),rules:"required",placeholder:"",required:""},null,8,["modelValue","class"])]),_:2},1032,["errors"]),t("div",null,[i(c,{"label-for":"code",label:"優惠碼",errors:r},{default:l(({inputClass:s})=>[i(h,{type:"text",name:"優惠碼",id:"code",modelValue:n.tempCoupon.code,"onUpdate:modelValue":e[1]||(e[1]=u=>n.tempCoupon.code=u),class:m(s),rules:"required",placeholder:"",required:""},null,8,["modelValue","class"])]),_:2},1032,["errors"]),X]),t("div",Y,[t("div",Z,[i(c,{"label-for":"percent",label:"折扣 (%)",errors:r},{default:l(({inputClass:s})=>[i(h,{type:"number",min:"0",step:"5",name:"折扣 (%)",id:"percent",modelValue:n.tempCoupon.percent,"onUpdate:modelValue":e[2]||(e[2]=u=>n.tempCoupon.percent=u),modelModifiers:{number:!0},class:m(s),rules:"required",placeholder:"",required:""},null,8,["modelValue","class"])]),_:2},1032,["errors"])]),t("div",ee,[i(c,{"label-for":"due_date",label:"期限"},{default:l(()=>[i(M,{modelValue:n.tempCoupon.due_date,"onUpdate:modelValue":e[3]||(e[3]=s=>n.tempCoupon.due_date=s),"model-type":"timestamp","enable-time-picker":!1,format:"yyyy/MM/dd",locale:"zh-TW","day-names":["一","二","三","四","五","六","日"],"hide-input-icon":"",clearable:!1,"teleport-center":"","auto-apply":"",required:""},null,8,["modelValue"])]),_:1})])]),i(V,{"label-for":"is_enable",label:"是否啟用"},{default:l(({inputClass:s})=>[x(t("input",{id:"is_enable",class:m(s),type:"checkbox","onUpdate:modelValue":e[4]||(e[4]=u=>n.tempCoupon.is_enable=u)},null,2),[[k,n.tempCoupon.is_enable]])]),_:1}),t("div",te,[t("button",{type:"button",class:"btn btn-outline-primary me-3",onClick:e[5]||(e[5]=s=>{p.closeModal(),p.resetModalForm()})}," 取消編輯"),oe])])]),_:1},8,["onSubmit"])]),_:1},8,["onResetForm"])}const se=D(K,[["render",ne]]);var ae={VITE_URL:"https://ec-course-api.hexschool.io/v2",VITE_PATH:"jiayu",BASE_URL:"/Chocolate-Shop/",MODE:"production",DEV:!1,PROD:!0,SSR:!1};const{VITE_URL:v,VITE_PATH:F}=ae,ie={components:{TableComponent:N,PaginationComponent:R,AdminActionBtns:O,ActiveBadge:H,CouponModal:se,LoadingBtn:q},data(){return{coupons:[],tempCoupon:{},isNew:!1,pagination:{}}},mounted(){this.showLoading(),this.getAdminCoupons()},methods:{async getAdminCoupons(a=1){try{const e=`${v}/api/${F}/admin/coupons?page=${a}`,o=await this.$http.get(e);this.coupons=o.data.coupons,this.pagination=o.data.pagination}catch(e){const{message:o}=e.response.data;this.$swal(Array.isArray(o)?o[0]:o)}finally{this.hideLoading()}},async delCoupon(a){try{if((await this.delSwal("優惠券",a.title)).isConfirmed){this.loadingStatus.couponId=a.id;const o=`${v}/api/${F}/admin/coupon/${a.id}`;await this.$http.delete(o),this.getAdminCoupons(),this.swalToast(`已刪除優惠券「${a.title}」`),this.loadingStatus.couponId=""}}catch(e){this.loadingStatus.couponId="";const{message:o}=e.response.data;this.$swal(Array.isArray(o)?o[0]:o)}},openModal(a,e){switch(a){case"new":this.tempCoupon={is_enabled:0,due_date:new Date().getTime()},this.isNew=!0;break;case"edit":this.tempCoupon={...e},this.isNew=!1;break}this.$refs.couponModal.showModal()},...g(I,["delSwal","swalToast"]),...g(w,["showLoading","hideLoading"]),...g(j,["timestampToDate"])},computed:{...L(w,["isLoading","loadingStatus"])}},le={class:"flex justify-between items-center mb-8"},de=t("h2",{class:"text-2xl font-bold"},"優惠券管理",-1),pe={key:0,class:"bi bi-plus-lg me-1"},re=t("th",{scope:"col"},"名稱",-1),ue=t("th",{scope:"col"},"折扣 (%)",-1),ce=t("th",{scope:"col"},"優惠碼",-1),me=t("th",{scope:"col"},"期限",-1),he=t("th",{scope:"col"},"啟用",-1);function _e(a,e,o,f,n,p){const h=d("LoadingBtn"),c=d("ActiveBadge"),M=d("AdminActionBtns"),V=d("TableComponent"),y=d("PaginationComponent"),S=d("CouponModal");return _(),b(T,null,[t("div",le,[de,i(h,{class:"btn btn-primary",isLoading:a.loadingStatus.newCoupon,onClick:e[0]||(e[0]=r=>p.openModal("new"))},{default:l(()=>[a.loadingStatus.newCoupon?E("",!0):(_(),b("i",pe)),A("新增優惠券 ")]),_:1},8,["isLoading"])]),i(V,{class:"mb-8 table-auto"},{th:l(()=>[re,ue,ce,me,he]),tr:l(({trClass:r})=>[(_(!0),b(T,null,B(n.coupons,s=>(_(),b("tr",{class:m(r),key:s.id},[t("td",null,C(s.title),1),t("td",null,C(s.percent),1),t("td",null,C(s.code),1),t("td",null,C(a.timestampToDate(s.due_date)),1),t("td",null,[i(c,{active:s.is_enabled},{trueMsg:l(()=>[A("啟用")]),falseMsg:l(()=>[A("未啟用")]),_:2},1032,["active"])]),t("td",null,[i(M,{data:s,loadingId:"couponId",onOpenModal:p.openModal,onDelItem:p.delCoupon},null,8,["data","onOpenModal","onDelItem"])])],2))),128))]),_:1}),i(y,{pagination:n.pagination,onGetData:p.getAdminCoupons},null,8,["pagination","onGetData"]),i(S,{ref:"couponModal",coupon:n.tempCoupon,"is-new":n.isNew,pagination:n.pagination,onGetData:p.getAdminCoupons},null,8,["coupon","is-new","pagination","onGetData"])],64)}const Te=D(ie,[["render",_e]]);export{Te as default};
