import{m as w,a as T,_ as D,o as p,c as L,w as n,b as e,t as f,n as m,d as s,e as _,j as P,G as I,F as y,f as V,i as F,g as B,L as H,r}from"./index-LXrwWew1.js";import{l as M}from"./loadingStore-DK0tKp_Y.js";import{s as R}from"./swalStore-DGw95bNv.js";import{h as O}from"./helperStore-DuTHAWoV.js";import{F as j,C as G,E as z}from"./EditImage-DwkAstPF.js";import{F as $}from"./FormFloat-oVAHurxL.js";import{L as q}from"./LoadingBtn-C4rBUQ05.js";import{F as J,C as K,A as Q,T as W}from"./AdminActionBtns-CCjyakLq.js";import{P as X}from"./PaginationComponent-KSFRCwmd.js";import{A as Y}from"./ActiveBadge-DndCFVkq.js";import"./TransitionFade-4itHXdet.js";import"./XBtn-GCB5CZFV.js";import"./scrollStore-DBTbIjvX.js";var Z={VITE_URL:"https://ec-course-api.hexschool.io/v2",VITE_PATH:"jiayu",BASE_URL:"/Chocolate-Shop/",MODE:"production",DEV:!1,PROD:!0,SSR:!1};const{VITE_URL:ee,VITE_PATH:te}=Z,oe={components:{FormModal:J,FormFloat:$,FileInput:j,LoadingBtn:q,CropperComponent:G,ChecksRadio:K,EditImage:z},props:{product:Object,categories:Array,isNew:Boolean,pagination:Object},data(){return{tempProduct:{},tempImageUrl:"",tempImagesUrl:""}},mounted(){this.tempProduct=this.product},watch:{product(){this.tempProduct=this.product}},methods:{showModal(){this.$refs.productFormModal.showModal()},closeModal(){this.$refs.productFormModal.closeModal()},resetModalForm(){this.$refs.productForm.resetForm()},addImageUrl(a){this.tempProduct.imageUrl=a},addImagesUrl(a){this.tempProduct.imagesUrl.push(a),this.tempImagesUrl=""},addImagesUrlArray(a){this.tempProduct.imagesUrl.push(...a)},async updateProduct(){try{let a=`${ee}/api/${te}/admin/product`,t="post",d=1;const S=`已${this.isNew?"新增":"更新"}產品「${this.tempProduct.title}」`;this.isNew?this.loadingStatus.newProduct=!0:(a+=`/${this.tempProduct.id}`,t="put",d=this.pagination.current_page,this.loadingStatus.productId=this.tempProduct.id),this.closeModal(),await this.$http[t](a,{data:this.tempProduct}),this.resetModalForm(),this.$emit("getData",d),this.loadingStatus.productId="",this.loadingStatus.newProduct=!1,this.swalToast(S)}catch(a){this.loadingStatus.productId="",this.loadingStatus.newProduct=!1,this.apiErrorSwal(a)}},...w(R,["swalToast","apiErrorSwal"]),...w(M,["showLoading","hideLoading"])},computed:{...T(M,["loadingStatus"])}},se={class:"mb-3 flex items-end justify-between"},le=e("h4",{class:"text-xl font-bold text-primary-800"},"圖片",-1),ie=e("p",{class:"mb-3 text-stone-500"},"※ 請先使用裁剪小工具將圖片裁剪成適當長寬比 (1:1) 再上傳！",-1),ae={class:"mb-4 border-b border-primary-700 pb-4 md:pb-8"},ne=e("h5",{class:"mb-1 text-lg"},"- 主圖 -",-1),re=e("p",{class:"mb-2"},"請選擇圖片檔案或貼上圖片網址：",-1),de={class:"mb-5 flex"},ce=["disabled"],me={key:1,class:"mb-3 md:w-1/2"},ue=e("hr",null,null,-1),pe=e("h5",{class:"mb-1 mt-3 text-lg"},"- 其他圖片 -",-1),ge=e("p",{class:"mb-2"},"請選擇圖片檔案或貼上圖片網址：",-1),_e={class:"mb-3 flex"},he={key:2,class:"grid grid-cols-2 gap-2 md:grid-cols-3 md:gap-3"},be=e("h4",{class:"mb-4 text-xl font-bold text-primary-800"},"文字",-1),fe={class:"flex flex-col gap-3"},Pe={class:"flex gap-3"},we={class:"w-2/3"},ye={class:"w-1/3"},Ue={class:"flex gap-3"},xe={class:"w-2/3"},ve={id:"categoryList"},Ie=["value"],Ve={class:"w-1/3"},Me={class:"flex gap-3"},Se={class:"w-2/3"},Ae={class:"w-1/3"},Ce=e("hr",null,null,-1),Fe={class:"mt-5 text-end"},Le=e("button",{type:"submit",class:"btn btn-primary"},"儲存編輯",-1);function Ee(a,t,d,S,o,c){const A=r("CropperComponent"),U=r("FileInput"),u=r("FormFloat"),x=r("EditImage"),C=r("LoadingBtn"),h=r("VField"),v=r("ChecksRadio"),g=r("VForm"),N=r("FormModal");return p(),L(N,{target:"product",ref:"productFormModal",onResetForm:c.resetModalForm},{title:n(({titleClass:b})=>[e("h3",{class:m(b)},f(d.isNew?"新增":"編輯")+"產品",3)]),default:n(()=>[s(g,{ref:"productForm",onSubmit:c.updateProduct},{default:n(({errors:b})=>[e("div",se,[le,s(A,{"down-name":o.tempProduct.title},null,8,["down-name"])]),ie,e("div",ae,[ne,o.tempProduct.imageUrl?(p(),_("div",me,[s(x,{image:o.tempProduct.imageUrl,onHandleDelete:t[2]||(t[2]=i=>o.tempProduct.imageUrl="")},null,8,["image"])])):(p(),_(y,{key:0},[re,s(U,{"return-url":!0,onEmitChange:c.addImageUrl,class:"mb-3",isLoading:a.loadingStatus.imageUrl},null,8,["onEmitChange","isLoading"]),e("div",de,[s(u,{"label-for":"imageUrl",label:"圖片網址",class:"flex-grow"},{default:n(({inputClass:i})=>[P(e("input",{type:"text",name:"圖片",id:"imageUrl",class:m([i,"rounded-r-none"]),"onUpdate:modelValue":t[0]||(t[0]=l=>o.tempImageUrl=l),placeholder:""},null,2),[[I,o.tempImageUrl]])]),_:1}),e("button",{type:"button",class:"btn btn-primary text-nowrap rounded-l-none",disabled:!o.tempImageUrl,onClick:t[1]||(t[1]=i=>o.tempProduct.imageUrl=o.tempImageUrl)}," 加入圖片 ",8,ce)])],64)),ue,pe,ge,s(U,{"return-url":!0,isMultiple:!0,onEmitChange:c.addImagesUrlArray,isLoading:a.loadingStatus.imagesUrl,class:"mb-3"},null,8,["onEmitChange","isLoading"]),e("div",_e,[s(u,{"label-for":"imageUrl",label:"圖片網址",class:"flex-grow"},{default:n(({inputClass:i})=>[P(e("input",{type:"text",name:"圖片",id:"imageUrl",class:m([i,"rounded-r-none"]),placeholder:"","onUpdate:modelValue":t[3]||(t[3]=l=>o.tempImagesUrl=l)},null,2),[[I,o.tempImagesUrl]])]),_:1}),s(C,{class:"btn btn-primary text-nowrap rounded-l-none",isLoading:a.loadingStatus.imagesUrl,disabled:!o.tempImagesUrl,onClick:t[4]||(t[4]=i=>c.addImagesUrl(o.tempImagesUrl))},{default:n(()=>[V("加入圖片")]),_:1},8,["isLoading","disabled"])]),Array.isArray(o.tempProduct.imagesUrl)?(p(),_("div",he,[(p(!0),_(y,null,F(o.tempProduct.imagesUrl,(i,l)=>(p(),L(x,{key:`img${l}`,image:i,onHandleDelete:Ye=>o.tempProduct.imagesUrl.splice(l,1)},null,8,["image","onHandleDelete"]))),128))])):B("",!0)]),be,e("div",fe,[e("div",Pe,[e("div",we,[s(u,{"label-for":"title",label:"名稱",errors:b},{default:n(({inputClass:i})=>[s(h,{type:"text",name:"名稱",id:"title",modelValue:o.tempProduct.title,"onUpdate:modelValue":t[5]||(t[5]=l=>o.tempProduct.title=l),class:m(i),rules:"required",placeholder:"",required:""},null,8,["modelValue","class"])]),_:2},1032,["errors"])]),e("div",ye,[s(u,{"label-for":"stock",label:"庫存",errors:b},{default:n(({inputClass:i})=>[s(h,{type:"number",name:"庫存",min:"0",id:"stock",modelValue:o.tempProduct.stock,"onUpdate:modelValue":t[6]||(t[6]=l=>o.tempProduct.stock=l),modelModifiers:{number:!0},class:m(i),rules:"required",placeholder:"",required:""},null,8,["modelValue","class"])]),_:2},1032,["errors"])])]),e("div",Ue,[e("div",xe,[s(u,{"label-for":"category",label:"類別",errors:b},{default:n(({inputClass:i})=>[s(h,{type:"text",name:"類別",id:"category",list:"categoryList",modelValue:o.tempProduct.category,"onUpdate:modelValue":t[7]||(t[7]=l=>o.tempProduct.category=l),class:m(i),rules:"required",placeholder:"",required:""},null,8,["modelValue","class"]),e("datalist",ve,[(p(!0),_(y,null,F(d.categories,l=>(p(),_("option",{key:l,value:l},f(l),9,Ie))),128))])]),_:2},1032,["errors"])]),e("div",Ve,[s(u,{"label-for":"origin_price",label:"原價",errors:b},{default:n(({inputClass:i})=>[s(h,{type:"number",name:"原價",min:"0",id:"origin_price",modelValue:o.tempProduct.origin_price,"onUpdate:modelValue":t[8]||(t[8]=l=>o.tempProduct.origin_price=l),modelModifiers:{number:!0},class:m(i),rules:"required",placeholder:"",required:""},null,8,["modelValue","class"])]),_:2},1032,["errors"])])]),e("div",Me,[e("div",Se,[s(u,{"label-for":"unit",label:"單位",errors:b},{default:n(({inputClass:i})=>[s(h,{type:"text",name:"單位",id:"unit",modelValue:o.tempProduct.unit,"onUpdate:modelValue":t[9]||(t[9]=l=>o.tempProduct.unit=l),class:m(i),rules:"required",placeholder:"",required:""},null,8,["modelValue","class"])]),_:2},1032,["errors"])]),e("div",Ae,[s(u,{"label-for":"price",label:"售價",errors:b},{default:n(({inputClass:i})=>[s(h,{type:"number",name:"售價",min:"0",id:"price",modelValue:o.tempProduct.price,"onUpdate:modelValue":t[10]||(t[10]=l=>o.tempProduct.price=l),modelModifiers:{number:!0},class:m(i),rules:"required",placeholder:"",required:""},null,8,["modelValue","class"])]),_:2},1032,["errors"])])]),Ce,s(u,{"label-for":"description",label:"產品描述"},{default:n(({inputClass:i})=>[P(e("textarea",{type:"text",name:"產品描述",id:"description","onUpdate:modelValue":t[11]||(t[11]=l=>o.tempProduct.description=l),class:m(i),placeholder:""},`
            `,2),[[I,o.tempProduct.description]])]),_:1}),s(u,{"label-for":"content",label:"說明內容"},{default:n(({inputClass:i})=>[P(e("textarea",{type:"text",name:"說明內容",id:"content","onUpdate:modelValue":t[12]||(t[12]=l=>o.tempProduct.content=l),class:m(i),placeholder:""},`
            `,2),[[I,o.tempProduct.content]])]),_:1}),s(v,{"label-for":"is_enabled",label:"是否上架"},{default:n(({inputClass:i})=>[P(e("input",{id:"is_enabled",class:m(i),type:"checkbox","true-value":1,"false-value":0,"onUpdate:modelValue":t[13]||(t[13]=l=>o.tempProduct.is_enabled=l)},null,2),[[H,o.tempProduct.is_enabled]])]),_:1})]),e("div",Fe,[e("button",{type:"button",class:"btn btn-outline-primary me-3",onClick:t[14]||(t[14]=i=>{c.closeModal(),c.resetModalForm()})}," 取消編輯 "),Le])]),_:1},8,["onSubmit"])]),_:1},8,["onResetForm"])}const ke=D(oe,[["render",Ee]]);var Te={VITE_URL:"https://ec-course-api.hexschool.io/v2",VITE_PATH:"jiayu",BASE_URL:"/Chocolate-Shop/",MODE:"production",DEV:!1,PROD:!0,SSR:!1};const{VITE_URL:E,VITE_PATH:k}=Te,De={components:{ProductModal:ke,PaginationComponent:X,AdminActionBtns:Q,TableComponent:W,ActiveBadge:Y,LoadingBtn:q},data(){return{products:[],tempProduct:{},categories:[],isNew:!1,pagination:{}}},mounted(){this.showLoading(),this.getAdminProducts()},methods:{async getAdminProducts(a=1){try{const t=`${E}/api/${k}/admin/products?page=${a}`,{data:d}=await this.$http.get(t);this.products=d.products,this.pagination=d.pagination,this.categories=this.removeDuplicateArray(this.products,"category"),this.loadingStatus.productId="",this.hideLoading()}catch(t){this.hideLoading(),this.apiErrorSwal(t)}},async delProduct(a){if((await this.delSwal("產品",a.title)).isConfirmed)try{this.loadingStatus.productId=a.id;const d=`${E}/api/${k}/admin/product/${a.id}`;await this.$http.delete(d),this.getAdminProducts(this.pagination.current_page),this.swalToast(`已刪除產品「${a.title}」`),this.loadingStatus.productId=""}catch(d){this.loadingStatus.productId="",this.$swals(d.data.message||"發生錯誤，請稍後再試")}},openModal(a,t){switch(a){case"new":this.tempProduct={imagesUrl:[],is_enabled:0},this.isNew=!0;break;case"edit":this.tempProduct={...t},Array.isArray(this.tempProduct.imagesUrl)||(this.tempProduct.imagesUrl=[]),this.isNew=!1;break}this.$refs.productModal.showModal()},...w(M,["showLoading","hideLoading"]),...w(R,["swalToast","delSwal","apiErrorSwal"]),...w(O,["removeDuplicateArray"])},computed:{...T(M,["loadingStatus"])}},Be={class:"mb-8 flex items-center justify-between"},Re=e("h2",{class:"text-2xl font-bold"},"產品管理",-1),qe={key:0,class:"bi bi-plus-lg me-1"},Ne=e("th",{scope:"col",class:"min-w-8"},"分類",-1),He=e("th",{scope:"col",class:"min-w-24"},"產品名稱",-1),Oe=e("th",{scope:"col",class:"min-w-9 text-end"},"原價",-1),je=e("th",{scope:"col",class:"min-w-9 text-end"},"售價",-1),Ge=e("th",{scope:"col",class:"min-w-9 text-end"},"庫存",-1),ze=e("th",{scope:"col",class:"text-center"},"狀態",-1),$e=e("th",{scope:"col"},null,-1),Je={class:"text-end"},Ke={class:"text-end"},Qe={class:"text-end"},We={class:"text-center"};function Xe(a,t,d,S,o,c){const A=r("LoadingBtn"),U=r("ActiveBadge"),u=r("AdminActionBtns"),x=r("TableComponent"),C=r("PaginationComponent"),h=r("ProductModal");return p(),_(y,null,[e("div",Be,[Re,s(A,{class:"btn btn-primary",isLoading:a.loadingStatus.newProduct,onClick:t[0]||(t[0]=v=>c.openModal("new"))},{default:n(()=>[a.loadingStatus.newProduct?B("",!0):(p(),_("i",qe)),V("新增產品 ")]),_:1},8,["isLoading"])]),s(x,{class:"mb-8"},{th:n(()=>[Ne,He,Oe,je,Ge,ze,$e]),tr:n(({trClass:v})=>[(p(!0),_(y,null,F(o.products,g=>(p(),_("tr",{class:m(v),key:g.id},[e("td",null,f(g.category),1),e("td",null,f(g.title),1),e("td",Je,f(g.origin_price),1),e("td",Ke,f(g.price),1),e("td",Qe,f(g.stock),1),e("td",We,[s(U,{active:g.is_enabled},{trueMsg:n(()=>[V("上架")]),falseMsg:n(()=>[V("下架")]),_:2},1032,["active"])]),e("td",null,[s(u,{data:g,loadingId:"productId",onOpenModal:c.openModal,onDelItem:c.delProduct},null,8,["data","onOpenModal","onDelItem"])])],2))),128))]),_:1}),s(C,{pagination:o.pagination,onGetData:c.getAdminProducts},null,8,["pagination","onGetData"]),s(h,{ref:"productModal",product:o.tempProduct,"is-new":o.isNew,pagination:o.pagination,categories:o.categories,onGetData:c.getAdminProducts},null,8,["product","is-new","pagination","categories","onGetData"])],64)}const ut=D(De,[["render",Xe]]);export{ut as default};
