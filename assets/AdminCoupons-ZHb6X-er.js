import{m as C,a as D,_ as I,o as f,c as k,w as i,b as o,t as g,n as c,d as a,j as T,L as v,r as l,e as w,F as A,g as B,f as _,i as R}from"./index-SPJMaqR3.js";import{P as $}from"./PaginationComponent-D6uM6aI7.js";import{l as M}from"./loadingStore-CJtaXRw7.js";import{F as U,C as P,T as N,A as O}from"./AdminActionBtns-C-4e1dEU.js";import{s as x}from"./swalStore-vCGr3xOB.js";import{L as q}from"./LoadingBtn-BJCr2oP3.js";import{h as j}from"./helperStore-B2m3bXAV.js";import{A as H}from"./ActiveBadge-D7NInnZ1.js";import{F as G}from"./FormFloat-BzVZ9BRi.js";import"./XBtn-BERFysW5.js";import"./scrollStore-IXS9VN8h.js";var z={VITE_URL:"https://ec-course-api.hexschool.io/v2",VITE_PATH:"jiayu",BASE_URL:"/Chocolate-Shop/",MODE:"production",DEV:!1,PROD:!0,SSR:!1};const{VITE_URL:W,VITE_PATH:J}=z,K={components:{FormModal:U,FormFloat:G,ChecksRadio:P},props:{coupon:Object,isNew:Boolean,pagination:Object},data(){return{tempCoupon:{}}},mounted(){this.tempCoupon=this.coupon},watch:{coupon(){this.tempCoupon=this.coupon,String(this.tempCoupon.due_date).length===10&&(this.tempCoupon.due_date*=1e3)}},methods:{showModal(){this.$refs.couponFormModal.showModal()},closeModal(){this.$refs.couponFormModal.closeModal()},resetModalForm(){this.$refs.couponForm.resetForm()},async updateCoupon(){try{let n=`${W}/api/${J}/admin/coupon`,e="post",d=1;this.tempCoupon.code=this.tempCoupon.code.toUpperCase();const S=`已${this.isNew?"新增":"更新"}優惠券「${this.tempCoupon.title}」`;String(this.tempCoupon.due_date).length===13&&(this.tempCoupon.due_date=Math.floor(this.tempCoupon.due_date/1e3)),this.isNew?this.loadingStatus.newCoupon=!0:(n+=`/${this.tempCoupon.id}`,e="put",d=this.pagination.current_page,this.loadingStatus.couponId=this.tempCoupon.id),this.closeModal(),await this.$http[e](n,{data:this.tempCoupon}),this.resetModalForm(),this.$emit("getData",d),this.loadingStatus.couponId="",this.loadingStatus.newCoupon=!1,this.swalToast(S)}catch(n){this.loadingStatus.couponId="",this.loadingStatus.newCoupon=!1,this.apiErrorSwal(n)}},...C(x,["swalToast","apiErrorSwal"]),...C(M,["showLoading","hideLoading"])},computed:{...D(M,["loadingStatus"])}},Q={class:"flex h-full flex-col gap-6"},X=o("p",{class:"mt-1 text-stone-500"},"※ 優惠碼英文小寫將會被轉成大寫",-1),Y={class:"flex gap-3"},Z={class:"w-1/3"},ee={class:"w-2/3"},oe={class:"mt-5 text-end"},te=o("button",{type:"submit",class:"btn btn-primary"},"儲存編輯",-1);function ne(n,e,d,S,s,p){const h=l("VField"),m=l("FormFloat"),V=l("VueDatePicker"),b=l("ChecksRadio"),y=l("VForm"),F=l("FormModal");return f(),k(F,{target:"coupon",ref:"couponFormModal",onResetForm:p.resetModalForm},{title:i(({titleClass:u})=>[o("h3",{class:c(u)},g(d.isNew?"新增":"編輯")+"優惠券",3)]),default:i(()=>[a(y,{ref:"couponForm",onSubmit:p.updateCoupon},{default:i(({errors:u})=>[o("div",Q,[a(m,{"label-for":"title",label:"名稱",errors:u},{default:i(({inputClass:t})=>[a(h,{type:"text",name:"名稱",id:"title",modelValue:s.tempCoupon.title,"onUpdate:modelValue":e[0]||(e[0]=r=>s.tempCoupon.title=r),class:c(t),rules:"required",placeholder:"",required:""},null,8,["modelValue","class"])]),_:2},1032,["errors"]),o("div",null,[a(m,{"label-for":"code",label:"優惠碼",errors:u},{default:i(({inputClass:t})=>[a(h,{type:"text",name:"優惠碼",id:"code",modelValue:s.tempCoupon.code,"onUpdate:modelValue":e[1]||(e[1]=r=>s.tempCoupon.code=r),class:c(t),rules:"required",placeholder:"",required:""},null,8,["modelValue","class"])]),_:2},1032,["errors"]),X]),o("div",Y,[o("div",Z,[a(m,{"label-for":"percent",label:"折扣 (%)",errors:u},{default:i(({inputClass:t})=>[a(h,{type:"number",min:"0",step:"5",name:"折扣 (%)",id:"percent",modelValue:s.tempCoupon.percent,"onUpdate:modelValue":e[2]||(e[2]=r=>s.tempCoupon.percent=r),modelModifiers:{number:!0},class:c(t),rules:"required",placeholder:"",required:""},null,8,["modelValue","class"])]),_:2},1032,["errors"])]),o("div",ee,[a(m,{"label-for":"due_date",label:"期限"},{default:i(()=>[a(V,{modelValue:s.tempCoupon.due_date,"onUpdate:modelValue":e[3]||(e[3]=t=>s.tempCoupon.due_date=t),"model-type":"timestamp","enable-time-picker":!1,format:"yyyy/MM/dd",locale:"zh-TW","day-names":["一","二","三","四","五","六","日"],"hide-input-icon":"",clearable:!1,"teleport-center":"","auto-apply":"",required:""},null,8,["modelValue"])]),_:1})])]),a(b,{"label-for":"is_enabled",label:"是否啟用"},{default:i(({inputClass:t})=>[T(o("input",{id:"is_enabled",class:c(t),type:"checkbox","onUpdate:modelValue":e[4]||(e[4]=r=>s.tempCoupon.is_enabled=r),"true-value":1,"false-value":0},null,2),[[v,s.tempCoupon.is_enabled]])]),_:1}),a(b,{"label-for":"is_main",label:"是否為主打優惠 (會推播在首頁)"},{default:i(({inputClass:t})=>[T(o("input",{id:"is_main",class:c(t),type:"checkbox","onUpdate:modelValue":e[5]||(e[5]=r=>s.tempCoupon.is_main=r)},null,2),[[v,s.tempCoupon.is_main]])]),_:1}),o("div",oe,[o("button",{type:"button",class:"btn btn-outline-primary me-3",onClick:e[6]||(e[6]=t=>{p.closeModal(),p.resetModalForm()})}," 取消編輯 "),te])])]),_:1},8,["onSubmit"])]),_:1},8,["onResetForm"])}const se=I(K,[["render",ne]]);var ae={VITE_URL:"https://ec-course-api.hexschool.io/v2",VITE_PATH:"jiayu",BASE_URL:"/Chocolate-Shop/",MODE:"production",DEV:!1,PROD:!0,SSR:!1};const{VITE_URL:L,VITE_PATH:E}=ae,ie={components:{TableComponent:N,PaginationComponent:$,AdminActionBtns:O,ActiveBadge:H,CouponModal:se,LoadingBtn:q},data(){return{coupons:[],tempCoupon:{},isNew:!1,pagination:{}}},mounted(){this.showLoading(),this.getAdminCoupons()},methods:{async getAdminCoupons(n=1){try{const e=`${L}/api/${E}/admin/coupons?page=${n}`,d=await this.$http.get(e);this.coupons=d.data.coupons,this.pagination=d.data.pagination,this.hideLoading()}catch(e){this.hideLoading(),this.apiErrorSwal(e)}},async delCoupon(n){try{if((await this.delSwal("優惠券",n.title)).isConfirmed){this.loadingStatus.couponId=n.id;const d=`${L}/api/${E}/admin/coupon/${n.id}`;await this.$http.delete(d),this.getAdminCoupons(),this.swalToast(`已刪除優惠券「${n.title}」`),this.loadingStatus.couponId=""}}catch(e){this.loadingStatus.couponId="",this.apiErrorSwal(e)}},openModal(n,e){switch(n){case"new":this.tempCoupon={is_enabled:0,is_main:!1,due_date:new Date().getTime()},this.isNew=!0;break;case"edit":this.tempCoupon={...e},this.isNew=!1;break}this.$refs.couponModal.showModal()},...C(x,["delSwal","swalToast","apiErrorSwal"]),...C(M,["showLoading","hideLoading"]),...C(j,["timestampToDate"])},computed:{...D(M,["isLoading","loadingStatus"])}},le={class:"mb-8 flex items-center justify-between"},de=o("h2",{class:"text-2xl font-bold"},"優惠券管理",-1),pe={key:0,class:"bi bi-plus-lg me-1"},re=o("th",{scope:"col"},"名稱",-1),ue=o("th",{scope:"col"},"折扣 (%)",-1),me=o("th",{scope:"col"},"優惠碼",-1),ce=o("th",{scope:"col"},"期限",-1),he=o("th",{scope:"col"},"啟用",-1),_e=o("th",{scope:"col"},"主打",-1);function fe(n,e,d,S,s,p){const h=l("LoadingBtn"),m=l("ActiveBadge"),V=l("AdminActionBtns"),b=l("TableComponent"),y=l("PaginationComponent"),F=l("CouponModal");return f(),w(A,null,[o("div",le,[de,a(h,{class:"btn btn-primary",isLoading:n.loadingStatus.newCoupon,onClick:e[0]||(e[0]=u=>p.openModal("new"))},{default:i(()=>[n.loadingStatus.newCoupon?B("",!0):(f(),w("i",pe)),_("新增優惠券 ")]),_:1},8,["isLoading"])]),a(b,{class:"mb-8 table-auto"},{th:i(()=>[re,ue,me,ce,he,_e]),tr:i(({trClass:u})=>[(f(!0),w(A,null,R(s.coupons,t=>(f(),w("tr",{class:c(u),key:t.id},[o("td",null,g(t.title),1),o("td",null,g(t.percent),1),o("td",null,g(t.code),1),o("td",null,g(n.timestampToDate(t.due_date)),1),o("td",null,[a(m,{active:t.is_enabled},{trueMsg:i(()=>[_("啟用")]),falseMsg:i(()=>[_("未啟用")]),_:2},1032,["active"])]),o("td",null,[a(m,{active:t.is_main},{trueMsg:i(()=>[_("主打")]),falseMsg:i(()=>[_("非主打")]),_:2},1032,["active"])]),o("td",null,[a(V,{data:t,loadingId:"couponId",onOpenModal:p.openModal,onDelItem:p.delCoupon},null,8,["data","onOpenModal","onDelItem"])])],2))),128))]),_:1}),a(y,{pagination:s.pagination,onGetData:p.getAdminCoupons},null,8,["pagination","onGetData"]),a(F,{ref:"couponModal",coupon:s.tempCoupon,"is-new":s.isNew,pagination:s.pagination,onGetData:p.getAdminCoupons},null,8,["coupon","is-new","pagination","onGetData"])],64)}const Ae=I(ie,[["render",fe]]);export{Ae as default};
