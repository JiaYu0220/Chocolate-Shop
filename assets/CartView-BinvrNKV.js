import{m as h,a as L,_ as N,o as n,e as m,d as s,w as r,b as e,j as I,D,n as u,f as p,t as b,g as E,F as k,h as d,r as S,c as M}from"./index-Qo5PjSfa.js";import{l as A}from"./loadingStore--S7_x2aB.js";import{c as x}from"./cartStore-CthV6h9C.js";import{C as O}from"./CartCard-5jwpXuNn.js";import{F as B}from"./FormFloat-yDZpGOgV.js";import{L as $}from"./LoadingBtn-DWsPix3f.js";import{s as q}from"./swalStore-CDhF8vg1.js";import{M as R,X as j}from"./XBtn-DwqEF5HU.js";import{v as P}from"./validateStore-C4d01oMI.js";import"./scrollStore-DSjfpGxi.js";const X={props:["swalContainer"],components:{FormFloat:B,LoadingBtn:$},data(){return{couponCode:""}},methods:{handleUseCoupon(){this.container?this.postCoupon(this.couponCode,this.container):this.postCoupon(this.couponCode),this.couponCode=""},...h(x,["postCoupon"])},computed:{...L(x,["usedCoupon"]),...L(A,["loadingStatus"])}},H={class:"flex border border-stone-300 rounded-md"},z=e("datalist",{id:"couponList"},[e("option",{value:"ILOVECACAO"},"ILOVECACAO")],-1),G={key:0,class:"text-primary-800"};function J(t,o,w,V,l,C){const y=d("LoadingBtn"),v=d("FormFloat");return n(),m(k,null,[s(v,{"label-for":"coupon",label:"優惠券"},{default:r(({inputClass:g})=>[e("div",H,[I(e("input",{type:"text",list:"couponList",name:"coupon",id:"coupon",class:u([g,"rounded-r-none border-0"]),"onUpdate:modelValue":o[0]||(o[0]=F=>l.couponCode=F),placeholder:""},null,2),[[D,l.couponCode]]),z,s(y,{class:"btn btn-primary-light rounded-l-none text-nowrap shadow-none",isLoading:t.loadingStatus.newCoupon,onClick:C.handleUseCoupon,disabled:!l.couponCode},{default:r(()=>[p(" 使用")]),_:1},8,["isLoading","onClick","disabled"])])]),_:1}),t.usedCoupon?(n(),m("p",G,"已使用優惠券："+b(t.usedCoupon),1)):E("",!0)],64)}const K=N(X,[["render",J]]);var Q={VITE_URL:"https://ec-course-api.hexschool.io/v2",VITE_PATH:"jiayu",BASE_URL:"/Chocolate-Shop/",MODE:"production",DEV:!1,PROD:!0,SSR:!1};const{VITE_URL:W,VITE_PATH:Y}=Q,Z={components:{CartCard:O,FormFloat:B,CouponInput:K,ModalComponent:R,XBtn:j},data(){return{user:{},message:"",isFinish:!1}},methods:{closeDetailModal(){this.$refs.detailModal.closeModal()},async postOrder(){if(this.cartNum)try{if((await this.confirmSwal("確定提交訂單？")).isConfirmed){this.showLoading();const o=`${W}/api/${Y}/order`,w={user:this.user,message:this.message},V=await this.$http.post(o,{data:w});this.hideLoading(),this.$refs.form.resetForm(),(await this.$swal(V.data.message)).isConfirmed&&(this.isFinish=!0,this.getCart())}}catch(t){this.hideLoading();const{message:o}=t.response.data;this.$swal(Array.isArray(o)?o[0]:o)}else this.$swal("請選購商品後再提交表單")},...h(x,["delAllCart","postCoupon","getCart"]),...h(q,["confirmSwal"]),...h(P,["isPhone"]),...h(A,["showLoading","hideLoading"])},computed:{...L(x,["cartNum","carts","total","final_total","usedCoupon"])}},ee={key:0,class:"h-full flex flex-col justify-center items-center"},te=e("p",{class:"text-5xl mb-10"},"訂單已建立",-1),oe={key:0,class:"flex flex-col"},se={class:"mb-4 border border-primary-200 rounded-md"},le=e("h2",{class:"text-lg font-bold text-center text-primary-800 bg-primary-200 py-2 md:text-xl"}," 訂單金額 ",-1),ae={class:"p-4"},ne={class:"mt-4 md:text-lg"},re={class:"float-end"},de={key:0,class:"mt-4 text-lg md:text-xl text-bold text-primary-800"},ie={class:"float-end"},ce={class:"hidden border border-primary-200 rounded-md md:block"},me=e("h3",{class:"text-lg font-bold text-center text-primary-800 bg-primary-200 py-2"}," 購物清單 ",-1),ue={class:"p-4"},pe={class:"mb-2"},_e={class:"flex flex-col gap-8 mb-8"},fe=e("i",{class:"bi bi-chevron-down ml-2"},null,-1),he={class:"p-6"},be={class:"flex justify-between mb-4"},Ce=e("p",{class:"text-lg text-primary-800 font-bold"},"購物清單",-1),ye={class:"mb-2"},ge={class:"flex flex-col gap-8 mb-8"},xe=e("hr",{class:"border-primary-700 border-dotted md:hidden"},null,-1),we={key:1,class:"flex justify-center items-center"},Ve={class:"text-center"},ve=e("i",{class:"bi bi-cart-x text-8xl"},null,-1),Fe=e("p",{class:"py-6"},"你的購物車是空的",-1),Le={class:"bg-primary-200 p-4 rounded-md"},ke=e("h2",{class:"text-lg font-bold text-center text-primary-800 mt-2 mb-4 md:mb-6 md:text-xl"}," 收件者資訊 ",-1),Se={class:"mb-3"},Me={class:"mb-3"},Ne={class:"mb-3"},Ee={class:"mb-3"},Ae={class:"mb-3"},Be=e("div",{class:"text-center"},[e("button",{type:"submit",class:"btn btn-primary w-full"},"送出訂單")],-1);function Ue(t,o,w,V,l,C){const y=d("RouterLink"),v=d("CouponInput"),g=d("CartCard"),F=d("XBtn"),U=d("ModalComponent"),_=d("VField"),f=d("FormFloat"),T=d("VForm");return l.isFinish?(n(),m("div",ee,[te,s(y,{to:"/products",class:"btn btn-primary btn-lg text-lg"},{default:r(()=>[p("繼續購物")]),_:1})])):(n(),m("div",{key:1,class:u(["container py-10 flex flex-col gap-5 md:gap-10 *:w-full md:flex-row md:*:w-1/2",{"items-start":t.cartNum}])},[e("div",{class:u({"self-center":!t.cartNum})},[t.cartNum?(n(),m("div",oe,[e("div",se,[le,e("div",ae,[s(v),e("p",ne,[p("總計"),e("span",re,"NT$ "+b(t.total),1)]),t.total!==t.final_total?(n(),m("p",de,[p(" 折扣價"),e("span",ie,"NT$ "+b(t.final_total),1)])):E("",!0)])]),e("div",ce,[me,e("div",ue,[e("p",pe,"共 "+b(t.cartNum)+" 項商品",1),e("ul",_e,[(n(!0),m(k,null,S(t.carts,a=>(n(),M(g,{key:a.id,cart:a,canEdit:!1},null,8,["cart"]))),128))])])]),e("button",{type:"button",class:"btn btn-primary-light text-lg font-bold w-full mb-5 md:hidden",onClick:o[0]||(o[0]=(...a)=>t.$refs.detailModal.showModal&&t.$refs.detailModal.showModal(...a))},[p(" 確認購物清單"),fe]),s(U,{ref:"detailModal",direction:"up",class:"mb-0 rounded-sm"},{default:r(()=>[e("div",he,[e("div",be,[Ce,s(F,{class:"-mt-2",onClick:C.closeDetailModal},null,8,["onClick"])]),e("p",ye,"共 "+b(t.cartNum)+" 項商品",1),e("ul",ge,[(n(!0),m(k,null,S(t.carts,a=>(n(),M(g,{key:a.id,cart:a,canEdit:!1},null,8,["cart"]))),128))])])]),_:1},512),xe])):(n(),m("div",we,[e("div",Ve,[ve,Fe,s(y,{to:"/products",class:"btn btn-primary"},{default:r(()=>[p("開始購物")]),_:1})])]))],2),e("div",Le,[ke,s(T,{ref:"form",onSubmit:C.postOrder},{default:r(({errors:a})=>[e("div",Se,[s(f,{"label-for":"myName",label:"收件人姓名",errors:a},{default:r(({inputClass:i})=>[s(_,{id:"myName",name:"收件人姓名",type:"text",class:u(i),rules:"required",modelValue:l.user.name,"onUpdate:modelValue":o[1]||(o[1]=c=>l.user.name=c),required:""},null,8,["class","modelValue"])]),_:2},1032,["errors"])]),e("div",Me,[s(f,{"label-for":"email",label:"電子信箱",errors:a},{default:r(({inputClass:i})=>[s(_,{id:"email",name:"電子信箱",type:"email",class:u(i),rules:"email|required",modelValue:l.user.email,"onUpdate:modelValue":o[2]||(o[2]=c=>l.user.email=c),required:""},null,8,["class","modelValue"])]),_:2},1032,["errors"])]),e("div",Ne,[s(f,{"label-for":"tel",label:"收件人電話",errors:a},{default:r(({inputClass:i})=>[s(_,{id:"tel",name:"收件人電話",type:"tel",class:u(i),rules:t.isPhone,modelValue:l.user.tel,"onUpdate:modelValue":o[3]||(o[3]=c=>l.user.tel=c),required:""},null,8,["class","rules","modelValue"])]),_:2},1032,["errors"])]),e("div",Ee,[s(f,{"label-for":"address",label:"收件人地址",errors:a},{default:r(({inputClass:i})=>[s(_,{id:"address",name:"收件人地址",type:"text",class:u(i),rules:"required",modelValue:l.user.address,"onUpdate:modelValue":o[4]||(o[4]=c=>l.user.address=c),required:""},null,8,["class","modelValue"])]),_:2},1032,["errors"])]),e("div",Ae,[s(f,{"label-for":"message",label:"留言"},{default:r(({inputClass:i})=>[s(_,{id:"message",name:"留言",type:"text",class:u(i),as:"textarea",modelValue:l.message,"onUpdate:modelValue":o[5]||(o[5]=c=>l.message=c)},null,8,["class","modelValue"])]),_:1})]),Be]),_:1},8,["onSubmit"])])],2))}const He=N(Z,[["render",Ue]]);export{He as default};
