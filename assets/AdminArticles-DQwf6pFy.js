import{m as y,a as P,_ as B,o as r,c as O,w as c,b as t,t as g,n as h,d as a,e as p,k,v as F,F as f,x as q,r as T,g as D,f as v,h as m}from"./index-DTQ0iRKP.js";import{l as C}from"./loadingStore-JENbuUSr.js";import{s as R}from"./LoadingBtn-Cg_DCWH5.js";import{h as j}from"./helperStore-BCnCi6cg.js";import{P as H}from"./PaginationComponent-BZ9-TW_V.js";import{C as G,a as z,T as J,A as K}from"./AdminActionBtns-FfIeA5xV.js";import{A as Q}from"./ActiveBadge-C_J7uWSL.js";import{F as W}from"./FormFloat-CeWoF_W0.js";import{a as X,F as Y,C as Z}from"./CopyBtn-DoyGhgHH.js";import"./XBtn-DEABgxoA.js";import"./scrollStore-DtuFW_f2.js";var tt={VITE_URL:"https://ec-course-api.hexschool.io/v2",VITE_PATH:"jiayu",BASE_URL:"/Chocolate-Shop/",MODE:"production",DEV:!1,PROD:!0,SSR:!1};const{VITE_URL:U,VITE_PATH:L}=tt,et={components:{CenterModal:G,FormFloat:W,ChecksRadio:z,CropperComponent:X,FileInput:Y,CopyBtn:Z},props:{id:String,tags:Array,isNew:Boolean,pagination:Object},data(){return{tempArticle:{},tempId:"",tempImageUrl:"",tempTag:"",isTagDuplicate:!1,loading:!0}},methods:{async showModal(){this.$refs.articleCenterModal.showModal()},closeModal(){this.$refs.articleCenterModal.closeModal()},async getSingleArticle(l){try{this.loadingStatus.editArticle=!0;const e=`${U}/api/${L}/admin/article/${l}`,o=await this.$http.get(e);this.tempArticle=o.data.article,Array.isArray(this.tempArticle.tag)||(this.tempArticle.tag=[]),this.loadingStatus.editArticle=!1}catch(e){this.loadingStatus.editArticle=!1;const{message:o}=e.response.data;this.$swal(Array.isArray(o)?o[0]:o)}},resetModalForm(){this.$refs.articleForm.resetForm(),this.tempArticle.image="",console.log(this.tempArticle),this.tempTag="",this.isTagDuplicate=!1},addImageUrl(l){this.tempArticle.image=l},addTag(){if(this.tempArticle.tag.includes(this.tempTag)){this.isTagDuplicate=!0;return}this.tempArticle.tag.push(this.tempTag),this.tempTag=""},async updateArticle(){try{console.log("開始",this.tempArticle);let l=`${U}/api/${L}/admin/article`,e="post",o=1;this.tempArticle.create_at=Math.floor(new Date().getTime()/1e3);const I=`已${this.isNew?"新增":"更新"}文章「${this.tempArticle.title}」`;this.isNew||(l+=`/${this.tempArticle.id}`,e="put",o=this.pagination.current_page,this.loadingStatus.articleId=this.tempArticle.id),this.closeModal(),await this.$http[e](l,{data:this.tempArticle}),this.resetModalForm(),this.$emit("getData",o),this.loadingStatus.articleId="",this.swalToast(I)}catch(l){this.loadingStatus.articleId="";const{message:e}=l.response.data;this.$swal(Array.isArray(e)?e[0]:e)}},...y(R,["swalToast"]),...y(C,["showLoading","hideLoading"])},computed:{...P(C,["loadingStatus"])}},st={class:"flex justify-between items-end mb-3"},ot=t("h4",{class:"text-xl font-bold text-primary-800"},"圖片",-1),lt={class:"pb-4 md:pb-8 mb-4 border-b border-primary-700"},it=t("p",{class:"mb-2"},"請選擇圖片檔案或貼上圖片網址：",-1),at={class:"flex mb-5"},nt=["disabled"],rt={key:1,class:"mb-3 md:w-1/2"},dt={class:"relative border-2 border-primary-300 rounded-md p-1"},ct=["src"],mt=t("i",{class:"bi bi-trash-fill"},null,-1),pt=[mt],ut=t("h4",{class:"text-xl font-bold text-primary-800 mb-4"},"文字",-1),ht={class:"flex flex-col gap-3"},gt={class:"flex gap-3"},_t={class:"w-1/2"},bt={class:"w-1/2"},At={class:"flex w-fill md:w-1/2"},ft={id:"tagList"},yt=["value"],xt={key:0,class:"text-red-600"},wt={key:1,class:"flex flex-wrap gap-1"},vt=["onClick"],Tt=t("i",{class:"bi bi-x text-lg transition duration-150 group-hover:text-orange-700"},null,-1),Ct={class:"mt-5 text-end"},It=t("button",{type:"submit",class:"btn btn-primary"}," 儲存編輯",-1);function Mt(l,e,o,I,s,u){const M=m("CropperComponent"),V=m("FileInput"),_=m("FormFloat"),S=m("CopyBtn"),A=m("VField"),x=m("ChecksRadio"),d=m("VForm"),w=m("LoadingOverlay"),N=m("CenterModal");return r(),O(N,{target:"article",ref:"articleCenterModal",onResetForm:u.resetModalForm},{title:c(({titleClass:b})=>[t("h3",{class:h(b)},g(o.isNew?"新增":"編輯")+"文章",3)]),default:c(()=>[a(d,{ref:"articleForm",onSubmit:u.updateArticle},{default:c(({errors:b})=>[t("div",st,[ot,a(M,{"down-name":"文章"})]),t("div",lt,[s.tempArticle.image?(r(),p("div",rt,[t("div",dt,[t("img",{src:s.tempArticle.image,class:"object-cover rounded-sm",alt:"產品圖"},null,8,ct),a(S,{text:s.tempArticle.image,msg:"圖片網址",class:"absolute right-0 bottom-0 p-1 rounded-md bg-primary-50 text-primary-800 duration-150 hover:text-primary-300"},null,8,["text"]),t("button",{type:"button",class:"absolute right-0 top-0 p-1 rounded-md bg-primary-50 text-primary-800 duration-150 hover:text-red-500 focus:text-red-500",onClick:e[2]||(e[2]=i=>s.tempArticle.image="")},pt)])])):(r(),p(f,{key:0},[it,a(V,{"return-url":!0,onEmitChange:u.addImageUrl,class:"mb-3",isLoading:l.loadingStatus.imageUrl},null,8,["onEmitChange","isLoading"]),t("div",at,[a(_,{"label-for":"imageUrl",label:"圖片網址",class:"flex-grow"},{default:c(({inputClass:i})=>[k(t("input",{type:"text",name:"文章圖片",id:"imageUrl",class:h([i,"rounded-r-none"]),"onUpdate:modelValue":e[0]||(e[0]=n=>s.tempImageUrl=n),placeholder:""},null,2),[[F,s.tempImageUrl]])]),_:1}),t("button",{type:"button",class:"btn btn-primary rounded-l-none text-nowrap",disabled:!s.tempImageUrl,onClick:e[1]||(e[1]=i=>s.tempArticle.image=s.tempImageUrl)},"加入圖片",8,nt)])],64))]),ut,t("div",ht,[a(_,{"label-for":"title",label:"標題",errors:b},{default:c(({inputClass:i})=>[a(A,{type:"text",name:"標題",id:"title",modelValue:s.tempArticle.title,"onUpdate:modelValue":e[3]||(e[3]=n=>s.tempArticle.title=n),class:h(i),rules:"required",placeholder:"",required:""},null,8,["modelValue","class"])]),_:2},1032,["errors"]),a(_,{"label-for":"description",label:"簡介",errors:b},{default:c(({inputClass:i})=>[a(A,{type:"text",name:"簡介",id:"description",modelValue:s.tempArticle.description,"onUpdate:modelValue":e[4]||(e[4]=n=>s.tempArticle.description=n),class:h(i),rules:"required",as:"textarea",placeholder:"",required:""},null,8,["modelValue","class"])]),_:2},1032,["errors"]),a(_,{"label-for":"content",label:"內容",errors:b},{default:c(({inputClass:i})=>[a(A,{type:"text",name:"內容",id:"content",modelValue:s.tempArticle.content,"onUpdate:modelValue":e[5]||(e[5]=n=>s.tempArticle.content=n),class:h(i),rules:"required",as:"textarea",placeholder:"",required:""},null,8,["modelValue","class"])]),_:2},1032,["errors"]),t("div",gt,[t("div",_t,[a(_,{"label-for":"author",label:"作者",errors:b},{default:c(({inputClass:i})=>[a(A,{type:"text",name:"作者",id:"author",modelValue:s.tempArticle.author,"onUpdate:modelValue":e[6]||(e[6]=n=>s.tempArticle.author=n),class:h(i),rules:"required",placeholder:"",required:""},null,8,["modelValue","class"])]),_:2},1032,["errors"])]),t("div",bt,[a(x,{"label-for":"isPublic",label:"是否發佈"},{default:c(({inputClass:i})=>[k(t("input",{id:"isPublic",class:h(i),type:"checkbox","onUpdate:modelValue":e[7]||(e[7]=n=>s.tempArticle.isPublic=n)},null,2),[[q,s.tempArticle.isPublic]])]),_:1})])]),t("div",At,[a(_,{"label-for":"tag",label:"標籤",errors:b,class:"flex-grow"},{default:c(({inputClass:i})=>[k(t("input",{type:"text",list:"tagList",name:"標籤",id:"tag",class:h(["rounded-r-none",i]),"onUpdate:modelValue":e[8]||(e[8]=n=>s.tempTag=n),placeholder:"",onInput:e[9]||(e[9]=n=>s.isTagDuplicate=!1)},null,34),[[F,s.tempTag]]),t("datalist",ft,[(r(!0),p(f,null,T(o.tags,n=>(r(),p("option",{key:n,value:n},g(n),9,yt))),128))])]),_:2},1032,["errors"]),t("button",{type:"button",class:"btn btn-primary rounded-l-none text-nowrap",onClick:e[10]||(e[10]=(...i)=>u.addTag&&u.addTag(...i))}," 加入標籤 ")]),s.isTagDuplicate?(r(),p("span",xt,"已有「"+g(s.tempTag)+"」標籤",1)):D("",!0),Array.isArray(s.tempArticle.tag)?(r(),p("ul",wt,[(r(!0),p(f,null,T(s.tempArticle.tag,(i,n)=>(r(),p("li",{key:`${s.tempArticle.id}-${i}`},[t("button",{type:"button",class:"group flex items-center py-1 px-2 rounded-xl bg-primary-200 text-primary-800 text-center text-sm text-nowrap",onClick:Qt=>s.tempArticle.tag.splice(n,1)},[Tt,v(" "+g(i),1)],8,vt)]))),128))])):D("",!0),t("div",Ct,[t("button",{type:"button",class:"btn btn-outline-primary me-3",onClick:e[11]||(e[11]=i=>{u.closeModal(),u.resetModalForm()})}," 取消編輯"),It])])]),_:1},8,["onSubmit"]),a(w,{active:l.loadingStatus.editArticle,"is-full-page":!1,color:"#5C270D"},null,8,["active"])]),_:1},8,["onResetForm"])}const Vt=B(et,[["render",Mt]]);var St={VITE_URL:"https://ec-course-api.hexschool.io/v2",VITE_PATH:"jiayu",BASE_URL:"/Chocolate-Shop/",MODE:"production",DEV:!1,PROD:!0,SSR:!1};const{VITE_URL:$,VITE_PATH:E}=St,kt={components:{TableComponent:J,PaginationComponent:H,AdminActionBtns:K,ArticleModal:Vt,ActiveBadge:Q},data(){return{articles:[],tempId:"",isNew:!1,pagination:{},tags:[]}},mounted(){this.showLoading(),this.getAdminArticles()},methods:{async getAdminArticles(l=1){try{const e=`${$}/api/${E}/admin/articles?page=${l}`,o=await this.$http.get(e);this.articles=o.data.articles,this.pagination=o.data.pagination,this.tags=this.handleArrayInData(this.articles,"tag"),this.hideLoading()}catch(e){this.hideLoading();const{message:o}=e.response.data;this.$swal(Array.isArray(o)?o[0]:o)}},async delArticle(l){try{if((await this.delSwal("優惠券",l.title)).isConfirmed){this.loadingStatus.articleId=l.id;const o=`${$}/api/${E}/admin/article/${l.id}`;await this.$http.delete(o),this.getAdminArticles(),this.swalToast(`已刪除優惠券「${l.title}」`),this.loadingStatus.articleId=""}}catch(e){this.loadingStatus.articleId="";const{message:o}=e.response.data;this.$swal(Array.isArray(o)?o[0]:o)}},async openModal(l,e){switch(this.$refs.articleModal.showModal(),l){case"new":this.tempArticle={isPublic:!1,tag:[]},this.isNew=!0;break;case"edit":await this.$refs.articleModal.getSingleArticle(e.id),this.isNew=!1;break}},...y(R,["delSwal","swalToast"]),...y(C,["showLoading","hideLoading"]),...y(j,["timestampToDate","handleArrayInData"])},computed:{...P(C,["isLoading","loadingStatus"])}},Dt={class:"flex justify-between items-center mb-8"},Ft=t("h2",{class:"text-2xl font-bold"},"文章管理",-1),Ut=t("i",{class:"bi bi-plus-lg me-1"},null,-1),Lt=t("th",{scope:"col"},"標題",-1),$t=t("th",{class:"hidden md:table-cell",scope:"col"},"簡介",-1),Et=t("th",{scope:"col"},"圖片",-1),Pt=t("th",{scope:"col"},"標籤",-1),Bt=t("th",{scope:"col"},"最後更新",-1),Rt=t("th",{class:"hidden md:table-cell text-nowrap",scope:"col"},"作者",-1),Nt=t("th",{scope:"col"},"發布",-1),Ot=t("th",{scope:"col"},null,-1),qt={class:"hidden md:table-cell"},jt={class:"w-12 h-9 md:w-16 md:h-12"},Ht=["src"],Gt={key:0,class:"flex flex-wrap gap-1"},zt={class:"hidden md:table-cell text-nowrap"},Jt={class:"text-center"};function Kt(l,e,o,I,s,u){const M=m("ActiveBadge"),V=m("AdminActionBtns"),_=m("TableComponent"),S=m("PaginationComponent"),A=m("ArticleModal");return r(),p(f,null,[t("div",Dt,[Ft,t("button",{type:"button",class:"btn btn-primary",onClick:e[0]||(e[0]=x=>u.openModal("new"))},[Ut,v("新增文章 ")])]),a(_,{class:"mb-8"},{th:c(()=>[Lt,$t,Et,Pt,Bt,Rt,Nt,Ot]),tr:c(({trClass:x})=>[(r(!0),p(f,null,T(s.articles,d=>(r(),p("tr",{class:h(x),key:d.id},[t("td",null,g(d.title),1),t("td",qt,g(d.description),1),t("td",null,[t("div",jt,[t("img",{lazy:"loading",class:"rounded-md bg-cover",src:d.image,alt:"文章圖"},null,8,Ht)])]),t("td",null,[Array.isArray(d.tag)?(r(),p("ul",Gt,[(r(!0),p(f,null,T(d.tag,w=>(r(),p("li",{class:"py-1 px-2 rounded-xl bg-primary-200 text-primary-800 text-center text-xs md:text-sm text-nowrap",key:`${d.id}-${w}`},g(w),1))),128))])):D("",!0)]),t("td",null,[t("span",null,g(l.timestampToDate(d.create_at)),1)]),t("td",zt,g(d.author),1),t("td",Jt,[a(M,{active:d.isPublic},{trueMsg:c(()=>[v("發布")]),falseMsg:c(()=>[v("下架")]),_:2},1032,["active"])]),t("td",null,[a(V,{data:d,id:d.id,loadingId:"articleId",onOpenModal:u.openModal,onDelItem:u.delArticle},null,8,["data","id","onOpenModal","onDelItem"])])],2))),128))]),_:1}),a(S,{pagination:s.pagination,onGetData:u.getAdminArticles},null,8,["pagination","onGetData"]),a(A,{ref:"articleModal",id:s.tempId,"is-new":s.isNew,pagination:s.pagination,tags:s.tags,onGetData:u.getAdminArticles},null,8,["id","is-new","pagination","tags","onGetData"])],64)}const ne=B(kt,[["render",Kt]]);export{ne as default};
