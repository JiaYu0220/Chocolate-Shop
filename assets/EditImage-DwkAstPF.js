import{F as S}from"./FormFloat-oVAHurxL.js";import{m as U,a as M,_ as b,o as a,e as m,g,b as s,d as c,n as _,r as d,f as B,w as f,M as E,j as y,G as w,c as I,F as N,t as k}from"./index-LXrwWew1.js";import{I as D}from"./LoadingBtn-C4rBUQ05.js";import{l as R}from"./loadingStore-DK0tKp_Y.js";import{s as T}from"./swalStore-DGw95bNv.js";import{F as L}from"./AdminActionBtns-CCjyakLq.js";import{T as V}from"./TransitionFade-4itHXdet.js";var z={VITE_URL:"https://ec-course-api.hexschool.io/v2",VITE_PATH:"jiayu",BASE_URL:"/Chocolate-Shop/",MODE:"production",DEV:!1,PROD:!0,SSR:!1};const{VITE_URL:C,VITE_PATH:v}=z,j={data(){return{isDragfile:!1}},components:{IconLoading:D},props:{returnUrl:{type:Boolean,default:!1},isMultiple:{type:Boolean,default:!1},isLoading:{type:Boolean}},methods:{handleChange(o){this.returnUrl?this.isMultiple?this.uploadMultiImg(o):this.uploadImg(o):this.$emit("emitChange",o)},async uploadImg(o){try{this.loadingStatus.imageUrl=!0;const e=o.target.files[0],i=new FormData;i.append("file-to-upload",e);const p=`${C}/api/${v}/admin/upload`,{data:t}=await this.$http.post(p,i);this.$emit("emitChange",t.imageUrl),this.loadingStatus.imageUrl=!1}catch(e){this.loadingStatus.imageUrl=!1,e!=null&&e.response?this.apiErrorSwal(e,this.$refs.input):(e==null?void 0:e.code)==="ERR_NETWORK"&&this.$swal({title:"上傳失敗",text:"上傳的檔案可能太大，請選擇小於 3MB 的檔案。",target:this.$refs.input})}},async uploadMultiImg(o){try{this.loadingStatus.imagesUrl=!0;const{files:e}=o.target,i=`${C}/api/${v}/admin/upload`,p=Object.values(e).map(async u=>{const r=new FormData;return r.append("file-to-upload",u),(await this.$http.post(i,r)).data.imageUrl}),t=await Promise.all(p);this.$emit("emitChange",t);const n=o.target;n.value="",this.loadingStatus.imagesUrl=!1}catch(e){this.loadingStatus.imagesUrl=!1,e!=null&&e.response?this.apiErrorSwal(e,this.$refs.input):(e==null?void 0:e.code)==="ERR_NETWORK"&&this.$swal({title:"上傳失敗",text:"上傳的檔案可能太大，請選擇小於 3MB 的檔案。",target:this.$refs.input})}},...U(T,["apiErrorSwal"])},computed:{...M(R,["loadingStatus"])}},$=s("i",{class:"bi bi-file-earmark-image-fill text-2xl"},null,-1),A=s("p",null,"請拖曳圖片檔案到此區，或點擊後選取圖片檔案",-1),O={key:0},P=s("p",null,"PNG、JPG、JPEG，檔案大小須為 3MB 以下",-1),H=["multiple","disabled"],W={key:1,class:"absolute flex h-full w-full items-center justify-center bg-primary-50 opacity-80"};function G(o,e,i,p,t,n){const u=d("IconLoading");return a(),m("label",{ref:"input",for:"imageInput",class:_(["relative flex w-full cursor-pointer flex-col items-center justify-center rounded-md border-4 p-4 text-center text-sm text-stone-400 duration-150 hover:bg-stone-100 md:text-base",t.isDragfile?"border-primary-300":"border-dashed border-stone-300"])},[$,A,i.isMultiple?(a(),m("p",O,"可上傳多個檔案")):g("",!0),P,s("input",{class:"absolute h-full w-full cursor-pointer opacity-0",type:"file",accept:".png, .jpg, .jpeg",id:"imageInput",ref:"imageFile",title:"",multiple:i.isMultiple,disabled:i.isLoading,onChange:e[0]||(e[0]=(...r)=>n.handleChange&&n.handleChange(...r)),onDragover:e[1]||(e[1]=r=>t.isDragfile=!0),onDrop:e[2]||(e[2]=r=>t.isDragfile=!1),onDragleave:e[3]||(e[3]=r=>t.isDragfile=!1)},null,40,H),i.isLoading?(a(),m("div",W,[c(u,{size:"lg"})])):g("",!0)],2)}const J=b(j,[["render",G]]),K={data(){return{previews:{},cropperUrl:"",fileName:this.downName,option:{img:"",info:!0,outputSize:1,full:!0,outputType:"png",original:!1,canScale:!1,canMove:!1,canMoveBox:!0,autoCrop:!0,autoCropWidth:750,autoCropHeight:500,centerBox:!0,high:!0,maxImgSize:99999,mode:"contain"},fixed:!0,fixedNumber:[1,1]}},components:{FormFloat:S,FileInput:J,FormModal:L},props:{downName:String},watch:{downName(){this.fileName=this.downName}},methods:{upload(o){if(o.target.files.length){const e=o.target.files[0],i=new FileReader;i.onload=p=>{const t=window.URL.createObjectURL(new Blob([p.target.result]));this.option.img=t},i.readAsArrayBuffer(e)}},download(){const o=document.createElement("a");o.download=this.fileName,this.$refs.cropper.getCropBlob(e=>{this.cropperUrl=window.URL.createObjectURL(e),o.href=this.cropperUrl,o.click()})},clear(){this.option.img=""}}},q=s("i",{class:"bi bi-scissors mr-1"},null,-1),Q=s("p",{class:"mb-2"},"請選擇圖片檔案或貼上圖片網址：",-1),X=s("i",{class:"bi bi-x text-xl"},null,-1),Y=[X],Z={key:0,class:"h-[200px] w-full md:h-[400px]"},ee={class:"mt-5 flex"};function te(o,e,i,p,t,n){const u=d("FileInput"),r=d("FormFloat"),x=d("VueCropper"),F=d("FormModal");return a(),m(N,null,[s("button",{type:"button",class:"btn btn-primary-light",onClick:e[0]||(e[0]=l=>o.$refs.cropperModal.showModal())},[q,B("裁剪圖片小工具 ")]),c(F,{ref:"cropperModal",target:"cropperModal",onResetForm:n.clear},{title:f(({titleClass:l})=>[s("h3",{class:_(l)},"裁剪圖片小工具",2)]),default:f(()=>[Q,c(u,{onEmitChange:n.upload,class:"mb-3"},null,8,["onEmitChange"]),c(r,{"label-for":"imgUrl",label:"圖片網址",class:"mb-3"},E({default:f(({inputClass:l})=>[y(s("input",{type:"text",name:"圖片",id:"imgUrl",class:_(l),"onUpdate:modelValue":e[1]||(e[1]=h=>t.option.img=h),placeholder:""},null,2),[[w,t.option.img]])]),_:2},[t.option.img?{name:"icon",fn:f(({iconClass:l})=>[s("button",{type:"button",class:_(l),onClick:e[2]||(e[2]=(...h)=>n.clear&&n.clear(...h))},Y,2)]),key:"0"}:void 0]),1024),t.option.img?(a(),m("div",Z,[c(x,{ref:"cropper",img:t.option.img,"center-wrapper":"","output-size":t.option.outputSize,"output-type":t.option.outputType,info:t.option.info,full:t.option.full,fixed:t.fixed,"fixed-number":t.fixedNumber,"can-move":t.option.canMove,"can-move-box":t.option.canMoveBox,"can-scale":t.option.canScale,original:t.option.original,"auto-crop":t.option.autoCrop,autoCropWidth:t.option.autoCropWidth,autoCropHeight:t.option.autoCropHeight,"center-box":t.option.centerBox,high:t.option.high,"max-img-size":t.option.maxImgSize,mode:t.option.mode},null,8,["img","output-size","output-type","info","full","fixed","fixed-number","can-move","can-move-box","can-scale","original","auto-crop","autoCropWidth","autoCropHeight","center-box","high","max-img-size","mode"])])):g("",!0),s("div",ee,[t.option.img?(a(),I(r,{key:0,"label-for":"fileName",label:"下載的檔案名稱",class:"flex-grow"},{default:f(({inputClass:l})=>[y(s("input",{type:"text",name:"檔案名稱",id:"fileName",class:_(["rounded-r-none",l]),"onUpdate:modelValue":e[3]||(e[3]=h=>t.fileName=h),placeholder:""},null,2),[[w,t.fileName]])]),_:1})):g("",!0),t.option.img?(a(),m("button",{key:1,type:"button",class:"btn btn-primary text-nowrap rounded-l-none",onClick:e[4]||(e[4]=(...l)=>n.download&&n.download(...l))}," 下載 ")):g("",!0)])]),_:1},8,["onResetForm"])],64)}const we=b(K,[["render",te]]),oe={data(){return{isCopy:!1,isFail:!1}},components:{TransitionFade:V},props:{text:{type:String},msg:{type:String}},methods:{async copy(o){try{await navigator.clipboard.writeText(o),this.isFail=!1,this.isCopy=!0,setTimeout(()=>{this.isCopy=!1},700)}catch{this.isFail=!0}}}},ie={class:"relative"},se=s("i",{class:"bi bi-copy"},null,-1),ne={key:0,class:"absolute bottom-full right-0 isolate z-10 m-1 text-nowrap rounded bg-primary-100 p-1 text-sm text-primary-800 shadow-sm"};function re(o,e,i,p,t,n){const u=d("TransitionFade");return a(),m("button",{type:"button",onClick:e[0]||(e[0]=r=>n.copy(i.text))},[s("div",ie,[se,c(u,null,{default:f(()=>[t.isCopy?(a(),m("div",ne,k(t.isFail?"複製失敗":`已複製${i.msg}`),1)):g("",!0)]),_:1})])])}const le=b(oe,[["render",re]]),ae={props:{image:String},components:{CopyBtn:le}},pe={class:"relative rounded-md border-2 border-primary-300 p-1"},ue=["src"],me=s("i",{class:"bi bi-trash-fill"},null,-1),ce=[me];function de(o,e,i,p,t,n){const u=d("CopyBtn");return a(),m("div",pe,[s("img",{loading:"lazy",src:i.image,class:"rounded-sm object-cover",alt:"產品圖"},null,8,ue),c(u,{text:i.image,msg:"圖片網址",class:"absolute bottom-0 right-0 rounded-md bg-primary-50 p-1 text-primary-800 duration-150 hover:text-primary-300"},null,8,["text"]),s("button",{type:"button",class:"absolute right-0 top-0 rounded-md bg-primary-50 p-1 text-primary-800 duration-150 hover:text-red-500 focus:text-red-500",onClick:e[0]||(e[0]=r=>o.$emit("handleDelete"))},ce)])}const Ce=b(ae,[["render",de]]);export{we as C,Ce as E,J as F};
