import{m as y,h as L,_ as P,o as r,e as R,w as d,b as t,t as g,n as h,a as i,c,j as k,v as D,F as f,l as $,k as C,g as F,r as u,d as v}from"./index-DVC19zHe.js";import{l as T}from"./loadingStore-D7WRynS8.js";import{M as N,C as O,s as B,T as j,P as q,A as H,h as G}from"./AdminActionBtns-BHZMKv17.js";import{A as J}from"./ActiveBadge-DbJMJVZm.js";import{F as z}from"./FormFloat-CUjVlUZ5.js";import{a as K,F as Q,C as W}from"./CopyBtn-Cvv51XYA.js";var X={VITE_URL:"https://ec-course-api.hexschool.io/v2",VITE_PATH:"jiayu",BASE_URL:"/Chocolate-Shop/",MODE:"production",DEV:!1,PROD:!0,SSR:!1};const{VITE_URL:Y,VITE_PATH:Z}=X,tt={components:{ModalComponent:N,FormFloat:z,ChecksRadio:O,CropperComponent:K,FileInput:Q,CopyBtn:W},props:{article:Object,tags:Array,isNew:Boolean,pagination:Object},data(){return{tempArticle:{},tempImageUrl:"",tempTag:"",isTagDuplicate:!1}},mounted(){this.tempArticle=this.article},watch:{article(){this.tempArticle=this.article,String(this.tempArticle.due_date).length===10&&(this.tempArticle.due_date*=1e3)}},methods:{showModal(){this.$refs.articleModalComponent.showModal()},closeModal(){this.$refs.articleModalComponent.closeModal()},resetModalForm(){this.$refs.articleForm.resetForm(),this.tempTag="",this.isTagDuplicate=!1},addImageUrl(a){this.tempArticle.image=a},addTag(){if(this.tempArticle.tag.includes(this.tempTag)){this.isTagDuplicate=!0;return}this.tempArticle.tag.push(this.tempTag),this.tempTag=""},async updateArticle(){try{let a=`${Y}/api/${Z}/admin/article`,e="post",n=1;this.tempArticle.create_at=Math.floor(new Date().getTime()/1e3);const M=`已${this.isNew?"新增":"更新"}文章「${this.tempArticle.title}」`;this.isNew?this.loadingStatus.newArticle=!0:(a+=`/${this.tempArticle.id}`,e="put",n=this.pagination.current_page,this.loadingStatus.articleId=this.tempArticle.id),this.closeModal(),await this.$http[e](a,{data:this.tempArticle}),this.resetModalForm(),this.$emit("getData",n),this.loadingStatus.articleId="",this.loadingStatus.newArticle=!1,this.swalToast(M)}catch(a){this.loadingStatus.articleId="",this.loadingStatus.newArticle=!1;const{message:e}=a.response.data;this.$swal(Array.isArray(e)?e[0]:e)}},...y(B,["swalToast"]),...y(T,["showLoading","hideLoading"])},computed:{...L(T,["loadingStatus"])}},et={class:"flex justify-between items-end mb-3"},st=t("h4",{class:"text-xl font-bold text-primary-800"},"圖片",-1),lt={class:"pb-4 md:pb-8 mb-4 border-b border-primary-700"},ot=t("p",{class:"mb-2"},"請選擇圖片檔案或貼上圖片網址：",-1),it={class:"flex mb-5"},at=["disabled"],nt={key:1,class:"mb-3 md:w-1/2"},rt={class:"relative border-2 border-primary-300 rounded-md p-1"},dt=["src"],ct=t("i",{class:"bi bi-trash-fill"},null,-1),mt=[ct],pt=t("h4",{class:"text-xl font-bold text-primary-800 mb-4"},"文字",-1),ut={class:"flex flex-col gap-3"},ht={class:"flex gap-3"},gt={class:"w-1/2"},_t={class:"w-1/2"},bt={class:"flex w-fill md:w-1/2"},At={id:"tagList"},ft=["value"],yt={key:0,class:"text-red-600"},xt={key:1,class:"flex flex-wrap gap-1"},wt=["onClick"],vt=t("i",{class:"bi bi-x text-lg transition duration-150 group-hover:text-orange-700"},null,-1),Ct={class:"mt-5 text-end"},Tt=t("button",{type:"submit",class:"btn btn-primary"}," 儲存編輯",-1);function Mt(a,e,n,M,s,m){const V=u("CropperComponent"),I=u("FileInput"),_=u("FormFloat"),S=u("CopyBtn"),A=u("VField"),x=u("ChecksRadio"),p=u("VForm"),w=u("ModalComponent");return r(),R(w,{target:"article",ref:"articleModalComponent",onResetForm:m.resetModalForm},{title:d(({titleClass:b})=>[t("h3",{class:h(b)},g(n.isNew?"新增":"編輯")+"文章",3)]),default:d(()=>[i(p,{ref:"articleForm",onSubmit:m.updateArticle},{default:d(({errors:b})=>[t("div",et,[st,i(V,{"down-name":`文章${s.tempArticle.num}`},null,8,["down-name"])]),t("div",lt,[s.tempArticle.image?(r(),c("div",nt,[t("div",rt,[t("img",{src:s.tempArticle.image,class:"object-cover rounded-sm",alt:"產品圖"},null,8,dt),i(S,{text:s.tempArticle.image,msg:"圖片網址",class:"absolute right-0 bottom-0 p-1 rounded-md bg-primary-50 text-primary-800 duration-150 hover:text-primary-300"},null,8,["text"]),t("button",{type:"button",class:"absolute right-0 top-0 p-1 rounded-md bg-primary-50 text-primary-800 duration-150 hover:text-red-500 focus:text-red-500",onClick:e[2]||(e[2]=l=>s.tempArticle.image="")},mt)])])):(r(),c(f,{key:0},[ot,i(I,{"return-url":!0,onEmitChange:m.addImageUrl,class:"mb-3",isLoading:a.loadingStatus.imageUrl},null,8,["onEmitChange","isLoading"]),t("div",it,[i(_,{"label-for":"imageUrl",label:"圖片網址",class:"flex-grow"},{default:d(({inputClass:l})=>[k(t("input",{type:"text",name:"文章圖片",id:"imageUrl",class:h([l,"rounded-r-none"]),"onUpdate:modelValue":e[0]||(e[0]=o=>s.tempImageUrl=o),placeholder:""},null,2),[[D,s.tempImageUrl]])]),_:1}),t("button",{type:"button",class:"btn btn-primary rounded-l-none text-nowrap",disabled:!s.tempImageUrl,onClick:e[1]||(e[1]=l=>s.tempArticle.image=s.tempImageUrl)},"加入圖片",8,at)])],64))]),pt,t("div",ut,[i(_,{"label-for":"title",label:"標題",errors:b},{default:d(({inputClass:l})=>[i(A,{type:"text",name:"標題",id:"title",modelValue:s.tempArticle.title,"onUpdate:modelValue":e[3]||(e[3]=o=>s.tempArticle.title=o),class:h(l),rules:"required",placeholder:"",required:""},null,8,["modelValue","class"])]),_:2},1032,["errors"]),i(_,{"label-for":"description",label:"內容",errors:b},{default:d(({inputClass:l})=>[i(A,{type:"text",name:"內容",id:"description",modelValue:s.tempArticle.description,"onUpdate:modelValue":e[4]||(e[4]=o=>s.tempArticle.description=o),class:h(l),rules:"required",as:"textarea",placeholder:"",required:""},null,8,["modelValue","class"])]),_:2},1032,["errors"]),i(_,{"label-for":"content",label:"內容2",errors:b},{default:d(({inputClass:l})=>[i(A,{type:"text",name:"內容2",id:"content",modelValue:s.tempArticle.content,"onUpdate:modelValue":e[5]||(e[5]=o=>s.tempArticle.content=o),class:h(l),rules:"required",as:"textarea",placeholder:"",required:""},null,8,["modelValue","class"])]),_:2},1032,["errors"]),t("div",ht,[t("div",gt,[i(_,{"label-for":"author",label:"作者",errors:b},{default:d(({inputClass:l})=>[i(A,{type:"text",name:"作者",id:"author",modelValue:s.tempArticle.author,"onUpdate:modelValue":e[6]||(e[6]=o=>s.tempArticle.author=o),class:h(l),rules:"required",placeholder:"",required:""},null,8,["modelValue","class"])]),_:2},1032,["errors"])]),t("div",_t,[i(x,{"label-for":"isPublic",label:"是否發佈"},{default:d(({inputClass:l})=>[k(t("input",{id:"isPublic",class:h(l),type:"checkbox","onUpdate:modelValue":e[7]||(e[7]=o=>s.tempArticle.isPublic=o)},null,2),[[$,s.tempArticle.isPublic]])]),_:1})])]),t("div",bt,[i(_,{"label-for":"tag",label:"標籤",errors:b,class:"flex-grow"},{default:d(({inputClass:l})=>[k(t("input",{type:"text",list:"tagList",name:"標籤",id:"tag",class:h(["rounded-r-none",l]),"onUpdate:modelValue":e[8]||(e[8]=o=>s.tempTag=o),placeholder:"",onInput:e[9]||(e[9]=o=>s.isTagDuplicate=!1)},null,34),[[D,s.tempTag]]),t("datalist",At,[(r(!0),c(f,null,C(n.tags,o=>(r(),c("option",{key:o,value:o},g(o),9,ft))),128))])]),_:2},1032,["errors"]),t("button",{type:"button",class:"btn btn-primary rounded-l-none text-nowrap",onClick:e[10]||(e[10]=(...l)=>m.addTag&&m.addTag(...l))}," 加入標籤 ")]),s.isTagDuplicate?(r(),c("span",yt,"已有「"+g(s.tempTag)+"」標籤",1)):F("",!0),Array.isArray(s.tempArticle.tag)?(r(),c("ul",xt,[(r(!0),c(f,null,C(s.tempArticle.tag,(l,o)=>(r(),c("li",{key:`${s.tempArticle.id}-${l}`},[t("button",{type:"button",class:"group flex items-center py-1 px-2 rounded-xl bg-primary-200 text-primary-800 text-center text-sm text-nowrap",onClick:Kt=>s.tempArticle.tag.splice(o,1)},[vt,v(" "+g(l),1)],8,wt)]))),128))])):F("",!0),t("div",Ct,[t("button",{type:"button",class:"btn btn-outline-primary me-3",onClick:e[11]||(e[11]=l=>{m.closeModal(),m.resetModalForm()})}," 取消編輯"),Tt])])]),_:1},8,["onSubmit"])]),_:1},8,["onResetForm"])}const Vt=P(tt,[["render",Mt]]);var It={VITE_URL:"https://ec-course-api.hexschool.io/v2",VITE_PATH:"jiayu",BASE_URL:"/Chocolate-Shop/",MODE:"production",DEV:!1,PROD:!0,SSR:!1};const{VITE_URL:U,VITE_PATH:E}=It,St={components:{TableComponent:j,PaginationComponent:q,AdminActionBtns:H,ArticleModal:Vt,ActiveBadge:J},data(){return{articles:[],tempArticle:{},isNew:!1,pagination:{},tags:[]}},mounted(){this.showLoading(),this.getAdminArticles()},methods:{async getAdminArticles(a=1){try{const e=`${U}/api/${E}/admin/articles?page=${a}`,n=await this.$http.get(e);this.articles=n.data.articles,this.pagination=n.data.pagination,this.tags=this.handleArrayInData(this.articles,"tag")}catch(e){const{message:n}=e.response.data;this.$swal(Array.isArray(n)?n[0]:n)}finally{this.hideLoading()}},async delArticle(a){try{if((await this.delSwal("優惠券",a.title)).isConfirmed){this.loadingStatus.articleId=a.id;const n=`${U}/api/${E}/admin/article/${a.id}`;await this.$http.delete(n),this.getAdminArticles(),this.swalToast(`已刪除優惠券「${a.title}」`),this.loadingStatus.articleId=""}}catch(e){this.loadingStatus.articleId="";const{message:n}=e.response.data;this.$swal(Array.isArray(n)?n[0]:n)}},openModal(a,e){switch(a){case"new":this.tempArticle={isPublic:!1,tag:[]},this.isNew=!0;break;case"edit":this.tempArticle=JSON.parse(JSON.stringify(e)),Array.isArray(this.tempArticle.tag)||(this.tempArticle.tag=[]),this.isNew=!1;break}this.$refs.articleModal.showModal()},...y(B,["delSwal","swalToast"]),...y(T,["showLoading","hideLoading"]),...y(G,["handleDate","handleArrayInData"])},computed:{...L(T,["isLoading","loadingStatus"])}},kt={class:"flex justify-between items-center mb-8"},Ft=t("h2",{class:"text-2xl font-bold"},"文章管理",-1),Dt=t("i",{class:"bi bi-plus-lg me-1"},null,-1),Ut=t("th",{scope:"col"},"標題",-1),Et=t("th",{class:"hidden md:table-cell",scope:"col"},"內容",-1),Lt=t("th",{scope:"col"},"圖片",-1),Pt=t("th",{scope:"col"},"標籤",-1),Bt=t("th",{scope:"col"},"最後更新",-1),Rt=t("th",{class:"hidden md:table-cell",scope:"col"},"作者",-1),$t=t("th",{scope:"col"},"發布",-1),Nt=t("th",{scope:"col"},null,-1),Ot={class:"hidden md:table-cell"},jt={class:"w-12 h-9 md:w-16 md:h-12"},qt=["src"],Ht={key:0,class:"flex flex-wrap gap-1"},Gt={class:"hidden md:table-cell"},Jt={class:"text-center"};function zt(a,e,n,M,s,m){const V=u("ActiveBadge"),I=u("AdminActionBtns"),_=u("TableComponent"),S=u("PaginationComponent"),A=u("ArticleModal");return r(),c(f,null,[t("div",kt,[Ft,t("button",{type:"button",class:"btn btn-primary",onClick:e[0]||(e[0]=x=>m.openModal("new"))},[Dt,v("新增文章 ")])]),i(_,{class:"mb-8"},{th:d(()=>[Ut,Et,Lt,Pt,Bt,Rt,$t,Nt]),tr:d(({trClass:x})=>[(r(!0),c(f,null,C(s.articles,p=>(r(),c("tr",{class:h(x),key:p.id},[t("td",null,g(p.title),1),t("td",Ot,g(p.description),1),t("td",null,[t("div",jt,[t("img",{class:"rounded-md bg-cover",src:p.image,alt:"文章圖"},null,8,qt)])]),t("td",null,[Array.isArray(p.tag)?(r(),c("ul",Ht,[(r(!0),c(f,null,C(p.tag,w=>(r(),c("li",{class:"py-1 px-2 rounded-xl bg-primary-200 text-primary-800 text-center text-xs md:text-sm text-nowrap",key:`${p.id}-${w}`},g(w),1))),128))])):F("",!0)]),t("td",null,[t("span",null,g(a.handleDate(p.create_at)),1)]),t("td",Gt,g(p.author),1),t("td",Jt,[i(V,{active:p.isPublic},{trueMsg:d(()=>[v("發布")]),falseMsg:d(()=>[v("下架")]),_:2},1032,["active"])]),t("td",null,[i(I,{data:p,loadingId:"articleId",onOpenModal:m.openModal,onDelItem:m.delArticle},null,8,["data","onOpenModal","onDelItem"])])],2))),128))]),_:1}),i(S,{pagination:s.pagination,onGetData:m.getAdminArticles},null,8,["pagination","onGetData"]),i(A,{ref:"articleModal",article:s.tempArticle,"is-new":s.isNew,pagination:s.pagination,tags:s.tags,onGetData:m.getAdminArticles},null,8,["article","is-new","pagination","tags","onGetData"])],64)}const ee=P(St,[["render",zt]]);export{ee as default};
