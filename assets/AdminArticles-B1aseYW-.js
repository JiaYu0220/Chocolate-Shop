import{m as w,a as P,_ as R,o as n,c as O,w as d,b as t,t as g,n as h,d as o,e as m,j as F,D,F as A,J as q,i as v,g as E,f as T,r as c}from"./index-CY03ZQzG.js";import{l as I}from"./loadingStore-D3SGLAyx.js";import{s as B}from"./swalStore-Dp0_3MaJ.js";import{h as j}from"./helperStore-CDzSdp3x.js";import{P as H}from"./PaginationComponent-DwEGBHzB.js";import{F as G,C as z,T as J,A as K}from"./AdminActionBtns-BGnGq428.js";import{A as Q}from"./ActiveBadge-BSaHZ7u5.js";import{F as W}from"./FormFloat-DuWbB3gq.js";import{C as X,F as Y,E as Z}from"./EditImage-CsRn3Qf4.js";import"./XBtn-kL3xh3IT.js";import"./scrollStore-HyAaPtIP.js";import"./LoadingBtn-BREpaRRS.js";var tt={VITE_URL:"https://ec-course-api.hexschool.io/v2",VITE_PATH:"jiayu",BASE_URL:"/Chocolate-Shop/",MODE:"production",DEV:!1,PROD:!0,SSR:!1};const{VITE_URL:k,VITE_PATH:U}=tt,et={components:{FormModal:G,FormFloat:W,ChecksRadio:z,CropperComponent:X,FileInput:Y,EditImage:Z},props:{id:String,tags:Array,isNew:Boolean,pagination:Object},data(){return{tempArticle:{},tempId:"",tempImageUrl:"",tempTag:"",isTagDuplicate:!1,loading:!0}},methods:{async showModal(){this.$refs.articleFormModal.showModal()},closeModal(){this.$refs.articleFormModal.closeModal()},async getSingleArticle(s){try{this.loadingStatus.editArticle=!0;const e=`${k}/api/${U}/admin/article/${s}`,p=await this.$http.get(e);this.tempArticle=p.data.article,Array.isArray(this.tempArticle.tag)||(this.tempArticle.tag=[]),this.loadingStatus.editArticle=!1}catch(e){this.loadingStatus.editArticle=!1,this.apiErrorSwal(e,this.$refs.articleFormModal)}},resetModalForm(){this.$refs.articleForm.resetForm(),this.tempArticle.image="",this.tempTag="",this.isTagDuplicate=!1},addImageUrl(s){this.tempArticle.image=s},addTag(){if(this.tempArticle.tag.includes(this.tempTag)){this.isTagDuplicate=!0;return}this.tempArticle.tag.push(this.tempTag),this.tempTag=""},async updateArticle(){try{let s=`${k}/api/${U}/admin/article`,e="post",p=1;this.tempArticle.create_at=Math.floor(new Date().getTime()/1e3);const S=`已${this.isNew?"新增":"更新"}文章「${this.tempArticle.title}」`;this.isNew||(s+=`/${this.tempArticle.id}`,e="put",p=this.pagination.current_page,this.loadingStatus.articleId=this.tempArticle.id),this.closeModal(),await this.$http[e](s,{data:this.tempArticle}),this.resetModalForm(),this.$emit("getData",p),this.loadingStatus.articleId="",this.swalToast(S)}catch(s){this.loadingStatus.articleId="",this.apiErrorSwal(s)}},...w(B,["swalToast","apiErrorSwal"]),...w(I,["showLoading","hideLoading"])},computed:{...P(I,["loadingStatus"])}},lt={class:"mb-3 flex items-end justify-between"},st=t("h4",{class:"text-xl font-bold text-primary-800"},"圖片",-1),it={class:"mb-4 border-b border-primary-700 pb-4 md:pb-8"},ot=t("p",{class:"mb-2"},"請選擇圖片檔案或貼上圖片網址：",-1),at={class:"mb-5 flex"},nt=["disabled"],rt={key:1,class:"mb-3 md:w-1/2"},dt=t("h4",{class:"mb-4 text-xl font-bold text-primary-800"},"文字",-1),ct={class:"flex flex-col gap-3"},mt={class:"flex gap-3"},pt={class:"w-1/2"},ut={class:"w-1/2"},ht={class:"w-fill flex md:w-1/2"},gt={id:"tagList"},_t=["value"],ft={key:0,class:"text-red-600"},bt={key:1,class:"flex flex-wrap gap-1"},At=["onClick"],wt=t("i",{class:"bi bi-x text-lg transition duration-150 group-hover:text-orange-700"},null,-1),xt={class:"mt-5 text-end"},yt=t("button",{type:"submit",class:"btn btn-primary"},"儲存編輯",-1);function Tt(s,e,p,S,l,u){const M=c("CropperComponent"),V=c("FileInput"),_=c("FormFloat"),C=c("EditImage"),b=c("VField"),x=c("ChecksRadio"),r=c("VForm"),y=c("LoadingOverlay"),N=c("FormModal");return n(),O(N,{target:"article",ref:"articleFormModal",onResetForm:u.resetModalForm},{title:d(({titleClass:f})=>[t("h3",{class:h(f)},g(p.isNew?"新增":"編輯")+"文章",3)]),default:d(()=>[o(r,{ref:"articleForm",onSubmit:u.updateArticle},{default:d(({errors:f})=>[t("div",lt,[st,o(M,{"down-name":"文章"})]),t("div",it,[l.tempArticle.image?(n(),m("div",rt,[o(C,{image:l.tempArticle.image,onHandleDelete:e[2]||(e[2]=i=>l.tempArticle.image="")},null,8,["image"])])):(n(),m(A,{key:0},[ot,o(V,{"return-url":!0,onEmitChange:u.addImageUrl,class:"mb-3",isLoading:s.loadingStatus.imageUrl},null,8,["onEmitChange","isLoading"]),t("div",at,[o(_,{"label-for":"imageUrl",label:"圖片網址",class:"flex-grow"},{default:d(({inputClass:i})=>[F(t("input",{type:"text",name:"文章圖片",id:"imageUrl",class:h([i,"rounded-r-none"]),"onUpdate:modelValue":e[0]||(e[0]=a=>l.tempImageUrl=a),placeholder:""},null,2),[[D,l.tempImageUrl]])]),_:1}),t("button",{type:"button",class:"btn btn-primary text-nowrap rounded-l-none",disabled:!l.tempImageUrl,onClick:e[1]||(e[1]=i=>l.tempArticle.image=l.tempImageUrl)}," 加入圖片 ",8,nt)])],64))]),dt,t("div",ct,[o(_,{"label-for":"title",label:"標題",errors:f},{default:d(({inputClass:i})=>[o(b,{type:"text",name:"標題",id:"title",modelValue:l.tempArticle.title,"onUpdate:modelValue":e[3]||(e[3]=a=>l.tempArticle.title=a),class:h(i),rules:"required",placeholder:"",required:""},null,8,["modelValue","class"])]),_:2},1032,["errors"]),o(_,{"label-for":"description",label:"簡介",errors:f},{default:d(({inputClass:i})=>[o(b,{type:"text",name:"簡介",id:"description",modelValue:l.tempArticle.description,"onUpdate:modelValue":e[4]||(e[4]=a=>l.tempArticle.description=a),class:h(i),rules:"required",as:"textarea",placeholder:"",required:""},null,8,["modelValue","class"])]),_:2},1032,["errors"]),o(_,{"label-for":"content",label:"內容",errors:f},{default:d(({inputClass:i})=>[o(b,{type:"text",name:"內容",id:"content",modelValue:l.tempArticle.content,"onUpdate:modelValue":e[5]||(e[5]=a=>l.tempArticle.content=a),class:h(i),rules:"required",as:"textarea",placeholder:"",required:""},null,8,["modelValue","class"])]),_:2},1032,["errors"]),t("div",mt,[t("div",pt,[o(_,{"label-for":"author",label:"作者",errors:f},{default:d(({inputClass:i})=>[o(b,{type:"text",name:"作者",id:"author",modelValue:l.tempArticle.author,"onUpdate:modelValue":e[6]||(e[6]=a=>l.tempArticle.author=a),class:h(i),rules:"required",placeholder:"",required:""},null,8,["modelValue","class"])]),_:2},1032,["errors"])]),t("div",ut,[o(x,{"label-for":"isPublic",label:"是否發佈"},{default:d(({inputClass:i})=>[F(t("input",{id:"isPublic",class:h(i),type:"checkbox","onUpdate:modelValue":e[7]||(e[7]=a=>l.tempArticle.isPublic=a)},null,2),[[q,l.tempArticle.isPublic]])]),_:1})])]),t("div",ht,[o(_,{"label-for":"tag",label:"標籤",errors:f,class:"flex-grow"},{default:d(({inputClass:i})=>[F(t("input",{type:"text",list:"tagList",name:"標籤",id:"tag",class:h(["rounded-r-none",i]),"onUpdate:modelValue":e[8]||(e[8]=a=>l.tempTag=a),placeholder:"",onInput:e[9]||(e[9]=a=>l.isTagDuplicate=!1)},null,34),[[D,l.tempTag]]),t("datalist",gt,[(n(!0),m(A,null,v(p.tags,a=>(n(),m("option",{key:a,value:a},g(a),9,_t))),128))])]),_:2},1032,["errors"]),t("button",{type:"button",class:"btn btn-primary text-nowrap rounded-l-none",onClick:e[10]||(e[10]=(...i)=>u.addTag&&u.addTag(...i))}," 加入標籤 ")]),l.isTagDuplicate?(n(),m("span",ft,"已有「"+g(l.tempTag)+"」標籤",1)):E("",!0),Array.isArray(l.tempArticle.tag)?(n(),m("ul",bt,[(n(!0),m(A,null,v(l.tempArticle.tag,(i,a)=>(n(),m("li",{key:`${l.tempArticle.id}-${i}`},[t("button",{type:"button",class:"group flex items-center text-nowrap rounded-xl bg-primary-200 px-2 py-1 text-center text-sm text-primary-800",onClick:Gt=>l.tempArticle.tag.splice(a,1)},[wt,T(" "+g(i),1)],8,At)]))),128))])):E("",!0),t("div",xt,[t("button",{type:"button",class:"btn btn-outline-primary me-3",onClick:e[11]||(e[11]=i=>{u.closeModal(),u.resetModalForm()})}," 取消編輯 "),yt])])]),_:1},8,["onSubmit"]),o(y,{active:s.loadingStatus.editArticle,"is-full-page":!1,color:"#5C270D"},null,8,["active"])]),_:1},8,["onResetForm"])}const vt=R(et,[["render",Tt]]);var It={VITE_URL:"https://ec-course-api.hexschool.io/v2",VITE_PATH:"jiayu",BASE_URL:"/Chocolate-Shop/",MODE:"production",DEV:!1,PROD:!0,SSR:!1};const{VITE_URL:L,VITE_PATH:$}=It,St={components:{TableComponent:J,PaginationComponent:H,AdminActionBtns:K,ArticleModal:vt,ActiveBadge:Q},data(){return{articles:[],tempId:"",isNew:!1,pagination:{},tags:[]}},mounted(){this.showLoading(),this.getAdminArticles()},methods:{async getAdminArticles(s=1){try{const e=`${L}/api/${$}/admin/articles?page=${s}`,p=await this.$http.get(e);this.articles=p.data.articles,this.pagination=p.data.pagination,this.tags=this.handleArrayInData(this.articles,"tag"),this.hideLoading()}catch(e){this.hideLoading(),this.apiErrorSwal(e)}},async delArticle(s){try{if((await this.delSwal("優惠券",s.title)).isConfirmed){this.loadingStatus.articleId=s.id;const p=`${L}/api/${$}/admin/article/${s.id}`;await this.$http.delete(p),this.getAdminArticles(),this.swalToast(`已刪除優惠券「${s.title}」`),this.loadingStatus.articleId=""}}catch(e){this.loadingStatus.articleId="",this.apiErrorSwal(e)}},async openModal(s,e){switch(this.$refs.articleModal.showModal(),s){case"new":this.tempArticle={isPublic:!1,tag:[]},this.isNew=!0;break;case"edit":await this.$refs.articleModal.getSingleArticle(e.id),this.isNew=!1;break}},...w(B,["delSwal","swalToast","apiErrorSwal"]),...w(I,["showLoading","hideLoading"]),...w(j,["timestampToDate","handleArrayInData"])},computed:{...P(I,["isLoading","loadingStatus"])}},Mt={class:"mb-8 flex items-center justify-between"},Vt=t("h2",{class:"text-2xl font-bold"},"文章管理",-1),Ct=t("i",{class:"bi bi-plus-lg me-1"},null,-1),Ft=t("th",{scope:"col"},"標題",-1),Et=t("th",{class:"hidden md:table-cell",scope:"col"},"簡介",-1),Dt=t("th",{scope:"col"},"圖片",-1),kt=t("th",{scope:"col"},"標籤",-1),Ut=t("th",{scope:"col"},"最後更新",-1),Lt=t("th",{class:"hidden text-nowrap md:table-cell",scope:"col"},"作者",-1),$t=t("th",{scope:"col"},"發布",-1),Pt=t("th",{scope:"col"},null,-1),Rt={class:"hidden md:table-cell"},Bt={class:"h-9 w-12 md:h-12 md:w-16"},Nt=["src"],Ot={key:0,class:"flex flex-wrap gap-1"},qt={class:"hidden text-nowrap md:table-cell"},jt={class:"text-center"};function Ht(s,e,p,S,l,u){const M=c("ActiveBadge"),V=c("AdminActionBtns"),_=c("TableComponent"),C=c("PaginationComponent"),b=c("ArticleModal");return n(),m(A,null,[t("div",Mt,[Vt,t("button",{type:"button",class:"btn btn-primary",onClick:e[0]||(e[0]=x=>u.openModal("new"))},[Ct,T("新增文章 ")])]),o(_,{class:"mb-8"},{th:d(()=>[Ft,Et,Dt,kt,Ut,Lt,$t,Pt]),tr:d(({trClass:x})=>[(n(!0),m(A,null,v(l.articles,r=>(n(),m("tr",{class:h(x),key:r.id},[t("td",null,g(r.title),1),t("td",Rt,g(r.description),1),t("td",null,[t("div",Bt,[t("img",{lazy:"loading",class:"rounded-md bg-cover",src:r.image,alt:"文章圖"},null,8,Nt)])]),t("td",null,[Array.isArray(r.tag)?(n(),m("ul",Ot,[(n(!0),m(A,null,v(r.tag,y=>(n(),m("li",{class:"text-nowrap rounded-xl bg-primary-200 px-2 py-1 text-center text-xs text-primary-800 md:text-sm",key:`${r.id}-${y}`},g(y),1))),128))])):E("",!0)]),t("td",null,[t("span",null,g(s.timestampToDate(r.create_at)),1)]),t("td",qt,g(r.author),1),t("td",jt,[o(M,{active:r.isPublic},{trueMsg:d(()=>[T("發布")]),falseMsg:d(()=>[T("下架")]),_:2},1032,["active"])]),t("td",null,[o(V,{data:r,id:r.id,loadingId:"articleId",onOpenModal:u.openModal,onDelItem:u.delArticle},null,8,["data","id","onOpenModal","onDelItem"])])],2))),128))]),_:1}),o(C,{pagination:l.pagination,onGetData:u.getAdminArticles},null,8,["pagination","onGetData"]),o(b,{ref:"articleModal",id:l.tempId,"is-new":l.isNew,pagination:l.pagination,tags:l.tags,onGetData:u.getAdminArticles},null,8,["id","is-new","pagination","tags","onGetData"])],64)}const ie=R(St,[["render",Ht]]);export{ie as default};
